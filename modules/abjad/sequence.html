

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>abjad.sequence &mdash; Perllan API 0.3 documentation</title>
  

  
  <link rel="stylesheet" href="../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../static/abjad.css" type="text/css" />
  <link rel="stylesheet" href="../../static/uqbar.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../static/notes.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../static/documentation_options.js"></script>
        <script src="../../static/jquery.js"></script>
        <script src="../../static/underscore.js"></script>
        <script src="../../static/doctools.js"></script>
        <script defer="defer" src="../../static/copybutton.js"></script>
        <script src="../../static/ga.js"></script>
    
    <script type="text/javascript" src="../../static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #556B2F" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Perllan API
          

          
            
            <img src="../../static/perllan-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts.html">Core concepts</a></li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/abjadext/microtones/index.html">microtones</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/evans/index.html">evans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/tsmakers/index.html">tsmakers</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../scores.html">Score gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../recipes_pitch.html">Pitch Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../recipes_sequence.html">Sequence Recipes</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Perllan API</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>abjad.sequence</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for abjad.sequence</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">collections.abc</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">typing</span>

<span class="kn">import</span> <span class="nn">quicktions</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">enums</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">math</span> <span class="k">as</span> <span class="n">_math</span>
<span class="kn">from</span> <span class="nn">.cyclictuple</span> <span class="kn">import</span> <span class="n">CyclicTuple</span>
<span class="kn">from</span> <span class="nn">.ratio</span> <span class="kn">import</span> <span class="n">Ratio</span>
<span class="kn">from</span> <span class="nn">.storage</span> <span class="kn">import</span> <span class="n">FormatSpecification</span><span class="p">,</span> <span class="n">StorageFormatManager</span>


<span class="k">class</span> <span class="nc">Sequence</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sequence.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Initializes sequence:</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([1, 2, 3, 4, 5, 6])</span>
<span class="sd">            Sequence([1, 2, 3, 4, 5, 6])</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Initializes and reverses sequence:</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence([1, 2, 3, 4, 5, 6])</span>
<span class="sd">            &gt;&gt;&gt; sequence.reverse()</span>
<span class="sd">            Sequence([6, 5, 4, 3, 2, 1])</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Initializes, reverses and flattens sequence:</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence([1, 2, 3, [4, 5, [6]]])</span>
<span class="sd">            &gt;&gt;&gt; sequence = sequence.reverse()</span>
<span class="sd">            &gt;&gt;&gt; sequence = sequence.flatten(depth=-1)</span>
<span class="sd">            &gt;&gt;&gt; sequence</span>
<span class="sd">            Sequence([4, 5, 6, 3, 2, 1])</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        REGRESSION:</span>

<span class="sd">        &gt;&gt;&gt; abjad.Sequence(0)</span>
<span class="sd">        Sequence([0])</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">### CLASS VARIABLES ###</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_equivalence_markup&quot;</span><span class="p">,</span> <span class="s2">&quot;_expression&quot;</span><span class="p">,</span> <span class="s2">&quot;_items&quot;</span><span class="p">)</span>

    <span class="c1">### INITIALIZER ###</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_equivalence_markup</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">items</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">items</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

    <span class="c1">### SPECIAL METHODS ###</span>

<div class="viewcode-block" id="Sequence.__add__"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.__add__">[docs]</a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds ``argument`` to sequence.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Adds tuple to sequence:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; abjad.Sequence([1, 2, 3]) + (4, 5, 6)</span>
<span class="sd">                Sequence([1, 2, 3, 4, 5, 6])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Adds list to sequence:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; abjad.Sequence([1, 2, 3]) + [4, 5, 6]</span>
<span class="sd">                Sequence([1, 2, 3, 4, 5, 6])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Adds sequence to sequence:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence_1 = abjad.Sequence([1, 2, 3])</span>
<span class="sd">                &gt;&gt;&gt; sequence_2 = abjad.Sequence([4, 5, 6])</span>
<span class="sd">                &gt;&gt;&gt; sequence_1 + sequence_2</span>
<span class="sd">                Sequence([1, 2, 3, 4, 5, 6])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Reverses result:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence_1 = abjad.Sequence([1, 2, 3])</span>
<span class="sd">                &gt;&gt;&gt; sequence_2 = abjad.Sequence([4, 5, 6])</span>
<span class="sd">                &gt;&gt;&gt; sequence = sequence_1 + sequence_2</span>
<span class="sd">                &gt;&gt;&gt; sequence.reverse()</span>
<span class="sd">                Sequence([6, 5, 4, 3, 2, 1])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">argument</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">argument</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">+</span> <span class="n">argument</span><span class="o">.</span><span class="n">items</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.__eq__"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.__eq__">[docs]</a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when ``argument`` is a sequence with items equal to those of</span>
<span class="sd">        this sequence.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Is true when ``argument`` is a sequence with items equal to those</span>
<span class="sd">            of this sequence:</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([1, 2, 3, 4, 5, 6]) == abjad.Sequence([1, 2, 3, 4, 5, 6])</span>
<span class="sd">            True</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Is false when ``argument`` is not a sequence with items equal to</span>
<span class="sd">            those of this sequence:</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([1, 2, 3, 4, 5, 6]) == ([1, 2, 3, 4, 5, 6])</span>
<span class="sd">            False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">StorageFormatManager</span><span class="o">.</span><span class="n">compare_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.__getitem__"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.__getitem__">[docs]</a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets item or slice identified by ``argument``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets first item in sequence:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence([1, 2, 3, 4, 5, 6])</span>

<span class="sd">                &gt;&gt;&gt; sequence[0]</span>
<span class="sd">                1</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets last item in sequence:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence([1, 2, 3, 4, 5, 6])</span>

<span class="sd">                &gt;&gt;&gt; sequence[-1]</span>
<span class="sd">                6</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets slice from sequence:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence([1, 2, 3, 4, 5, 6])</span>
<span class="sd">                &gt;&gt;&gt; sequence = sequence[:3]</span>

<span class="sd">                &gt;&gt;&gt; sequence</span>
<span class="sd">                Sequence([1, 2, 3])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets item in sequence and wraps result in new sequence:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence([1, 2, 3, 4, 5, 6])</span>
<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(sequence[0])</span>

<span class="sd">                &gt;&gt;&gt; sequence</span>
<span class="sd">                Sequence([1])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets slice from sequence and flattens slice:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence([1, 2, [3, [4]], 5])</span>
<span class="sd">                &gt;&gt;&gt; sequence = sequence[:-1]</span>
<span class="sd">                &gt;&gt;&gt; sequence = sequence.flatten(depth=-1)</span>

<span class="sd">                &gt;&gt;&gt; sequence</span>
<span class="sd">                Sequence([1, 2, 3, 4])</span>

<span class="sd">        Returns item or new sequence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Sequence.__hash__"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.__hash__">[docs]</a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hashes sequence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hash_values</span> <span class="o">=</span> <span class="n">StorageFormatManager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_hash_values</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="n">hash_values</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unhashable type: </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Sequence.__len__"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.__len__">[docs]</a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets length of sequence.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets length of sequence:</span>

<span class="sd">            &gt;&gt;&gt; len(abjad.Sequence([1, 2, 3, 4, 5, 6]))</span>
<span class="sd">            6</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets length of sequence:</span>

<span class="sd">            &gt;&gt;&gt; len(abjad.Sequence(&#39;text&#39;))</span>
<span class="sd">            4</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.__radd__"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.__radd__">[docs]</a>    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds sequence to ``argument``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Adds sequence to tuple:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; (1, 2, 3) + abjad.Sequence([4, 5, 6])</span>
<span class="sd">                Sequence([1, 2, 3, 4, 5, 6])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Adds sequence to list:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; [1, 2, 3] + abjad.Sequence([4, 5, 6])</span>
<span class="sd">                Sequence([1, 2, 3, 4, 5, 6])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Adds sequence to sequence:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; abjad.Sequence([1, 2, 3]) + abjad.Sequence([4, 5, 6])</span>
<span class="sd">                Sequence([1, 2, 3, 4, 5, 6])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">argument</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">argument</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">argument</span><span class="o">.</span><span class="n">items</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.__repr__"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.__repr__">[docs]</a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets interpreter representation of sequence.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets interpreter representation:</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([99])</span>
<span class="sd">            Sequence([99])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets interpreter representation:</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([1, 2, 3, 4, 5, 6])</span>
<span class="sd">            Sequence([1, 2, 3, 4, 5, 6])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">])</span>
        <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">([</span><span class="si">{</span><span class="n">items</span><span class="si">}</span><span class="s2">])&quot;</span>
        <span class="k">return</span> <span class="n">string</span></div>

    <span class="c1">### PRIVATE METHODS ###</span>

    <span class="c1"># creates an iterator that can generate a flattened list,</span>
    <span class="c1"># descending down into child elements to a depth given in the arguments.</span>
    <span class="c1"># note that depth &lt; 0 is effectively equivalent to infinity.</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_flatten_helper</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">classes</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">sequence</span>
        <span class="k">elif</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">item</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
                <span class="c1"># flatten an iterable by one level</span>
                <span class="n">depth_</span> <span class="o">=</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">item_</span> <span class="ow">in</span> <span class="n">Sequence</span><span class="o">.</span><span class="n">_flatten_helper</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">depth_</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">item_</span>

    <span class="k">def</span> <span class="nf">_get_format_specification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">FormatSpecification</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_partition_sequence_cyclically_by_weights_at_least</span><span class="p">(</span>
        <span class="n">class_</span><span class="p">,</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="n">l_copy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">target_weight_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">len_weights</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">l_copy</span><span class="p">:</span>
            <span class="n">target_weight</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">target_weight_index</span> <span class="o">%</span> <span class="n">len_weights</span><span class="p">]</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">l_copy</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">current_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">target_weight</span> <span class="o">&lt;=</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">current_part</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
                <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">target_weight_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">l_copy</span>
        <span class="k">if</span> <span class="n">current_part</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">overhang</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
        <span class="c1"># return result</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">class_</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">class_</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_partition_sequence_cyclically_by_weights_at_most</span><span class="p">(</span>
        <span class="n">class_</span><span class="p">,</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_target_weight_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">current_target_weight</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">current_target_weight_index</span><span class="p">]</span>
        <span class="n">l_copy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">l_copy</span><span class="p">:</span>
            <span class="n">current_target_weight</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">current_target_weight_index</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)]</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">l_copy</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">current_part_weight</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
            <span class="n">candidate_part_weight</span> <span class="o">=</span> <span class="n">current_part_weight</span> <span class="o">+</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">([</span><span class="n">item</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">candidate_part_weight</span> <span class="o">&lt;</span> <span class="n">current_target_weight</span><span class="p">:</span>
                <span class="n">current_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">candidate_part_weight</span> <span class="o">==</span> <span class="n">current_target_weight</span><span class="p">:</span>
                <span class="n">current_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
                <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">current_target_weight_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">current_target_weight</span> <span class="o">&lt;</span> <span class="n">candidate_part_weight</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">current_part</span><span class="p">:</span>
                    <span class="n">l_copy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
                    <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">current_target_weight_index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;elements in sequence too big.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;candidate and target rates must compare.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">current_part</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">overhang</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
        <span class="c1"># return result</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">class_</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">class_</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_partition_sequence_once_by_weights_at_least</span><span class="p">(</span>
        <span class="n">class_</span><span class="p">,</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">l_copy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">num_weight</span><span class="p">,</span> <span class="n">target_weight</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">l_copy</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">num_weight</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">current_part</span><span class="p">:</span>
                            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
                            <span class="k">break</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;too few elements in sequence.&quot;</span><span class="p">)</span>
                <span class="n">current_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">target_weight</span> <span class="o">&lt;=</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">current_part</span><span class="p">):</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
                    <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">break</span>
        <span class="k">if</span> <span class="n">l_copy</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">overhang</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l_copy</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">class_</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">class_</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_partition_sequence_once_by_weights_at_most</span><span class="p">(</span>
        <span class="n">class_</span><span class="p">,</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="n">l_copy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">target_weight</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">l_copy</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;too few elements in sequence.&quot;</span><span class="p">)</span>
                <span class="n">current_weight</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
                <span class="n">candidate_weight</span> <span class="o">=</span> <span class="n">current_weight</span> <span class="o">+</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">([</span><span class="n">item</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">candidate_weight</span> <span class="o">&lt;</span> <span class="n">target_weight</span><span class="p">:</span>
                    <span class="n">current_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">candidate_weight</span> <span class="o">==</span> <span class="n">target_weight</span><span class="p">:</span>
                    <span class="n">current_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
                    <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">target_weight</span> <span class="o">&lt;</span> <span class="n">candidate_weight</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">current_part</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_part</span><span class="p">)</span>
                        <span class="n">current_part</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">l_copy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;elements in sequence too big.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;candidate and target weights must compare.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">overhang</span><span class="p">:</span>
            <span class="n">left_over</span> <span class="o">=</span> <span class="n">current_part</span> <span class="o">+</span> <span class="n">l_copy</span>
            <span class="k">if</span> <span class="n">left_over</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left_over</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">class_</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">class_</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

    <span class="c1">### PUBLIC PROPERTIES ###</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets sequence items.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                Initializes items positionally:</span>

<span class="sd">                &gt;&gt;&gt; abjad.Sequence([1, 2, 3, 4, 5, 6]).items</span>
<span class="sd">                (1, 2, 3, 4, 5, 6)</span>

<span class="sd">                Initializes items from keyword:</span>

<span class="sd">                &gt;&gt;&gt; abjad.Sequence([1, 2, 3, 4, 5, 6]).items</span>
<span class="sd">                (1, 2, 3, 4, 5, 6)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span>

    <span class="c1">### PUBLIC METHODS ###</span>

<div class="viewcode-block" id="Sequence.filter"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.filter">[docs]</a>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filters sequence by ``predicate``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            By length:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                With lambda:</span>

<span class="sd">                &gt;&gt;&gt; items = [[1], [2, 3, [4]], [5], [6, 7, [8]]]</span>
<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(items)</span>

<span class="sd">                &gt;&gt;&gt; sequence.filter(lambda _: len(_) == 1)</span>
<span class="sd">                Sequence([[1], [5]])</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                With inequality:</span>

<span class="sd">                &gt;&gt;&gt; items = [[1], [2, 3, [4]], [5], [6, 7, [8]]]</span>
<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(items)</span>

<span class="sd">                &gt;&gt;&gt; sequence.filter(abjad.LengthInequality(&#39;==&#39;, 1))</span>
<span class="sd">                Sequence([[1], [5]])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            By duration:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                With inequality:</span>

<span class="sd">                &gt;&gt;&gt; staff = abjad.Staff(&quot;c&#39;4. d&#39;8 e&#39;4. f&#39;8 g&#39;2&quot;)</span>
<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(staff)</span>

<span class="sd">                &gt;&gt;&gt; sequence.filter(abjad.DurationInequality(&#39;==&#39;, (1, 8)))</span>
<span class="sd">                Sequence([Note(&quot;d&#39;8&quot;), Note(&quot;f&#39;8&quot;)])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">predicate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[:]</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.flatten"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.flatten">[docs]</a>    <span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Flattens sequence.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Flattens sequence:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; items = [1, [2, 3, [4]], 5, [6, 7, [8]]]</span>
<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(items)</span>

<span class="sd">                &gt;&gt;&gt; sequence.flatten()</span>
<span class="sd">                Sequence([1, 2, 3, [4], 5, 6, 7, [8]])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Flattens sequence to depth 2:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; items = [1, [2, 3, [4]], 5, [6, 7, [8]]]</span>
<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(items)</span>

<span class="sd">                &gt;&gt;&gt; sequence.flatten(depth=2)</span>
<span class="sd">                Sequence([1, 2, 3, 4, 5, 6, 7, 8])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Flattens sequence to depth -1:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; items = [1, [2, 3, [4]], 5, [6, 7, [8]]]</span>
<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(items)</span>

<span class="sd">                &gt;&gt;&gt; sequence.flatten(depth=-1)</span>
<span class="sd">                Sequence([1, 2, 3, 4, 5, 6, 7, 8])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Flattens tuples in sequence only:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; items = [&#39;ab&#39;, &#39;cd&#39;, (&#39;ef&#39;, &#39;gh&#39;), (&#39;ij&#39;, &#39;kl&#39;)]</span>
<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(items)</span>

<span class="sd">                &gt;&gt;&gt; sequence.flatten(classes=(tuple,))</span>
<span class="sd">                Sequence([&#39;ab&#39;, &#39;cd&#39;, &#39;ef&#39;, &#39;gh&#39;, &#39;ij&#39;, &#39;kl&#39;])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">classes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">,)</span>
        <span class="k">if</span> <span class="n">Sequence</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
            <span class="n">classes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">Sequence</span><span class="p">])</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.group_by"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.group_by">[docs]</a>    <span class="k">def</span> <span class="nf">group_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Groups sequence items by value of items.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; items = [0, 0, -1, -1, 2, 3, -5, 1, 1, 5, -5]</span>
<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(items)</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence.group_by():</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([0, 0])</span>
<span class="sd">            Sequence([-1, -1])</span>
<span class="sd">            Sequence([2])</span>
<span class="sd">            Sequence([3])</span>
<span class="sd">            Sequence([-5])</span>
<span class="sd">            Sequence([1, 1])</span>
<span class="sd">            Sequence([5])</span>
<span class="sd">            Sequence([-5])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;c&#39;8 d&#39; d&#39; e&#39; e&#39; e&#39;&quot;)</span>
<span class="sd">            &gt;&gt;&gt; predicate = lambda x: abjad.PitchSet.from_selection(abjad.select(x))</span>
<span class="sd">            &gt;&gt;&gt; for item in abjad.Sequence(staff).group_by(predicate):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([Note(&quot;c&#39;8&quot;)])</span>
<span class="sd">            Sequence([Note(&quot;d&#39;8&quot;), Note(&quot;d&#39;8&quot;)])</span>
<span class="sd">            Sequence([Note(&quot;e&#39;8&quot;), Note(&quot;e&#39;8&quot;), Note(&quot;e&#39;8&quot;)])</span>

<span class="sd">        Returns nested sequence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">predicate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pairs</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="n">_</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">group</span><span class="p">)</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pairs</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">group</span><span class="p">)</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.is_decreasing"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.is_decreasing">[docs]</a>    <span class="k">def</span> <span class="nf">is_decreasing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when sequence decreases.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Is true when sequence is strictly decreasing:</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([5, 4, 3, 2, 1, 0]).is_decreasing(strict=True)</span>
<span class="sd">            True</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([3, 3, 3, 2, 1, 0]).is_decreasing(strict=True)</span>
<span class="sd">            False</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([3, 3, 3, 3, 3, 3]).is_decreasing(strict=True)</span>
<span class="sd">            False</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence().is_decreasing(strict=True)</span>
<span class="sd">            True</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Is true when sequence decreases monotonically:</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([5, 4, 3, 2, 1, 0]).is_decreasing(strict=False)</span>
<span class="sd">            True</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([3, 3, 3, 2, 1, 0]).is_decreasing(strict=False)</span>
<span class="sd">            True</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([3, 3, 3, 3, 3, 3]).is_decreasing(strict=False)</span>
<span class="sd">            True</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence().is_decreasing(strict=False)</span>
<span class="sd">            True</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">previous</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">current</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">previous</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">previous</span><span class="p">:</span>
                            <span class="k">return</span> <span class="kc">False</span>
                    <span class="n">previous</span> <span class="o">=</span> <span class="n">current</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">previous</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">current</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">previous</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">current</span> <span class="o">&lt;=</span> <span class="n">previous</span><span class="p">:</span>
                            <span class="k">return</span> <span class="kc">False</span>
                    <span class="n">previous</span> <span class="o">=</span> <span class="n">current</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Sequence.is_increasing"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.is_increasing">[docs]</a>    <span class="k">def</span> <span class="nf">is_increasing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when sequence increases.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Is true when sequence is strictly increasing:</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([0, 1, 2, 3, 4, 5]).is_increasing(strict=True)</span>
<span class="sd">            True</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([0, 1, 2, 3, 3, 3]).is_increasing(strict=True)</span>
<span class="sd">            False</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([3, 3, 3, 3, 3, 3]).is_increasing(strict=True)</span>
<span class="sd">            False</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence().is_increasing(strict=True)</span>
<span class="sd">            True</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Is true when sequence increases monotonically:</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([0, 1, 2, 3, 4, 5]).is_increasing(strict=False)</span>
<span class="sd">            True</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([0, 1, 2, 3, 3, 3]).is_increasing(strict=False)</span>
<span class="sd">            True</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([3, 3, 3, 3, 3, 3]).is_increasing(strict=False)</span>
<span class="sd">            True</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence().is_increasing(strict=False)</span>
<span class="sd">            True</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">previous</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">current</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">previous</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">previous</span> <span class="o">&lt;</span> <span class="n">current</span><span class="p">:</span>
                            <span class="k">return</span> <span class="kc">False</span>
                    <span class="n">previous</span> <span class="o">=</span> <span class="n">current</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">previous</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">current</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">previous</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">previous</span> <span class="o">&lt;=</span> <span class="n">current</span><span class="p">:</span>
                            <span class="k">return</span> <span class="kc">False</span>
                    <span class="n">previous</span> <span class="o">=</span> <span class="n">current</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Sequence.is_permutation"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.is_permutation">[docs]</a>    <span class="k">def</span> <span class="nf">is_permutation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when sequence is a permutation.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Is true when sequence is a permutation:</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([4, 5, 0, 3, 2, 1]).is_permutation()</span>
<span class="sd">            True</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Is false when sequence is not a permutation:</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([1, 1, 5, 3, 2, 1]).is_permutation()</span>
<span class="sd">            False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Sequence.is_repetition_free"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.is_repetition_free">[docs]</a>    <span class="k">def</span> <span class="nf">is_repetition_free</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when sequence is repetition-free.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Is true when sequence is repetition-free:</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([0, 1, 2, 6, 7, 8]).is_repetition_free()</span>
<span class="sd">            True</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Is true when sequence is empty:</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence().is_repetition_free()</span>
<span class="sd">            True</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Is false when sequence contains repetitions:</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([0, 1, 2, 2, 7, 8]).is_repetition_free()</span>
<span class="sd">            False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nwise</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">left</span> <span class="o">==</span> <span class="n">right</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Sequence.join"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.join">[docs]</a>    <span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Join subsequences in ``sequence``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; items = [(1, 2, 3), (), (4, 5), (), (6,)]</span>
<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(items)</span>
<span class="sd">            &gt;&gt;&gt; sequence</span>
<span class="sd">            Sequence([(1, 2, 3), (), (4, 5), (), (6,)])</span>

<span class="sd">            &gt;&gt;&gt; sequence.join()</span>
<span class="sd">            Sequence([(1, 2, 3, 4, 5, 6)])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">item_</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">item</span> <span class="o">+=</span> <span class="n">item_</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)([</span><span class="n">item</span><span class="p">])</span></div>

<div class="viewcode-block" id="Sequence.map"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.map">[docs]</a>    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operand</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Maps ``operand`` to sequence items.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence and sums parts:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(1, 10+1))</span>
<span class="sd">                &gt;&gt;&gt; sequence = sequence.partition_by_counts(</span>
<span class="sd">                ...     [3],</span>
<span class="sd">                ...     cyclic=True,</span>
<span class="sd">                ...     )</span>
<span class="sd">                &gt;&gt;&gt; sequence = sequence.map(sum)</span>

<span class="sd">                &gt;&gt;&gt; sequence</span>
<span class="sd">                Sequence([6, 15, 24])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Maps identity:</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence([1, 2, 3, 4, 5, 6])</span>
<span class="sd">            &gt;&gt;&gt; sequence.map()</span>
<span class="sd">            Sequence([1, 2, 3, 4, 5, 6])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">operand</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">item_</span> <span class="o">=</span> <span class="n">operand</span><span class="p">(</span><span class="n">item_</span><span class="p">)</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[:])</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.nwise"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.nwise">[docs]</a>    <span class="k">def</span> <span class="nf">nwise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wrapped</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Generator</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates sequence ``n`` at a time.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Iterates iterable by pairs:</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(range(10))</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence.nwise():</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([0, 1])</span>
<span class="sd">            Sequence([1, 2])</span>
<span class="sd">            Sequence([2, 3])</span>
<span class="sd">            Sequence([3, 4])</span>
<span class="sd">            Sequence([4, 5])</span>
<span class="sd">            Sequence([5, 6])</span>
<span class="sd">            Sequence([6, 7])</span>
<span class="sd">            Sequence([7, 8])</span>
<span class="sd">            Sequence([8, 9])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Iterates iterable by triples:</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(range(10))</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence.nwise(n=3):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([0, 1, 2])</span>
<span class="sd">            Sequence([1, 2, 3])</span>
<span class="sd">            Sequence([2, 3, 4])</span>
<span class="sd">            Sequence([3, 4, 5])</span>
<span class="sd">            Sequence([4, 5, 6])</span>
<span class="sd">            Sequence([5, 6, 7])</span>
<span class="sd">            Sequence([6, 7, 8])</span>
<span class="sd">            Sequence([7, 8, 9])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Iterates iterable by pairs. Wraps around at end:</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(range(10))</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence.nwise(n=2, wrapped=True):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([0, 1])</span>
<span class="sd">            Sequence([1, 2])</span>
<span class="sd">            Sequence([2, 3])</span>
<span class="sd">            Sequence([3, 4])</span>
<span class="sd">            Sequence([4, 5])</span>
<span class="sd">            Sequence([5, 6])</span>
<span class="sd">            Sequence([6, 7])</span>
<span class="sd">            Sequence([7, 8])</span>
<span class="sd">            Sequence([8, 9])</span>
<span class="sd">            Sequence([9, 0])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Iterates iterable by triples. Wraps around at end:</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(range(10))</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence.nwise(n=3, wrapped=True):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([0, 1, 2])</span>
<span class="sd">            Sequence([1, 2, 3])</span>
<span class="sd">            Sequence([2, 3, 4])</span>
<span class="sd">            Sequence([3, 4, 5])</span>
<span class="sd">            Sequence([4, 5, 6])</span>
<span class="sd">            Sequence([5, 6, 7])</span>
<span class="sd">            Sequence([6, 7, 8])</span>
<span class="sd">            Sequence([7, 8, 9])</span>
<span class="sd">            Sequence([8, 9, 0])</span>
<span class="sd">            Sequence([9, 0, 1])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Iterates iterable by pairs. Cycles indefinitely:</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(range(10))</span>
<span class="sd">            &gt;&gt;&gt; pairs = sequence.nwise(n=2, cyclic=True)</span>
<span class="sd">            &gt;&gt;&gt; for _ in range(15):</span>
<span class="sd">            ...     next(pairs)</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([0, 1])</span>
<span class="sd">            Sequence([1, 2])</span>
<span class="sd">            Sequence([2, 3])</span>
<span class="sd">            Sequence([3, 4])</span>
<span class="sd">            Sequence([4, 5])</span>
<span class="sd">            Sequence([5, 6])</span>
<span class="sd">            Sequence([6, 7])</span>
<span class="sd">            Sequence([7, 8])</span>
<span class="sd">            Sequence([8, 9])</span>
<span class="sd">            Sequence([9, 0])</span>
<span class="sd">            Sequence([0, 1])</span>
<span class="sd">            Sequence([1, 2])</span>
<span class="sd">            Sequence([2, 3])</span>
<span class="sd">            Sequence([3, 4])</span>
<span class="sd">            Sequence([4, 5])</span>

<span class="sd">            Returns infinite generator.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Iterates iterable by triples. Cycles indefinitely:</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(range(10))</span>
<span class="sd">            &gt;&gt;&gt; triples = sequence.nwise(n=3, cyclic=True)</span>
<span class="sd">            &gt;&gt;&gt; for _ in range(15):</span>
<span class="sd">            ...     next(triples)</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([0, 1, 2])</span>
<span class="sd">            Sequence([1, 2, 3])</span>
<span class="sd">            Sequence([2, 3, 4])</span>
<span class="sd">            Sequence([3, 4, 5])</span>
<span class="sd">            Sequence([4, 5, 6])</span>
<span class="sd">            Sequence([5, 6, 7])</span>
<span class="sd">            Sequence([6, 7, 8])</span>
<span class="sd">            Sequence([7, 8, 9])</span>
<span class="sd">            Sequence([8, 9, 0])</span>
<span class="sd">            Sequence([9, 0, 1])</span>
<span class="sd">            Sequence([0, 1, 2])</span>
<span class="sd">            Sequence([1, 2, 3])</span>
<span class="sd">            Sequence([2, 3, 4])</span>
<span class="sd">            Sequence([3, 4, 5])</span>
<span class="sd">            Sequence([4, 5, 6])</span>

<span class="sd">            Returns infinite generator.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Iterates items one at a time:</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(range(10))</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence.nwise(n=1):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([0])</span>
<span class="sd">            Sequence([1])</span>
<span class="sd">            Sequence([2])</span>
<span class="sd">            Sequence([3])</span>
<span class="sd">            Sequence([4])</span>
<span class="sd">            Sequence([5])</span>
<span class="sd">            Sequence([6])</span>
<span class="sd">            Sequence([7])</span>
<span class="sd">            Sequence([8])</span>
<span class="sd">            Sequence([9])</span>

<span class="sd">        Ignores ``wrapped`` when ``cyclic`` is true.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cyclic</span><span class="p">:</span>
            <span class="n">item_buffer</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">long_enough</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">item_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">long_enough</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">item_buffer</span><span class="p">):</span>
                        <span class="n">long_enough</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">long_enough</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">item_buffer</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">:])</span>
            <span class="n">len_sequence</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">item_buffer</span><span class="p">)</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">len_sequence</span> <span class="o">-</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">local_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">current</span> <span class="o">+</span> <span class="n">local_offset</span><span class="p">)</span> <span class="o">%</span> <span class="n">len_sequence</span>
                    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_buffer</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
                <span class="k">yield</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">output</span><span class="p">)</span>
                <span class="n">current</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">current</span> <span class="o">%=</span> <span class="n">len_sequence</span>
        <span class="k">elif</span> <span class="n">wrapped</span><span class="p">:</span>
            <span class="n">first_n_minus_1</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">item_buffer</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">item_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item_buffer</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">item_buffer</span><span class="p">)</span>
                    <span class="n">item_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">first_n_minus_1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">first_n_minus_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">item_buffer</span> <span class="o">=</span> <span class="n">item_buffer</span> <span class="o">+</span> <span class="n">first_n_minus_1</span>
            <span class="k">if</span> <span class="n">item_buffer</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">n</span>
                    <span class="k">yield</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">item_buffer</span><span class="p">[</span><span class="n">x</span><span class="p">:</span><span class="n">stop</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">item_buffer</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">item_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item_buffer</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">item_buffer</span><span class="p">)</span>
                    <span class="n">item_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.partition_by_counts"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.partition_by_counts">[docs]</a>    <span class="k">def</span> <span class="nf">partition_by_counts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">counts</span><span class="p">,</span>
        <span class="n">cyclic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">enchain</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">overhang</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">reversed_</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Partitions sequence by ``counts``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence once by counts without overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; sequence = sequence.partition_by_counts(</span>
<span class="sd">                ...     [3],</span>
<span class="sd">                ...     cyclic=False,</span>
<span class="sd">                ...     overhang=False,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; sequence</span>
<span class="sd">                Sequence([Sequence([0, 1, 2])])</span>

<span class="sd">                &gt;&gt;&gt; for part in sequence:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0, 1, 2])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence once by counts without overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [4, 3],</span>
<span class="sd">                ...     cyclic=False,</span>
<span class="sd">                ...     overhang=False,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0, 1, 2, 3])</span>
<span class="sd">                Sequence([4, 5, 6])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence cyclically by counts without overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [3],</span>
<span class="sd">                ...     cyclic=True,</span>
<span class="sd">                ...     overhang=False,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0, 1, 2])</span>
<span class="sd">                Sequence([3, 4, 5])</span>
<span class="sd">                Sequence([6, 7, 8])</span>
<span class="sd">                Sequence([9, 10, 11])</span>
<span class="sd">                Sequence([12, 13, 14])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence cyclically by counts without overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [4, 3],</span>
<span class="sd">                ...     cyclic=True,</span>
<span class="sd">                ...     overhang=False,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0, 1, 2, 3])</span>
<span class="sd">                Sequence([4, 5, 6])</span>
<span class="sd">                Sequence([7, 8, 9, 10])</span>
<span class="sd">                Sequence([11, 12, 13])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence once by counts with overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [3],</span>
<span class="sd">                ...     cyclic=False,</span>
<span class="sd">                ...     overhang=True,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0, 1, 2])</span>
<span class="sd">                Sequence([3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence once by counts with overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [4, 3],</span>
<span class="sd">                ...     cyclic=False,</span>
<span class="sd">                ...     overhang=True,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0, 1, 2, 3])</span>
<span class="sd">                Sequence([4, 5, 6])</span>
<span class="sd">                Sequence([7, 8, 9, 10, 11, 12, 13, 14, 15])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence cyclically by counts with overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [3],</span>
<span class="sd">                ...     cyclic=True,</span>
<span class="sd">                ...     overhang=True,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0, 1, 2])</span>
<span class="sd">                Sequence([3, 4, 5])</span>
<span class="sd">                Sequence([6, 7, 8])</span>
<span class="sd">                Sequence([9, 10, 11])</span>
<span class="sd">                Sequence([12, 13, 14])</span>
<span class="sd">                Sequence([15])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence cyclically by counts with overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [4, 3],</span>
<span class="sd">                ...     cyclic=True,</span>
<span class="sd">                ...     overhang=True,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0, 1, 2, 3])</span>
<span class="sd">                Sequence([4, 5, 6])</span>
<span class="sd">                Sequence([7, 8, 9, 10])</span>
<span class="sd">                Sequence([11, 12, 13])</span>
<span class="sd">                Sequence([14, 15])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Reverse-partitions sequence once by counts without overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [3],</span>
<span class="sd">                ...     cyclic=False,</span>
<span class="sd">                ...     overhang=False,</span>
<span class="sd">                ...     reversed_=True,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([13, 14, 15])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Reverse-partitions sequence once by counts without overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [4, 3],</span>
<span class="sd">                ...     cyclic=False,</span>
<span class="sd">                ...     overhang=False,</span>
<span class="sd">                ...     reversed_=True,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([9, 10, 11])</span>
<span class="sd">                Sequence([12, 13, 14, 15])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Reverse-partitions sequence cyclically by counts without overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [3],</span>
<span class="sd">                ...     cyclic=True,</span>
<span class="sd">                ...     overhang=False,</span>
<span class="sd">                ...     reversed_=True,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([1, 2, 3])</span>
<span class="sd">                Sequence([4, 5, 6])</span>
<span class="sd">                Sequence([7, 8, 9])</span>
<span class="sd">                Sequence([10, 11, 12])</span>
<span class="sd">                Sequence([13, 14, 15])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Reverse-partitions sequence cyclically by counts without overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [4, 3],</span>
<span class="sd">                ...     cyclic=True,</span>
<span class="sd">                ...     overhang=False,</span>
<span class="sd">                ...     reversed_=True,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([2, 3, 4])</span>
<span class="sd">                Sequence([5, 6, 7, 8])</span>
<span class="sd">                Sequence([9, 10, 11])</span>
<span class="sd">                Sequence([12, 13, 14, 15])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Reverse-partitions sequence once by counts with overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [3],</span>
<span class="sd">                ...     cyclic=False,</span>
<span class="sd">                ...     overhang=True,</span>
<span class="sd">                ...     reversed_=True,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12])</span>
<span class="sd">                Sequence([13, 14, 15])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Reverse-partitions sequence once by counts with overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [4, 3],</span>
<span class="sd">                ...     cyclic=False,</span>
<span class="sd">                ...     overhang=True,</span>
<span class="sd">                ...     reversed_=True,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0, 1, 2, 3, 4, 5, 6, 7, 8])</span>
<span class="sd">                Sequence([9, 10, 11])</span>
<span class="sd">                Sequence([12, 13, 14, 15])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Reverse-partitions sequence cyclically by counts with overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [3],</span>
<span class="sd">                ...     cyclic=True,</span>
<span class="sd">                ...     overhang=True,</span>
<span class="sd">                ...     reversed_=True,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0])</span>
<span class="sd">                Sequence([1, 2, 3])</span>
<span class="sd">                Sequence([4, 5, 6])</span>
<span class="sd">                Sequence([7, 8, 9])</span>
<span class="sd">                Sequence([10, 11, 12])</span>
<span class="sd">                Sequence([13, 14, 15])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Reverse-partitions sequence cyclically by counts with overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [4, 3],</span>
<span class="sd">                ...     cyclic=True,</span>
<span class="sd">                ...     overhang=True,</span>
<span class="sd">                ...     reversed_=True,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0, 1])</span>
<span class="sd">                Sequence([2, 3, 4])</span>
<span class="sd">                Sequence([5, 6, 7, 8])</span>
<span class="sd">                Sequence([9, 10, 11])</span>
<span class="sd">                Sequence([12, 13, 14, 15])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence once by counts and asserts that sequence</span>
<span class="sd">            partitions exactly (with no overhang):</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(10))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [2, 3, 5],</span>
<span class="sd">                ...     cyclic=False,</span>
<span class="sd">                ...     overhang=abjad.Exact,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0, 1])</span>
<span class="sd">                Sequence([2, 3, 4])</span>
<span class="sd">                Sequence([5, 6, 7, 8, 9])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence cyclically by counts and asserts that sequence</span>
<span class="sd">            partitions exactly Exact partitioning means partitioning with no</span>
<span class="sd">            overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(10))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [2],</span>
<span class="sd">                ...     cyclic=True,</span>
<span class="sd">                ...     overhang=abjad.Exact,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0, 1])</span>
<span class="sd">                Sequence([2, 3])</span>
<span class="sd">                Sequence([4, 5])</span>
<span class="sd">                Sequence([6, 7])</span>
<span class="sd">                Sequence([8, 9])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions string:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(&#39;some text&#39;)</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [3],</span>
<span class="sd">                ...     cyclic=False,</span>
<span class="sd">                ...     overhang=True,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([&#39;s&#39;, &#39;o&#39;, &#39;m&#39;])</span>
<span class="sd">                Sequence([&#39;e&#39;, &#39; &#39;, &#39;t&#39;, &#39;e&#39;, &#39;x&#39;, &#39;t&#39;])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence cyclically into enchained parts by counts;</span>
<span class="sd">            truncates overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [2, 6],</span>
<span class="sd">                ...     cyclic=True,</span>
<span class="sd">                ...     enchain=True,</span>
<span class="sd">                ...     overhang=False,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0, 1])</span>
<span class="sd">                Sequence([1, 2, 3, 4, 5, 6])</span>
<span class="sd">                Sequence([6, 7])</span>
<span class="sd">                Sequence([7, 8, 9, 10, 11, 12])</span>
<span class="sd">                Sequence([12, 13])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence cyclically into enchained parts by counts;</span>
<span class="sd">            returns overhang at end:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [2, 6],</span>
<span class="sd">                ...     cyclic=True,</span>
<span class="sd">                ...     enchain=True,</span>
<span class="sd">                ...     overhang=True,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0, 1])</span>
<span class="sd">                Sequence([1, 2, 3, 4, 5, 6])</span>
<span class="sd">                Sequence([6, 7])</span>
<span class="sd">                Sequence([7, 8, 9, 10, 11, 12])</span>
<span class="sd">                Sequence([12, 13])</span>
<span class="sd">                Sequence([13, 14, 15])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            REGRESSION: partitions sequence cyclically into enchained parts by</span>
<span class="sd">            counts; does not return false 1-element part at end:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts(</span>
<span class="sd">                ...     [5],</span>
<span class="sd">                ...     cyclic=True,</span>
<span class="sd">                ...     enchain=True,</span>
<span class="sd">                ...     overhang=True,</span>
<span class="sd">                ...     )</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0, 1, 2, 3, 4])</span>
<span class="sd">                Sequence([4, 5, 6, 7, 8])</span>
<span class="sd">                Sequence([8, 9, 10, 11, 12])</span>
<span class="sd">                Sequence([12, 13, 14, 15])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Edge case: empty counts nests sequence and ignores keywords:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">                &gt;&gt;&gt; parts = sequence.partition_by_counts([])</span>

<span class="sd">                &gt;&gt;&gt; for part in parts:</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15])</span>

<span class="sd">        Returns nested sequence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;must be nonnegative integers: </span><span class="si">{</span><span class="n">counts</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">reversed_</span><span class="p">:</span>
            <span class="n">sequence</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">sequence</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">counts</span><span class="p">:</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="n">CyclicTuple</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)([</span><span class="n">sequence</span><span class="p">])</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">count</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">enchain</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">part</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">break</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cyclic</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">part</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[</span><span class="n">start</span><span class="p">:]</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">enchain</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">part</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">overhang</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">overhang</span> <span class="ow">is</span> <span class="n">enums</span><span class="o">.</span><span class="n">Exact</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="o">==</span> <span class="n">count</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">overhang</span> <span class="ow">is</span> <span class="n">enums</span><span class="o">.</span><span class="n">Exact</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="o">!=</span> <span class="n">count</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;sequence does not partition exactly.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reversed_</span><span class="p">:</span>
            <span class="n">result_</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
                <span class="n">part_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
                <span class="n">part</span> <span class="o">=</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
                <span class="n">part</span> <span class="o">=</span> <span class="n">part_type</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
                <span class="n">result_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result_</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.partition_by_ratio_of_lengths"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.partition_by_ratio_of_lengths">[docs]</a>    <span class="k">def</span> <span class="nf">partition_by_ratio_of_lengths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ratio</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Partitions sequence by ``ratio`` of lengths.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence by ``1:1:1`` ratio:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; numbers = abjad.Sequence(range(10))</span>
<span class="sd">                &gt;&gt;&gt; ratio = abjad.Ratio((1, 1, 1))</span>

<span class="sd">                &gt;&gt;&gt; for part in numbers.partition_by_ratio_of_lengths(ratio):</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0, 1, 2])</span>
<span class="sd">                Sequence([3, 4, 5, 6])</span>
<span class="sd">                Sequence([7, 8, 9])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence by ``1:1:2`` ratio:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; numbers = abjad.Sequence(range(10))</span>
<span class="sd">                &gt;&gt;&gt; ratio = abjad.Ratio((1, 1, 2))</span>

<span class="sd">                &gt;&gt;&gt; for part in numbers.partition_by_ratio_of_lengths(ratio):</span>
<span class="sd">                ...     part</span>
<span class="sd">                Sequence([0, 1, 2])</span>
<span class="sd">                Sequence([3, 4])</span>
<span class="sd">                Sequence([5, 6, 7, 8, 9])</span>

<span class="sd">        Returns nested sequence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">Ratio</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">ratio</span><span class="o">.</span><span class="n">partition_integer</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_by_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">Exact</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">parts</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.partition_by_ratio_of_weights"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.partition_by_ratio_of_weights">[docs]</a>    <span class="k">def</span> <span class="nf">partition_by_ratio_of_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Partitions sequence by ratio of ``weights``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; ratio = abjad.Ratio([1, 1, 1])</span>
<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(10 * [1])</span>
<span class="sd">            &gt;&gt;&gt; sequence = sequence.partition_by_ratio_of_weights(ratio)</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([1, 1, 1])</span>
<span class="sd">            Sequence([1, 1, 1, 1])</span>
<span class="sd">            Sequence([1, 1, 1])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; ratio = abjad.Ratio([1, 1, 1, 1])</span>
<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(10 * [1])</span>
<span class="sd">            &gt;&gt;&gt; sequence = sequence.partition_by_ratio_of_weights(ratio)</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([1, 1, 1])</span>
<span class="sd">            Sequence([1, 1])</span>
<span class="sd">            Sequence([1, 1, 1])</span>
<span class="sd">            Sequence([1, 1])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; ratio = abjad.Ratio([2, 2, 3])</span>
<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(10 * [1])</span>
<span class="sd">            &gt;&gt;&gt; sequence = sequence.partition_by_ratio_of_weights(ratio)</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([1, 1, 1])</span>
<span class="sd">            Sequence([1, 1, 1])</span>
<span class="sd">            Sequence([1, 1, 1, 1])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; ratio = abjad.Ratio([3, 2, 2])</span>
<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(10 * [1])</span>
<span class="sd">            &gt;&gt;&gt; sequence = sequence.partition_by_ratio_of_weights(ratio)</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([1, 1, 1, 1])</span>
<span class="sd">            Sequence([1, 1, 1])</span>
<span class="sd">            Sequence([1, 1, 1])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; ratio = abjad.Ratio([1, 1])</span>
<span class="sd">            &gt;&gt;&gt; items = [1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2]</span>
<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(items)</span>
<span class="sd">            &gt;&gt;&gt; sequence = sequence.partition_by_ratio_of_weights(ratio)</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([1, 1, 1, 1, 1, 1, 2, 2])</span>
<span class="sd">            Sequence([2, 2, 2, 2])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; ratio = abjad.Ratio([1, 1, 1])</span>
<span class="sd">            &gt;&gt;&gt; items = [1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2]</span>
<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(items)</span>
<span class="sd">            &gt;&gt;&gt; sequence = sequence.partition_by_ratio_of_weights(ratio)</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([1, 1, 1, 1, 1, 1])</span>
<span class="sd">            Sequence([2, 2, 2])</span>
<span class="sd">            Sequence([2, 2, 2])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; ratio = abjad.Ratio([1, 1, 1])</span>
<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence([5, 5])</span>
<span class="sd">            &gt;&gt;&gt; sequence = sequence.partition_by_ratio_of_weights(ratio)</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([5])</span>
<span class="sd">            Sequence([5])</span>
<span class="sd">            Sequence([])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; ratio = abjad.Ratio([1, 1, 1, 1])</span>
<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence([5, 5])</span>
<span class="sd">            &gt;&gt;&gt; sequence = sequence.partition_by_ratio_of_weights(ratio)</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([5])</span>
<span class="sd">            Sequence([])</span>
<span class="sd">            Sequence([5])</span>
<span class="sd">            Sequence([])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; ratio = abjad.Ratio([2, 2, 3])</span>
<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence([5, 5])</span>
<span class="sd">            &gt;&gt;&gt; sequence = sequence.partition_by_ratio_of_weights(ratio)</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([5])</span>
<span class="sd">            Sequence([5])</span>
<span class="sd">            Sequence([])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; ratio = abjad.Ratio([3, 2, 2])</span>
<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence([5, 5])</span>
<span class="sd">            &gt;&gt;&gt; sequence = sequence.partition_by_ratio_of_weights(ratio)</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([5])</span>
<span class="sd">            Sequence([5])</span>
<span class="sd">            Sequence([])</span>

<span class="sd">        Rounded weight-proportions of sequences returned equal to rounded</span>
<span class="sd">        ``weights``.</span>

<span class="sd">        Returns nested sequence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_weight</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">weights_parts</span> <span class="o">=</span> <span class="n">Ratio</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">partition_integer</span><span class="p">(</span><span class="n">list_weight</span><span class="p">)</span>
        <span class="n">cumulative_weights</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">cumulative_sums</span><span class="p">(</span><span class="n">weights_parts</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sublist</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span>
        <span class="n">current_cumulative_weight</span> <span class="o">=</span> <span class="n">cumulative_weights</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">quicktions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;must be number: </span><span class="si">{</span><span class="n">item</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="n">sublist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">current_cumulative_weight</span> <span class="o">&lt;=</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span>
                <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">depth</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">current_cumulative_weight</span> <span class="o">=</span> <span class="n">cumulative_weights</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">sublist</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="n">items_</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items_</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.partition_by_weights"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.partition_by_weights">[docs]</a>    <span class="k">def</span> <span class="nf">partition_by_weights</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">weights</span><span class="p">,</span>
        <span class="c1"># TODO: make keyword-only:</span>
        <span class="n">cyclic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">overhang</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">allow_part_weights</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">Exact</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Partitions sequence by ``weights`` exactly.</span>

<span class="sd">        &gt;&gt;&gt; sequence = abjad.Sequence([3, 3, 3, 3, 4, 4, 4, 4, 5])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence once by weights with overhang:</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.partition_by_weights(</span>
<span class="sd">            ...     [3, 9],</span>
<span class="sd">            ...     cyclic=False,</span>
<span class="sd">            ...     overhang=False,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([3])</span>
<span class="sd">            Sequence([3, 3, 3])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence once by weights. Allows overhang:</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.partition_by_weights(</span>
<span class="sd">            ...     [3, 9],</span>
<span class="sd">            ...     cyclic=False,</span>
<span class="sd">            ...     overhang=True,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([3])</span>
<span class="sd">            Sequence([3, 3, 3])</span>
<span class="sd">            Sequence([4, 4, 4, 4, 5])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence cyclically by weights:</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.partition_by_weights(</span>
<span class="sd">            ...     [12],</span>
<span class="sd">            ...     cyclic=True,</span>
<span class="sd">            ...     overhang=False,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([3, 3, 3, 3])</span>
<span class="sd">            Sequence([4, 4, 4])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence cyclically by weights. Allows overhang:</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.partition_by_weights(</span>
<span class="sd">            ...     [12],</span>
<span class="sd">            ...     cyclic=True,</span>
<span class="sd">            ...     overhang=True,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([3, 3, 3, 3])</span>
<span class="sd">            Sequence([4, 4, 4])</span>
<span class="sd">            Sequence([4, 5])</span>

<span class="sd">        &gt;&gt;&gt; sequence = abjad.Sequence([3, 3, 3, 3, 4, 4, 4, 4, 5, 5])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence once by weights. Allows part weights to be just</span>
<span class="sd">            less than specified:</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.partition_by_weights(</span>
<span class="sd">            ...     [10, 4],</span>
<span class="sd">            ...     cyclic=False,</span>
<span class="sd">            ...     overhang=False,</span>
<span class="sd">            ...     allow_part_weights=abjad.Less,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([3, 3, 3])</span>
<span class="sd">            Sequence([3])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence once by weights. Allows part weights to be just</span>
<span class="sd">            less than specified. Allows overhang:</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.partition_by_weights(</span>
<span class="sd">            ...     [10, 4],</span>
<span class="sd">            ...     cyclic=False,</span>
<span class="sd">            ...     overhang=True,</span>
<span class="sd">            ...     allow_part_weights=abjad.Less,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([3, 3, 3])</span>
<span class="sd">            Sequence([3])</span>
<span class="sd">            Sequence([4, 4, 4, 4, 5, 5])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence cyclically by weights. Allows part weights to</span>
<span class="sd">            be just less than specified:</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.partition_by_weights(</span>
<span class="sd">            ...     [10, 5],</span>
<span class="sd">            ...     cyclic=True,</span>
<span class="sd">            ...     overhang=False,</span>
<span class="sd">            ...     allow_part_weights=abjad.Less,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([3, 3, 3])</span>
<span class="sd">            Sequence([3])</span>
<span class="sd">            Sequence([4, 4])</span>
<span class="sd">            Sequence([4])</span>
<span class="sd">            Sequence([4, 5])</span>
<span class="sd">            Sequence([5])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence cyclically by weights. Allows part weights to</span>
<span class="sd">            be just less than specified. Allows overhang:</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.partition_by_weights(</span>
<span class="sd">            ...     [10, 5],</span>
<span class="sd">            ...     cyclic=True,</span>
<span class="sd">            ...     overhang=True,</span>
<span class="sd">            ...     allow_part_weights=abjad.Less,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([3, 3, 3])</span>
<span class="sd">            Sequence([3])</span>
<span class="sd">            Sequence([4, 4])</span>
<span class="sd">            Sequence([4])</span>
<span class="sd">            Sequence([4, 5])</span>
<span class="sd">            Sequence([5])</span>

<span class="sd">        &gt;&gt;&gt; sequence = abjad.Sequence([3, 3, 3, 3, 4, 4, 4, 4, 5, 5])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence once by weights. Allow part weights to be just</span>
<span class="sd">            more than specified:</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.partition_by_weights(</span>
<span class="sd">            ...     [10, 4],</span>
<span class="sd">            ...     cyclic=False,</span>
<span class="sd">            ...     overhang=False,</span>
<span class="sd">            ...     allow_part_weights=abjad.More,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([3, 3, 3, 3])</span>
<span class="sd">            Sequence([4])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence once by weights. Allows part weights to be just</span>
<span class="sd">            more than specified. Allows overhang:</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.partition_by_weights(</span>
<span class="sd">            ...     [10, 4],</span>
<span class="sd">            ...     cyclic=False,</span>
<span class="sd">            ...     overhang=True,</span>
<span class="sd">            ...     allow_part_weights=abjad.More,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([3, 3, 3, 3])</span>
<span class="sd">            Sequence([4])</span>
<span class="sd">            Sequence([4, 4, 4, 5, 5])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence cyclically by weights. Allows part weights to</span>
<span class="sd">            be just more than specified:</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.partition_by_weights(</span>
<span class="sd">            ...     [10, 4],</span>
<span class="sd">            ...     cyclic=True,</span>
<span class="sd">            ...     overhang=False,</span>
<span class="sd">            ...     allow_part_weights=abjad.More,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([3, 3, 3, 3])</span>
<span class="sd">            Sequence([4])</span>
<span class="sd">            Sequence([4, 4, 4])</span>
<span class="sd">            Sequence([5])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions sequence cyclically by weights. Allows part weights to</span>
<span class="sd">            be just more than specified. Allows overhang:</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.partition_by_weights(</span>
<span class="sd">            ...     [10, 4],</span>
<span class="sd">            ...     cyclic=True,</span>
<span class="sd">            ...     overhang=True,</span>
<span class="sd">            ...     allow_part_weights=abjad.More,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([3, 3, 3, 3])</span>
<span class="sd">            Sequence([4])</span>
<span class="sd">            Sequence([4, 4, 4])</span>
<span class="sd">            Sequence([5])</span>
<span class="sd">            Sequence([5])</span>

<span class="sd">        Returns nested sequence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">allow_part_weights</span> <span class="ow">is</span> <span class="n">enums</span><span class="o">.</span><span class="n">Exact</span><span class="p">:</span>
            <span class="n">candidate</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">candidate</span> <span class="o">=</span> <span class="n">candidate</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cyclic</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="n">overhang</span><span class="p">)</span>
            <span class="n">flattened_candidate</span> <span class="o">=</span> <span class="n">candidate</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">depth</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">flattened_candidate</span> <span class="o">==</span> <span class="bp">self</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">flattened_candidate</span><span class="p">)]:</span>
                <span class="k">return</span> <span class="n">candidate</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;can not partition exactly.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">allow_part_weights</span> <span class="ow">is</span> <span class="n">enums</span><span class="o">.</span><span class="n">More</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cyclic</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Sequence</span><span class="o">.</span><span class="n">_partition_sequence_once_by_weights_at_least</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="n">overhang</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Sequence</span><span class="o">.</span><span class="n">_partition_sequence_cyclically_by_weights_at_least</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="n">overhang</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">allow_part_weights</span> <span class="ow">is</span> <span class="n">enums</span><span class="o">.</span><span class="n">Less</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cyclic</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Sequence</span><span class="o">.</span><span class="n">_partition_sequence_once_by_weights_at_most</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="n">overhang</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Sequence</span><span class="o">.</span><span class="n">_partition_sequence_cyclically_by_weights_at_most</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="n">overhang</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;allow_part_weights must be ordinal constant: </span><span class="si">{!r}</span><span class="s2">.&quot;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">allow_part_weights</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.permute"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.permute">[docs]</a>    <span class="k">def</span> <span class="nf">permute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">permutation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Permutes sequence by ``permutation``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence([10, 11, 12, 13, 14, 15])</span>
<span class="sd">            &gt;&gt;&gt; sequence.permute([5, 4, 0, 1, 2, 3])</span>
<span class="sd">            Sequence([15, 14, 10, 11, 12, 13])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence([11, 12, 13, 14])</span>
<span class="sd">            &gt;&gt;&gt; sequence.permute([1, 0, 3, 2])</span>
<span class="sd">            Sequence([12, 11, 14, 13])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Raises exception when lengths do not match:</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence([1, 2, 3, 4, 5, 6])</span>
<span class="sd">            &gt;&gt;&gt; sequence.permute([3, 0, 1, 2])</span>
<span class="sd">            Traceback (most recent call last):</span>
<span class="sd">                ...</span>
<span class="sd">            ValueError: permutation Sequence([3, 0, 1, 2]) must match length of Sequence([1, 2, 3, 4, 5, 6]).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">permutation</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">permutation</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">permutation</span><span class="o">.</span><span class="n">is_permutation</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;must be permutation: </span><span class="si">{</span><span class="n">permutation</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">permutation</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;permutation </span><span class="si">{</span><span class="n">permutation</span><span class="si">!r}</span><span class="s2"> must match length of </span><span class="si">{</span><span class="bp">self</span> <span class="si">!r}</span><span class="s2">.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">permutation</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">item_</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">result</span><span class="p">)</span></div>

    <span class="c1"># TODO: change input to pattern</span>
<div class="viewcode-block" id="Sequence.remove"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes items at ``indices``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(range(15))</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.remove()</span>
<span class="sd">            Sequence([])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.remove(indices=[2, 3])</span>
<span class="sd">            Sequence([0, 1, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Removes elements and indices -2 and -3:</span>

<span class="sd">            &gt;&gt;&gt; sequence.remove(indices=[-2, -3])</span>
<span class="sd">            Sequence([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 14])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.remove(indices=[2, 3], period=4)</span>
<span class="sd">            Sequence([0, 1, 4, 5, 8, 9, 12, 13])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.remove(indices=[-2, -3], period=4)</span>
<span class="sd">            Sequence([2, 3, 6, 7, 10, 11, 14])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.remove(indices=[])</span>
<span class="sd">            Sequence([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.remove(indices=[97, 98, 99])</span>
<span class="sd">            Sequence([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Removes no elements:</span>

<span class="sd">            &gt;&gt;&gt; sequence.remove(indices=[-97, -98, -99])</span>
<span class="sd">            Sequence([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">period</span> <span class="o">=</span> <span class="n">period</span> <span class="ow">or</span> <span class="n">length</span>
        <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="n">new_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">length</span> <span class="o">+</span> <span class="n">i</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">period</span>
            <span class="n">new_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">new_indices</span>
        <span class="n">indices</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">period</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.remove_repeats"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.remove_repeats">[docs]</a>    <span class="k">def</span> <span class="nf">remove_repeats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes repeats from ``sequence``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; items = [31, 31, 35, 35, 31, 31, 31, 31, 35]</span>
<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(items)</span>
<span class="sd">            &gt;&gt;&gt; sequence.remove_repeats()</span>
<span class="sd">            Sequence([31, 35, 31, 35])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="o">!=</span> <span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.repeat"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.repeat">[docs]</a>    <span class="k">def</span> <span class="nf">repeat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Repeats sequence.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; abjad.Sequence([1, 2, 3]).repeat(n=0)</span>
<span class="sd">                Sequence([])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; abjad.Sequence([1, 2, 3]).repeat(n=1)</span>
<span class="sd">                Sequence([Sequence([1, 2, 3])])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; abjad.Sequence([1, 2, 3]).repeat(n=2)</span>
<span class="sd">                Sequence([Sequence([1, 2, 3]), Sequence([1, 2, 3])])</span>

<span class="sd">        Returns nested sequence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">[:])</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.repeat_to_length"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.repeat_to_length">[docs]</a>    <span class="k">def</span> <span class="nf">repeat_to_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Repeats sequence to ``length``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Repeats list to length 11:</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence(range(5)).repeat_to_length(11)</span>
<span class="sd">            Sequence([0, 1, 2, 3, 4, 0, 1, 2, 3, 4, 0])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence(range(5)).repeat_to_length(11, start=2)</span>
<span class="sd">            Sequence([2, 3, 4, 0, 1, 2, 3, 4, 0, 1, 2])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence([0, -1, -2, -3, -4])</span>
<span class="sd">            &gt;&gt;&gt; sequence.repeat_to_length(11)</span>
<span class="sd">            Sequence([0, -1, -2, -3, -4, 0, -1, -2, -3, -4, 0])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.repeat_to_length(0)</span>
<span class="sd">            Sequence([])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([1, 2, 3]).repeat_to_length(10, start=100)</span>
<span class="sd">            Sequence([2, 3, 1, 2, 3, 1, 2, 3, 1, 2])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">_math</span><span class="o">.</span><span class="n">is_nonnegative_integer</span><span class="p">(</span><span class="n">length</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">start</span> <span class="o">%=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">stop_index</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">length</span>
        <span class="n">repetitions</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">stop_index</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repetitions</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop_index</span><span class="p">])</span></div>

<div class="viewcode-block" id="Sequence.repeat_to_weight"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.repeat_to_weight">[docs]</a>    <span class="k">def</span> <span class="nf">repeat_to_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">allow_total</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">Exact</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Repeats sequence to ``weight``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Repeats sequence to weight of 23 exactly:</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([5, -5, -5]).repeat_to_weight(23)</span>
<span class="sd">            Sequence([5, -5, -5, 5, -3])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Repeats sequence to weight of 23 more:</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence([5, -5, -5])</span>
<span class="sd">            &gt;&gt;&gt; sequence.repeat_to_weight(23, allow_total=abjad.More)</span>
<span class="sd">            Sequence([5, -5, -5, 5, -5])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Repeats sequence to weight of 23 or less:</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence([5, -5, -5])</span>
<span class="sd">            &gt;&gt;&gt; sequence.repeat_to_weight(23, allow_total=abjad.Less)</span>
<span class="sd">            Sequence([5, -5, -5, 5])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; items = [abjad.NonreducedFraction(3, 16)]</span>
<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(items)</span>
<span class="sd">            &gt;&gt;&gt; weight = abjad.NonreducedFraction(5, 4)</span>
<span class="sd">            &gt;&gt;&gt; sequence = sequence.repeat_to_weight(weight)</span>
<span class="sd">            &gt;&gt;&gt; sum(sequence)</span>
<span class="sd">            NonreducedFraction(20, 16)</span>

<span class="sd">            &gt;&gt;&gt; [_.pair for _ in sequence]</span>
<span class="sd">            [(3, 16), (3, 16), (3, 16), (3, 16), (3, 16), (3, 16), (2, 16)]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">weight</span>
        <span class="k">if</span> <span class="n">allow_total</span> <span class="ow">is</span> <span class="n">enums</span><span class="o">.</span><span class="n">Exact</span><span class="p">:</span>
            <span class="n">sequence_weight</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">complete_repetitions</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">sequence_weight</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">complete_repetitions</span> <span class="o">*</span> <span class="n">items</span>
            <span class="n">overage</span> <span class="o">=</span> <span class="n">complete_repetitions</span> <span class="o">*</span> <span class="n">sequence_weight</span> <span class="o">-</span> <span class="n">weight</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">overage</span><span class="p">:</span>
                    <span class="n">element_weight</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="n">candidate_overage</span> <span class="o">=</span> <span class="n">overage</span> <span class="o">-</span> <span class="n">element_weight</span>
                    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">candidate_overage</span><span class="p">:</span>
                        <span class="n">overage</span> <span class="o">=</span> <span class="n">candidate_overage</span>
                        <span class="n">items</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">absolute_amount_to_keep</span> <span class="o">=</span> <span class="n">element_weight</span> <span class="o">-</span> <span class="n">overage</span>
                        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">absolute_amount_to_keep</span>
                        <span class="n">signed_amount_to_keep</span> <span class="o">=</span> <span class="n">absolute_amount_to_keep</span>
                        <span class="n">signed_amount_to_keep</span> <span class="o">*=</span> <span class="n">_math</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                        <span class="n">items</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">signed_amount_to_keep</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="k">elif</span> <span class="n">allow_total</span> <span class="ow">is</span> <span class="n">enums</span><span class="o">.</span><span class="n">Less</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">weight</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)])</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">weight</span> <span class="o">&lt;</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
                <span class="n">items</span> <span class="o">=</span> <span class="n">items</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">allow_total</span> <span class="ow">is</span> <span class="n">enums</span><span class="o">.</span><span class="n">More</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">weight</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)])</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is not an ordinal value constant: </span><span class="si">{</span><span class="n">allow_total</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.replace"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.replace">[docs]</a>    <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replaces ``old`` with ``new``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence([0, 2, 3, 0, 2, 3, 0, 2, 3])</span>
<span class="sd">            &gt;&gt;&gt; sequence.replace(0, 1)</span>
<span class="sd">            Sequence([1, 2, 3, 1, 2, 3, 1, 2, 3])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">old</span><span class="p">:</span>
                <span class="n">new_copy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_copy</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.replace_at"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.replace_at">[docs]</a>    <span class="k">def</span> <span class="nf">replace_at</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">new_material</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replaces items at ``indices`` with ``new_material``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Replaces items at indices 0, 2, 4, 6:</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">            &gt;&gt;&gt; sequence.replace_at(</span>
<span class="sd">            ...     ([0], 2),</span>
<span class="sd">            ...     ([&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;], None),</span>
<span class="sd">            ...     )</span>
<span class="sd">            Sequence([&#39;A&#39;, 1, &#39;B&#39;, 3, &#39;C&#39;, 5, &#39;D&#39;, 7, 8, 9, 10, 11, 12, 13, 14, 15])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Replaces elements at indices 0, 1, 8, 13:</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">            &gt;&gt;&gt; sequence.replace_at(</span>
<span class="sd">            ...     ([0, 1, 8, 13], None),</span>
<span class="sd">            ...     ([&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;], None),</span>
<span class="sd">            ...     )</span>
<span class="sd">            Sequence([&#39;A&#39;, &#39;B&#39;, 2, 3, 4, 5, 6, 7, &#39;C&#39;, 9, 10, 11, 12, &#39;D&#39;, 14, 15])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Replaces every item at even index:</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">            &gt;&gt;&gt; sequence.replace_at(</span>
<span class="sd">            ...     ([0], 2),</span>
<span class="sd">            ...     ([&#39;*&#39;], 1),</span>
<span class="sd">            ...     )</span>
<span class="sd">            Sequence([&#39;*&#39;, 1, &#39;*&#39;, 3, &#39;*&#39;, 5, &#39;*&#39;, 7, &#39;*&#39;, 9, &#39;*&#39;, 11, &#39;*&#39;, 13, &#39;*&#39;, 15])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Replaces every element at an index congruent to 0 (mod 6) with</span>
<span class="sd">            ``&#39;A&#39;``; replaces every element at an index congruent to 2 (mod 6)</span>
<span class="sd">            with ``&#39;B&#39;``:</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(range(16))</span>
<span class="sd">            &gt;&gt;&gt; sequence.replace_at(</span>
<span class="sd">            ...     ([0], 2),</span>
<span class="sd">            ...     ([&#39;A&#39;, &#39;B&#39;], 3),</span>
<span class="sd">            ...     )</span>
<span class="sd">            Sequence([&#39;A&#39;, 1, &#39;B&#39;, 3, 4, 5, &#39;A&#39;, 7, &#39;B&#39;, 9, 10, 11, &#39;A&#39;, 13, &#39;B&#39;, 15])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">index_values</span><span class="p">,</span> <span class="n">index_period</span> <span class="o">=</span> <span class="n">indices</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_values</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">)</span>
        <span class="n">index_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">index_values</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_period</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_material</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_material</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">material_values</span><span class="p">,</span> <span class="n">material_period</span> <span class="o">=</span> <span class="n">new_material</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">material_values</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">)</span>
        <span class="n">material_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">material_values</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">material_period</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span>
        <span class="n">maxsize</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
        <span class="k">if</span> <span class="n">index_period</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">index_period</span> <span class="o">=</span> <span class="n">maxsize</span>
        <span class="k">if</span> <span class="n">material_period</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">material_period</span> <span class="o">=</span> <span class="n">maxsize</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">material_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">%</span> <span class="n">index_period</span> <span class="ow">in</span> <span class="n">index_values</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cyclic_material_index</span> <span class="o">=</span> <span class="n">material_index</span> <span class="o">%</span> <span class="n">material_period</span>
                    <span class="n">material_value</span> <span class="o">=</span> <span class="n">material_values</span><span class="p">[</span><span class="n">cyclic_material_index</span><span class="p">]</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">material_value</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">material_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span></div>

    <span class="c1"># TODO: remove in favor of self.retain_pattern()</span>
<div class="viewcode-block" id="Sequence.retain"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.retain">[docs]</a>    <span class="k">def</span> <span class="nf">retain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retains items at ``indices``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(range(10))</span>
<span class="sd">            &gt;&gt;&gt; sequence.retain()</span>
<span class="sd">            Sequence([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.retain(indices=[2, 3])</span>
<span class="sd">            Sequence([2, 3])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.retain(indices=[-2, -3])</span>
<span class="sd">            Sequence([7, 8])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.retain(indices=[2, 3], period=4)</span>
<span class="sd">            Sequence([2, 3, 6, 7])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.retain(indices=[-2, -3], period=4)</span>
<span class="sd">            Sequence([0, 3, 4, 7, 8])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.retain(indices=[])</span>
<span class="sd">            Sequence([])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.retain(indices=[97, 98, 99])</span>
<span class="sd">            Sequence([])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.retain(indices=[-97, -98, -99])</span>
<span class="sd">            Sequence([])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">period</span> <span class="o">=</span> <span class="n">period</span> <span class="ow">or</span> <span class="n">length</span>
        <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="n">new_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">length</span> <span class="o">+</span> <span class="n">i</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">period</span>
            <span class="n">new_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">new_indices</span>
        <span class="n">indices</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">period</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.retain_pattern"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.retain_pattern">[docs]</a>    <span class="k">def</span> <span class="nf">retain_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retains items at indices matching ``pattern``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(range(10))</span>
<span class="sd">            &gt;&gt;&gt; sequence.retain_pattern(abjad.index_all())</span>
<span class="sd">            Sequence([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.retain_pattern(abjad.index([2, 3]))</span>
<span class="sd">            Sequence([2, 3])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.retain_pattern(abjad.index([-2, -3]))</span>
<span class="sd">            Sequence([7, 8])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.retain_pattern(abjad.index([2, 3], 4))</span>
<span class="sd">            Sequence([2, 3, 6, 7])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.retain_pattern(abjad.index([-2, -3], 4))</span>
<span class="sd">            Sequence([0, 3, 4, 7, 8])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.retain_pattern(abjad.index([97, 98, 99]))</span>
<span class="sd">            Sequence([])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.retain_pattern(abjad.index([-97, -98, -99]))</span>
<span class="sd">            Sequence([])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">pattern</span><span class="o">.</span><span class="n">matches_index</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.reverse"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.reverse">[docs]</a>    <span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reverses sequence.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Reverses sequence:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence([[1, 2], 3, [4, 5]])</span>

<span class="sd">                &gt;&gt;&gt; sequence.reverse()</span>
<span class="sd">                Sequence([[4, 5], 3, [1, 2]])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Reverses recursively:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; segment_1 = abjad.PitchClassSegment([1, 2])</span>
<span class="sd">                &gt;&gt;&gt; pitch = abjad.NumberedPitch(3)</span>
<span class="sd">                &gt;&gt;&gt; segment_2 = abjad.PitchClassSegment([4, 5])</span>
<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence([segment_1, pitch, segment_2])</span>

<span class="sd">                &gt;&gt;&gt; for item in sequence.reverse(recurse=True):</span>
<span class="sd">                ...     item</span>
<span class="sd">                ...</span>
<span class="sd">                PitchClassSegment([5, 4])</span>
<span class="sd">                NumberedPitch(3)</span>
<span class="sd">                PitchClassSegment([2, 1])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">recurse</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">_reverse_helper</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
                <span class="n">subitems_</span> <span class="o">=</span> <span class="p">[</span><span class="n">_reverse_helper</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">item</span><span class="p">)]</span>
                <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)(</span><span class="n">subitems_</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">item</span>

        <span class="n">items</span> <span class="o">=</span> <span class="n">_reverse_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotates sequence by index ``n``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Rotates sequence to the right:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(10))</span>

<span class="sd">                &gt;&gt;&gt; sequence.rotate(n=4)</span>
<span class="sd">                Sequence([6, 7, 8, 9, 0, 1, 2, 3, 4, 5])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Rotates sequence to the left:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(10))</span>

<span class="sd">                &gt;&gt;&gt; sequence.rotate(n=-3)</span>
<span class="sd">                Sequence([3, 4, 5, 6, 7, 8, 9, 0, 1, 2])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Rotates sequence neither to the right nor the left:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(10))</span>

<span class="sd">                &gt;&gt;&gt; sequence.rotate(n=0)</span>
<span class="sd">                Sequence([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="ow">or</span> <span class="mi">0</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="n">n</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[:</span><span class="o">-</span><span class="n">n</span><span class="p">]:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span>

<div class="viewcode-block" id="Sequence.sort"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.sort">[docs]</a>    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sorts sequence.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence([3, 2, 5, 4, 1, 6])</span>
<span class="sd">            &gt;&gt;&gt; sequence.sort()</span>
<span class="sd">            Sequence([1, 2, 3, 4, 5, 6])</span>

<span class="sd">            &gt;&gt;&gt; sequence</span>
<span class="sd">            Sequence([3, 2, 5, 4, 1, 6])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">items</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.split"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.split">[docs]</a>    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Splits sequence by ``weights``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Splits sequence cyclically by weights with overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence([10, -10, 10, -10])</span>

<span class="sd">                &gt;&gt;&gt; for part in sequence.split(</span>
<span class="sd">                ...     (3, 15, 3),</span>
<span class="sd">                ...     cyclic=True,</span>
<span class="sd">                ...     overhang=True,</span>
<span class="sd">                ...     ):</span>
<span class="sd">                ...     part</span>
<span class="sd">                ...</span>
<span class="sd">                Sequence([3])</span>
<span class="sd">                Sequence([7, -8])</span>
<span class="sd">                Sequence([-2, 1])</span>
<span class="sd">                Sequence([3])</span>
<span class="sd">                Sequence([6, -9])</span>
<span class="sd">                Sequence([-1])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Splits sequence once by weights with overhang:</span>

<span class="sd">            &gt;&gt;&gt; for part in sequence.split(</span>
<span class="sd">            ...     (3, 15, 3),</span>
<span class="sd">            ...     cyclic=False,</span>
<span class="sd">            ...     overhang=True,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     part</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([3])</span>
<span class="sd">            Sequence([7, -8])</span>
<span class="sd">            Sequence([-2, 1])</span>
<span class="sd">            Sequence([9, -10])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Splits sequence once by weights without overhang:</span>

<span class="sd">            &gt;&gt;&gt; for part in sequence.split(</span>
<span class="sd">            ...     (3, 15, 3),</span>
<span class="sd">            ...     cyclic=False,</span>
<span class="sd">            ...     overhang=False,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     part</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([3])</span>
<span class="sd">            Sequence([7, -8])</span>
<span class="sd">            Sequence([-2, 1])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            REGRESSION. Splits sequence of nonreduced fractions cyclically by</span>
<span class="sd">            weights with overhang:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence([</span>
<span class="sd">                ...     abjad.NonreducedFraction(20, 2),</span>
<span class="sd">                ...     abjad.NonreducedFraction(-20, 2),</span>
<span class="sd">                ...     abjad.NonreducedFraction(20, 2),</span>
<span class="sd">                ...     abjad.NonreducedFraction(-20, 2),</span>
<span class="sd">                ... ])</span>

<span class="sd">                &gt;&gt;&gt; for part in sequence.split(</span>
<span class="sd">                ...     (3, 15, 3),</span>
<span class="sd">                ...     cyclic=True,</span>
<span class="sd">                ...     overhang=True,</span>
<span class="sd">                ...     ):</span>
<span class="sd">                ...     part</span>
<span class="sd">                ...</span>
<span class="sd">                Sequence([NonreducedFraction(6, 2)])</span>
<span class="sd">                Sequence([NonreducedFraction(14, 2), NonreducedFraction(-16, 2)])</span>
<span class="sd">                Sequence([NonreducedFraction(-4, 2), NonreducedFraction(2, 2)])</span>
<span class="sd">                Sequence([NonreducedFraction(6, 2)])</span>
<span class="sd">                Sequence([NonreducedFraction(12, 2), NonreducedFraction(-18, 2)])</span>
<span class="sd">                Sequence([NonreducedFraction(-2, 2)])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">current_piece</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">cyclic</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">repeat_to_weight</span><span class="p">(</span>
                <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">allow_total</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">Less</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">:</span>
            <span class="n">current_piece_weight</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">current_piece</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">current_piece_weight</span> <span class="o">&lt;</span> <span class="n">weight</span><span class="p">:</span>
                <span class="n">current_piece</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">current_index</span><span class="p">])</span>
                <span class="n">current_index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">current_piece_weight</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">current_piece</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">current_piece_weight</span> <span class="o">==</span> <span class="n">weight</span><span class="p">:</span>
                <span class="n">current_piece_</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">current_piece</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_piece_</span><span class="p">)</span>
                <span class="n">current_piece</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="n">weight</span> <span class="o">&lt;</span> <span class="n">current_piece_weight</span><span class="p">:</span>
                <span class="n">overage</span> <span class="o">=</span> <span class="n">current_piece_weight</span> <span class="o">-</span> <span class="n">weight</span>
                <span class="n">current_last_element</span> <span class="o">=</span> <span class="n">current_piece</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">needed</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">current_last_element</span><span class="p">)</span> <span class="o">-</span> <span class="n">overage</span>
                <span class="n">needed</span> <span class="o">*=</span> <span class="n">_math</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">current_last_element</span><span class="p">)</span>
                <span class="n">current_piece</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">needed</span><span class="p">)</span>
                <span class="n">current_piece_</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">current_piece</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_piece_</span><span class="p">)</span>
                <span class="n">overage</span> <span class="o">*=</span> <span class="n">_math</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">current_last_element</span><span class="p">)</span>
                <span class="n">current_piece</span> <span class="o">=</span> <span class="p">[</span><span class="n">overage</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">overhang</span><span class="p">:</span>
            <span class="n">last_piece</span> <span class="o">=</span> <span class="n">current_piece</span>
            <span class="n">last_piece</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">current_index</span><span class="p">:])</span>
            <span class="k">if</span> <span class="n">last_piece</span><span class="p">:</span>
                <span class="n">last_piece_</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">last_piece</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_piece_</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.sum"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.sum">[docs]</a>    <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sums sequence.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Sums sequence of positive numbers:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])</span>

<span class="sd">                &gt;&gt;&gt; sequence.sum()</span>
<span class="sd">                55</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Sum sequence of numbers with mixed signs:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence([-1, 2, -3, 4, -5, 6, -7, 8, -9, 10])</span>

<span class="sd">                &gt;&gt;&gt; sequence.sum()</span>
<span class="sd">                5</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Sums sequence and wraps result in new sequence:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(range(1, 10+1))</span>
<span class="sd">                &gt;&gt;&gt; result = sequence.sum()</span>
<span class="sd">                &gt;&gt;&gt; sequence = abjad.Sequence(result)</span>

<span class="sd">                &gt;&gt;&gt; sequence</span>
<span class="sd">                Sequence([55])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">item</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Sequence.sum_by_sign"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.sum_by_sign">[docs]</a>    <span class="k">def</span> <span class="nf">sum_by_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sums consecutive sequence items by ``sign``.</span>

<span class="sd">        &gt;&gt;&gt; items = [0, 0, -1, -1, 2, 3, -5, 1, 2, 5, -5, -6]</span>
<span class="sd">        &gt;&gt;&gt; sequence = abjad.Sequence(items)</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.sum_by_sign()</span>
<span class="sd">            Sequence([0, -2, 5, -5, 8, -11])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.sum_by_sign(sign=[-1])</span>
<span class="sd">            Sequence([0, 0, -2, 2, 3, -5, 1, 2, 5, -11])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.sum_by_sign(sign=[0])</span>
<span class="sd">            Sequence([0, -1, -1, 2, 3, -5, 1, 2, 5, -5, -6])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.sum_by_sign(sign=[1])</span>
<span class="sd">            Sequence([0, 0, -1, -1, 5, -5, 8, -5, -6])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.sum_by_sign(sign=[-1, 0])</span>
<span class="sd">            Sequence([0, -2, 2, 3, -5, 1, 2, 5, -11])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.sum_by_sign(sign=[-1, 1])</span>
<span class="sd">            Sequence([0, 0, -2, 5, -5, 8, -11])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.sum_by_sign(sign=[0, 1])</span>
<span class="sd">            Sequence([0, -1, -1, 5, -5, 8, -5, -6])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence.sum_by_sign(sign=[-1, 0, 1])</span>
<span class="sd">            Sequence([0, -2, 5, -5, 8, -11])</span>

<span class="sd">        Sumsn consecutive negative elements when ``-1`` in ``sign``.</span>

<span class="sd">        Sums consecutive zero-valued elements when ``0`` in ``sign``.</span>

<span class="sd">        Sums consecutive positive elements when ``1`` in ``sign``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">generator</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_math</span><span class="o">.</span><span class="n">sign</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">current_sign</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">generator</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_sign</span> <span class="ow">in</span> <span class="n">sign</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">group</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.truncate"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.truncate">[docs]</a>    <span class="k">def</span> <span class="nf">truncate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sum_</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Truncates sequence.</span>

<span class="sd">        &gt;&gt;&gt; sequence = abjad.Sequence([-1, 2, -3, 4, -5, 6, -7, 8, -9, 10])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Truncates sequence to weights ranging from 1 to 10:</span>

<span class="sd">            &gt;&gt;&gt; for weight in range(1, 11):</span>
<span class="sd">            ...     result = sequence.truncate(weight=weight)</span>
<span class="sd">            ...     print(weight, result)</span>
<span class="sd">            ...</span>
<span class="sd">            1 Sequence([-1])</span>
<span class="sd">            2 Sequence([-1, 1])</span>
<span class="sd">            3 Sequence([-1, 2])</span>
<span class="sd">            4 Sequence([-1, 2, -1])</span>
<span class="sd">            5 Sequence([-1, 2, -2])</span>
<span class="sd">            6 Sequence([-1, 2, -3])</span>
<span class="sd">            7 Sequence([-1, 2, -3, 1])</span>
<span class="sd">            8 Sequence([-1, 2, -3, 2])</span>
<span class="sd">            9 Sequence([-1, 2, -3, 3])</span>
<span class="sd">            10 Sequence([-1, 2, -3, 4])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Truncates sequence to sums ranging from 1 to 10:</span>

<span class="sd">            &gt;&gt;&gt; for sum_ in range(1, 11):</span>
<span class="sd">            ...     result = sequence.truncate(sum_=sum_)</span>
<span class="sd">            ...     print(sum_, result)</span>
<span class="sd">            ...</span>
<span class="sd">            1 Sequence([-1, 2])</span>
<span class="sd">            2 Sequence([-1, 2, -3, 4])</span>
<span class="sd">            3 Sequence([-1, 2, -3, 4, -5, 6])</span>
<span class="sd">            4 Sequence([-1, 2, -3, 4, -5, 6, -7, 8])</span>
<span class="sd">            5 Sequence([-1, 2, -3, 4, -5, 6, -7, 8, -9, 10])</span>
<span class="sd">            6 Sequence([-1, 2, -3, 4, -5, 6, -7, 8, -9, 10])</span>
<span class="sd">            7 Sequence([-1, 2, -3, 4, -5, 6, -7, 8, -9, 10])</span>
<span class="sd">            8 Sequence([-1, 2, -3, 4, -5, 6, -7, 8, -9, 10])</span>
<span class="sd">            9 Sequence([-1, 2, -3, 4, -5, 6, -7, 8, -9, 10])</span>
<span class="sd">            10 Sequence([-1, 2, -3, 4, -5, 6, -7, 8, -9, 10])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Truncates sequence to zero weight:</span>

<span class="sd">            &gt;&gt;&gt; sequence.truncate(weight=0)</span>
<span class="sd">            Sequence([])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Truncates sequence to zero sum:</span>

<span class="sd">            &gt;&gt;&gt; sequence.truncate(sum_=0)</span>
<span class="sd">            Sequence([])</span>

<span class="sd">        Ignores ``sum`` when ``weight`` and ``sum`` are both set.</span>

<span class="sd">        Raises value error on negative ``sum``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">weight</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">weight</span><span class="p">:</span>
                <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="n">total</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">total</span> <span class="o">&lt;</span> <span class="n">weight</span><span class="p">:</span>
                        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sign</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                        <span class="n">trimmed_part</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">-</span> <span class="n">_math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
                        <span class="n">trimmed_part</span> <span class="o">*=</span> <span class="n">sign</span>
                        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trimmed_part</span><span class="p">)</span>
                        <span class="k">break</span>
        <span class="k">elif</span> <span class="n">sum_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">sum_</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">sum_</span><span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">sum_</span><span class="p">:</span>
                <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="n">total</span> <span class="o">+=</span> <span class="n">item</span>
                    <span class="k">if</span> <span class="n">total</span> <span class="o">&lt;</span> <span class="n">sum_</span><span class="p">:</span>
                        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
                        <span class="k">break</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.weight"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.weight">[docs]</a>    <span class="k">def</span> <span class="nf">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets weight.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([]).weight()</span>
<span class="sd">            0</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([1]).weight()</span>
<span class="sd">            1</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([1, 2, 3]).weight()</span>
<span class="sd">            6</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([1, 2, -3]).weight()</span>
<span class="sd">            6</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([-1, -2, -3]).weight()</span>
<span class="sd">            6</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence([-1, 2, -3, 4, -5, 6, -7, 8, -9, 10])</span>
<span class="sd">            &gt;&gt;&gt; sequence.weight()</span>
<span class="sd">            55</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; abjad.Sequence([[1, -7, -7], [1, -8 -8]]).weight()</span>
<span class="sd">            32</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">):</span>
                <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">weight</span><span class="p">())</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">weight</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.zip"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.zip">[docs]</a>    <span class="k">def</span> <span class="nf">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Zips sequences in sequence.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Zips cyclically:</span>

<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence([[1, 2, 3], [&#39;a&#39;, &#39;b&#39;]])</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence.zip(cyclic=True):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([1, &#39;a&#39;])</span>
<span class="sd">            Sequence([2, &#39;b&#39;])</span>
<span class="sd">            Sequence([3, &#39;a&#39;])</span>

<span class="sd">            &gt;&gt;&gt; items = [[10, 11, 12], [20, 21], [30, 31, 32, 33]]</span>
<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(items)</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence.zip(cyclic=True):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([10, 20, 30])</span>
<span class="sd">            Sequence([11, 21, 31])</span>
<span class="sd">            Sequence([12, 20, 32])</span>
<span class="sd">            Sequence([10, 21, 33])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Zips without truncation:</span>

<span class="sd">            &gt;&gt;&gt; items = [[1, 2, 3, 4], [11, 12, 13], [21, 22, 23]]</span>
<span class="sd">            &gt;&gt;&gt; sequence = abjad.Sequence(items)</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence.zip(truncate=False):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([1, 11, 21])</span>
<span class="sd">            Sequence([2, 12, 22])</span>
<span class="sd">            Sequence([3, 13, 23])</span>
<span class="sd">            Sequence([4])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Zips strictly:</span>

<span class="sd">            &gt;&gt;&gt; items = [[1, 2, 3, 4], [11, 12, 13], [21, 22, 23]]</span>
<span class="sd">            &gt;&gt;&gt; for item in abjad.Sequence(items).zip():</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([1, 11, 21])</span>
<span class="sd">            Sequence([2, 12, 22])</span>
<span class="sd">            Sequence([3, 13, 23])</span>

<span class="sd">        Returns nested sequence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;must by iterable: </span><span class="si">{</span><span class="n">item</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">items</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">cyclic</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span>
            <span class="n">maximum_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maximum_length</span><span class="p">):</span>
                <span class="n">part</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="n">element</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                    <span class="n">part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                <span class="n">part_</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">part</span><span class="p">)</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part_</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">truncate</span><span class="p">:</span>
            <span class="n">maximum_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maximum_length</span><span class="p">):</span>
                <span class="n">part</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="n">part_</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">part</span><span class="p">)</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part_</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">truncate</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">item</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2018-2021, Gregory Rowland Evans
      <span class="lastupdated">
        Last updated on Jun 03, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>