

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>baca.classes &mdash; Perllan API 0.3 documentation</title>
  

  
  <link rel="stylesheet" href="../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../static/abjad.css" type="text/css" />
  <link rel="stylesheet" href="../../static/uqbar.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../static/notes.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../static/documentation_options.js"></script>
        <script src="../../static/jquery.js"></script>
        <script src="../../static/underscore.js"></script>
        <script src="../../static/doctools.js"></script>
        <script defer="defer" src="../../static/copybutton.js"></script>
        <script src="../../static/ga.js"></script>
    
    <script type="text/javascript" src="../../static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #556B2F" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Perllan API
          

          
            
            <img src="../../static/perllan-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts.html">Core concepts</a></li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/abjadext/microtones/index.html">microtones</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/evans/index.html">evans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/tsmakers/index.html">tsmakers</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../scores.html">Score gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../recipes_pitch.html">Pitch Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../recipes_sequence.html">Sequence Recipes</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Perllan API</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>baca.classes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for baca.classes</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">typing</span>

<span class="kn">import</span> <span class="nn">uqbar</span>

<span class="kn">import</span> <span class="nn">abjad</span>

<span class="c1">### CLASSES ###</span>


<span class="k">class</span> <span class="nc">Counter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Counter.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Initializes to zero and increments by 1:</span>

<span class="sd">        &gt;&gt;&gt; counter = baca.Counter(start=0)</span>
<span class="sd">        &gt;&gt;&gt; counter.start, counter.current</span>
<span class="sd">        (0, 0)</span>

<span class="sd">        &gt;&gt;&gt; counter(count=1), counter.current</span>
<span class="sd">        (1, 1)</span>
<span class="sd">        &gt;&gt;&gt; counter(count=1), counter.current</span>
<span class="sd">        (1, 2)</span>
<span class="sd">        &gt;&gt;&gt; counter(count=1), counter.current</span>
<span class="sd">        (1, 3)</span>
<span class="sd">        &gt;&gt;&gt; counter(count=1), counter.current</span>
<span class="sd">        (1, 4)</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Initializes to zero and increments by 2:</span>

<span class="sd">        &gt;&gt;&gt; counter = baca.Counter(start=0)</span>
<span class="sd">        &gt;&gt;&gt; counter.start, counter.current</span>
<span class="sd">        (0, 0)</span>

<span class="sd">        &gt;&gt;&gt; counter(2), counter.current</span>
<span class="sd">        (2, 2)</span>
<span class="sd">        &gt;&gt;&gt; counter(2), counter.current</span>
<span class="sd">        (2, 4)</span>
<span class="sd">        &gt;&gt;&gt; counter(2), counter.current</span>
<span class="sd">        (2, 6)</span>
<span class="sd">        &gt;&gt;&gt; counter(2), counter.current</span>
<span class="sd">        (2, 8)</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Initializes to 10 and increments by different values:</span>

<span class="sd">        &gt;&gt;&gt; counter = baca.Counter(start=10)</span>
<span class="sd">        &gt;&gt;&gt; counter.start, counter.current</span>
<span class="sd">        (10, 10)</span>

<span class="sd">        &gt;&gt;&gt; counter(3), counter.current</span>
<span class="sd">        (3, 13)</span>
<span class="sd">        &gt;&gt;&gt; counter(-6), counter.current</span>
<span class="sd">        (-6, 7)</span>
<span class="sd">        &gt;&gt;&gt; counter(5.5), counter.current</span>
<span class="sd">        (5.5, 12.5)</span>
<span class="sd">        &gt;&gt;&gt; counter(-2), counter.current</span>
<span class="sd">        (-2, 10.5)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">### CLASS VARIABLES ###</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_current&quot;</span><span class="p">,</span> <span class="s2">&quot;_start&quot;</span><span class="p">)</span>

    <span class="c1">### INITIALIZER ###</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current</span> <span class="o">=</span> <span class="n">start</span>

    <span class="c1">### SPECIAL METHODS ###</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls counter.</span>

<span class="sd">        Returns new value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">+</span> <span class="n">count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current</span> <span class="o">=</span> <span class="n">current</span>
        <span class="k">return</span> <span class="n">count</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets interpreter representation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">abjad</span><span class="o">.</span><span class="n">StorageFormatManager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_repr_format</span><span class="p">()</span>

    <span class="c1">### PUBLIC PROPERTIES ###</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets current value.</span>

<span class="sd">        Returns integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets start value.</span>

<span class="sd">        Set to integer.</span>

<span class="sd">        Returns integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span>


<span class="k">class</span> <span class="nc">Cursor</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cursor.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Gets elements one at a time:</span>

<span class="sd">        &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">        &gt;&gt;&gt; cursor = baca.Cursor(source=source, cyclic=True)</span>

<span class="sd">        &gt;&gt;&gt; cursor.next()</span>
<span class="sd">        [13]</span>
<span class="sd">        &gt;&gt;&gt; cursor.next()</span>
<span class="sd">        [&#39;da capo&#39;]</span>
<span class="sd">        &gt;&gt;&gt; cursor.next()</span>
<span class="sd">        [Note(&quot;cs&#39;8.&quot;)]</span>
<span class="sd">        &gt;&gt;&gt; cursor.next()</span>
<span class="sd">        [&#39;rit.&#39;]</span>
<span class="sd">        &gt;&gt;&gt; cursor.next()</span>
<span class="sd">        [13]</span>
<span class="sd">        &gt;&gt;&gt; cursor.next()</span>
<span class="sd">        [&#39;da capo&#39;]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Gets different numbers of elements at a time:</span>

<span class="sd">        &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">        &gt;&gt;&gt; cursor = baca.Cursor(source=source, cyclic=True)</span>

<span class="sd">        &gt;&gt;&gt; cursor.next(count=2)</span>
<span class="sd">        [13, &#39;da capo&#39;]</span>
<span class="sd">        &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">        [&#39;da capo&#39;]</span>
<span class="sd">        &gt;&gt;&gt; cursor.next(count=2)</span>
<span class="sd">        [&#39;da capo&#39;, Note(&quot;cs&#39;8.&quot;)]</span>
<span class="sd">        &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">        [Note(&quot;cs&#39;8.&quot;)]</span>
<span class="sd">        &gt;&gt;&gt; cursor.next(count=2)</span>
<span class="sd">        [Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">        &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">        [&#39;rit.&#39;]</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">### CLASS VARIABLES ###</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;_cyclic&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_lone_items&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_position&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_singletons&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_source&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_suppress_exception&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1">### INITIALIZER ###</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">cyclic</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">singletons</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">suppress_exception</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">cyclic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cyclic</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">cyclic</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cyclic</span> <span class="o">=</span> <span class="n">cyclic</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">source</span> <span class="ow">or</span> <span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cyclic</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">CyclicTuple</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source</span> <span class="o">=</span> <span class="n">source</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="o">=</span> <span class="n">position</span>
        <span class="k">if</span> <span class="n">singletons</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">singletons</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">singletons</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_singletons</span> <span class="o">=</span> <span class="n">singletons</span>
        <span class="k">if</span> <span class="n">suppress_exception</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">suppress_exception</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">suppress_exception</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_suppress_exception</span> <span class="o">=</span> <span class="n">suppress_exception</span>

    <span class="c1">### SPECIAL METHODS ###</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when ``argument`` is a cursor with keyword</span>
<span class="sd">        arguments equal to this cursor.</span>

<span class="sd">        Returns true or false.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets item from cursor.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(source=source, cyclic=True)</span>

<span class="sd">            &gt;&gt;&gt; cursor[0]</span>
<span class="sd">            13</span>

<span class="sd">            &gt;&gt;&gt; cursor[:2]</span>
<span class="sd">            (13, &#39;da capo&#39;)</span>

<span class="sd">            &gt;&gt;&gt; cursor[-1]</span>
<span class="sd">            &#39;rit.&#39;</span>

<span class="sd">        Returns item or slice.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hashes cursor.</span>

<span class="sd">        Required to be explicitly redefined on Python 3 if __eq__ changes.</span>

<span class="sd">        Returns integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates cursor.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Iterates acyclic cursor:</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(source=source)</span>
<span class="sd">            &gt;&gt;&gt; for item in cursor:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            13</span>
<span class="sd">            &#39;da capo&#39;</span>
<span class="sd">            Note(&quot;cs&#39;8.&quot;)</span>
<span class="sd">            &#39;rit.&#39;</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Iterates cyclic cursor:</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(source=source, cyclic=True)</span>
<span class="sd">            &gt;&gt;&gt; for item in cursor:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            13</span>
<span class="sd">            &#39;da capo&#39;</span>
<span class="sd">            Note(&quot;cs&#39;8.&quot;)</span>
<span class="sd">            &#39;rit.&#39;</span>

<span class="sd">        Returns generator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets length of cursor.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(source=source)</span>
<span class="sd">            &gt;&gt;&gt; len(cursor)</span>
<span class="sd">            4</span>

<span class="sd">        Defined equal to length of cursor source.</span>

<span class="sd">        Returns nonnegative integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets interpreter representation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">abjad</span><span class="o">.</span><span class="n">StorageFormatManager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_repr_format</span><span class="p">()</span>

    <span class="c1">### PUBLIC PROPERTIES ###</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cyclic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when cursor is cyclic.</span>

<span class="sd">        Set to true, false or none.</span>

<span class="sd">        Defaults to none.</span>

<span class="sd">        Returns true, false or none.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cyclic</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_exhausted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when cursor is exhausted.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(source=source)</span>
<span class="sd">            &gt;&gt;&gt; cursor.is_exhausted</span>
<span class="sd">            False</span>

<span class="sd">            &gt;&gt;&gt; cursor.next(), cursor.is_exhausted</span>
<span class="sd">            ([13], False)</span>

<span class="sd">            &gt;&gt;&gt; cursor.next(), cursor.is_exhausted</span>
<span class="sd">            ([&#39;da capo&#39;], False)</span>

<span class="sd">            &gt;&gt;&gt; cursor.next(), cursor.is_exhausted</span>
<span class="sd">            ([Note(&quot;cs&#39;8.&quot;)], False)</span>

<span class="sd">            &gt;&gt;&gt; cursor.next(), cursor.is_exhausted</span>
<span class="sd">            ([&#39;rit.&#39;], True)</span>

<span class="sd">        Returns true or false.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets position.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Position starts at none by default:</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(source=source, cyclic=True)</span>

<span class="sd">            &gt;&gt;&gt; cursor.position is None</span>
<span class="sd">            True</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [13]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [&#39;da capo&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [Note(&quot;cs&#39;8.&quot;)]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [&#39;rit.&#39;]</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(</span>
<span class="sd">            ...     source=source,</span>
<span class="sd">            ...     cyclic=True,</span>
<span class="sd">            ...     position=None,</span>
<span class="sd">            ...     )</span>

<span class="sd">            &gt;&gt;&gt; cursor.position is None</span>
<span class="sd">            True</span>

<span class="sd">            &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">            [&#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">            [Note(&quot;cs&#39;8.&quot;)]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">            [&#39;da capo&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">            [13]</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Position starting at 0:</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(</span>
<span class="sd">            ...     source=source,</span>
<span class="sd">            ...     cyclic=True,</span>
<span class="sd">            ...     position=0,</span>
<span class="sd">            ...     )</span>

<span class="sd">            &gt;&gt;&gt; cursor.position</span>
<span class="sd">            0</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [13]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [&#39;da capo&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [Note(&quot;cs&#39;8.&quot;)]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [&#39;rit.&#39;]</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(</span>
<span class="sd">            ...     source=source,</span>
<span class="sd">            ...     cyclic=True,</span>
<span class="sd">            ...     position=0,</span>
<span class="sd">            ...     )</span>

<span class="sd">            &gt;&gt;&gt; cursor.position</span>
<span class="sd">            0</span>

<span class="sd">            &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">            [&#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">            [Note(&quot;cs&#39;8.&quot;)]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">            [&#39;da capo&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">            [13]</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Position starting at -1:</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(</span>
<span class="sd">            ...     source=source,</span>
<span class="sd">            ...     cyclic=True,</span>
<span class="sd">            ...     position=-1,</span>
<span class="sd">            ...     )</span>

<span class="sd">            &gt;&gt;&gt; cursor.position</span>
<span class="sd">            -1</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [&#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [13]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [&#39;da capo&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [Note(&quot;cs&#39;8.&quot;)]</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(</span>
<span class="sd">            ...     source=source,</span>
<span class="sd">            ...     cyclic=True,</span>
<span class="sd">            ...     position=-1,</span>
<span class="sd">            ...     )</span>

<span class="sd">            &gt;&gt;&gt; cursor.position</span>
<span class="sd">            -1</span>

<span class="sd">            &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">            [Note(&quot;cs&#39;8.&quot;)]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">            [&#39;da capo&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">            [13]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">            [&#39;rit.&#39;]</span>

<span class="sd">        Returns tuple.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">singletons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when cursor returns singletons not enclosed within a list.</span>
<span class="sd">        If false when cursor returns singletons enclosed within a list.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Returns singletons enclosed within a list:</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(</span>
<span class="sd">            ...     source=source,</span>
<span class="sd">            ...     suppress_exception=True,</span>
<span class="sd">            ...     )</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [13]</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [&#39;da capo&#39;]</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [Note(&quot;cs&#39;8.&quot;)]</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [&#39;rit.&#39;]</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            []</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            []</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Returns singletons free of enclosing list:</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(</span>
<span class="sd">            ...     source=source,</span>
<span class="sd">            ...     singletons=True,</span>
<span class="sd">            ...     suppress_exception=True,</span>
<span class="sd">            ...     )</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            13</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            &#39;da capo&#39;</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            Note(&quot;cs&#39;8.&quot;)</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            &#39;rit.&#39;</span>

<span class="sd">            &gt;&gt;&gt; cursor.next() is None</span>
<span class="sd">            True</span>

<span class="sd">            &gt;&gt;&gt; cursor.next() is None</span>
<span class="sd">            True</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_singletons</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets source.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            List source:</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(source=source)</span>

<span class="sd">            &gt;&gt;&gt; cursor.source</span>
<span class="sd">            [13, &#39;da capo&#39;, Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Cyclic tuple source:</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(source=source, cyclic=True)</span>

<span class="sd">            &gt;&gt;&gt; cursor.source</span>
<span class="sd">            CyclicTuple([13, &#39;da capo&#39;, Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;])</span>

<span class="sd">        Returns source.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">suppress_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when cursor returns none on exhaustion.</span>
<span class="sd">        Is false when cursor raises exception on exhaustion.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Exhausted cursor raises exception:</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(source=source)</span>
<span class="sd">            &gt;&gt;&gt; cursor.is_exhausted</span>
<span class="sd">            False</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [13]</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [&#39;da capo&#39;]</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [Note(&quot;cs&#39;8.&quot;)]</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [&#39;rit.&#39;]</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            Traceback (most recent call last):</span>
<span class="sd">                ...</span>
<span class="sd">            Exception: cursor only 4.</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            Traceback (most recent call last):</span>
<span class="sd">                ...</span>
<span class="sd">            Exception: cursor only 4.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Exhausted cursor returns none:</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(</span>
<span class="sd">            ...     source=source,</span>
<span class="sd">            ...     suppress_exception=True,</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; cursor.is_exhausted</span>
<span class="sd">            False</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [13]</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [&#39;da capo&#39;]</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [Note(&quot;cs&#39;8.&quot;)]</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [&#39;rit.&#39;]</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            []</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            []</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_suppress_exception</span>

    <span class="c1">### PUBLIC METHODS ###</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_pitch_class_segments</span><span class="p">(</span><span class="n">pitch_class_segments</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes cursor from ``pitch_class_segments``</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Makes cursor from pitch-class segments:</span>

<span class="sd">            &gt;&gt;&gt; number_lists = [[13, 13.5, 11], [-2, 2, 1.5]]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor.from_pitch_class_segments(</span>
<span class="sd">            ...     number_lists,</span>
<span class="sd">            ...     )</span>

<span class="sd">            &gt;&gt;&gt; string = abjad.storage(cursor)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            baca.Cursor(</span>
<span class="sd">                source=abjad.CyclicTuple(</span>
<span class="sd">                    [</span>
<span class="sd">                        abjad.PitchClassSegment(</span>
<span class="sd">                            (</span>
<span class="sd">                                abjad.NumberedPitchClass(1),</span>
<span class="sd">                                abjad.NumberedPitchClass(1.5),</span>
<span class="sd">                                abjad.NumberedPitchClass(11),</span>
<span class="sd">                                ),</span>
<span class="sd">                            item_class=abjad.NumberedPitchClass,</span>
<span class="sd">                            ),</span>
<span class="sd">                        abjad.PitchClassSegment(</span>
<span class="sd">                            (</span>
<span class="sd">                                abjad.NumberedPitchClass(10),</span>
<span class="sd">                                abjad.NumberedPitchClass(2),</span>
<span class="sd">                                abjad.NumberedPitchClass(1.5),</span>
<span class="sd">                                ),</span>
<span class="sd">                            item_class=abjad.NumberedPitchClass,</span>
<span class="sd">                            ),</span>
<span class="sd">                        ]</span>
<span class="sd">                    ),</span>
<span class="sd">                cyclic=True,</span>
<span class="sd">                )</span>

<span class="sd">        Coerces numeric ``pitch_class_segments``</span>

<span class="sd">        Returns cursor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pitch_class_segment</span> <span class="ow">in</span> <span class="n">pitch_class_segments</span><span class="p">:</span>
            <span class="n">pitch_class_segment</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">PitchClassSegment</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="n">pitch_class_segment</span><span class="p">)</span>
            <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pitch_class_segment</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">cells</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cursor</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">exhausted</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets next ``count`` elements in source.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets elements one at a time:</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(source=source, cyclic=True)</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [13]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [&#39;da capo&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [Note(&quot;cs&#39;8.&quot;)]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [&#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [13]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [&#39;da capo&#39;]</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets elements one at a time in reverse:</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(source=source, cyclic=True)</span>

<span class="sd">            &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">            [&#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">            [Note(&quot;cs&#39;8.&quot;)]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">            [&#39;da capo&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">            [13]</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets same two elements forward and back:</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(source=source, cyclic=True)</span>

<span class="sd">            &gt;&gt;&gt; cursor.next(count=2)</span>
<span class="sd">            [13, &#39;da capo&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-2)</span>
<span class="sd">            [&#39;da capo&#39;, 13]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=2)</span>
<span class="sd">            [13, &#39;da capo&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-2)</span>
<span class="sd">            [&#39;da capo&#39;, 13]</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets different numbers of elements at a time:</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(source=source, cyclic=True)</span>

<span class="sd">            &gt;&gt;&gt; cursor.next(count=2)</span>
<span class="sd">            [13, &#39;da capo&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">            [&#39;da capo&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=2)</span>
<span class="sd">            [&#39;da capo&#39;, Note(&quot;cs&#39;8.&quot;)]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">            [Note(&quot;cs&#39;8.&quot;)]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=2)</span>
<span class="sd">            [Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-1)</span>
<span class="sd">            [&#39;rit.&#39;]</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets different numbers of elements at a time:</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(source=source, cyclic=True)</span>

<span class="sd">            &gt;&gt;&gt; cursor.next(count=2)</span>
<span class="sd">            [13, &#39;da capo&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-3)</span>
<span class="sd">            [&#39;da capo&#39;, 13, &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=2)</span>
<span class="sd">            [&#39;rit.&#39;, 13]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-3)</span>
<span class="sd">            [13, &#39;rit.&#39;, Note(&quot;cs&#39;8.&quot;)]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=2)</span>
<span class="sd">            [Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next(count=-3)</span>
<span class="sd">            [&#39;rit.&#39;, Note(&quot;cs&#39;8.&quot;), &#39;da capo&#39;]</span>

<span class="sd">        ..  container:: example exception</span>

<span class="sd">            Raises exception when cursor is exhausted:</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(source=source)</span>

<span class="sd">            &gt;&gt;&gt; cursor.next(count=99)</span>
<span class="sd">            Traceback (most recent call last):</span>
<span class="sd">                ...</span>
<span class="sd">            Exception: cursor only 4.</span>

<span class="sd">        Returns tuple.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">]</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">suppress_exception</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cursor only </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">count</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">]</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">suppress_exception</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cursor only </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">singletons</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">exhausted</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exhausted</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cusor not exhausted: </span><span class="si">{</span><span class="bp">self</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets cursor.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; source = [13, &#39;da capo&#39;, abjad.Note(&quot;cs&#39;8.&quot;), &#39;rit.&#39;]</span>
<span class="sd">            &gt;&gt;&gt; cursor = baca.Cursor(source=source)</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [13]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [&#39;da capo&#39;]</span>

<span class="sd">            &gt;&gt;&gt; cursor.reset()</span>

<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [13]</span>
<span class="sd">            &gt;&gt;&gt; cursor.next()</span>
<span class="sd">            [&#39;da capo&#39;]</span>

<span class="sd">        Returns none.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="o">=</span> <span class="mi">0</span>


<span class="k">class</span> <span class="nc">PaddedTuple</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Padded tuple.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; tuple_ = baca.PaddedTuple(&#39;abcd&#39;, pad=2)</span>

<span class="sd">        &gt;&gt;&gt; tuple_</span>
<span class="sd">        PaddedTuple([&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;], pad=2)</span>

<span class="sd">        &gt;&gt;&gt; for i in range(8):</span>
<span class="sd">        ...     print(i, tuple_[i])</span>
<span class="sd">        ...</span>
<span class="sd">        0 a</span>
<span class="sd">        1 b</span>
<span class="sd">        2 c</span>
<span class="sd">        3 d</span>
<span class="sd">        4 c</span>
<span class="sd">        5 d</span>
<span class="sd">        6 c</span>
<span class="sd">        7 d</span>

<span class="sd">    Padded tuples overload the item-getting method of built-in tuples.</span>

<span class="sd">    Padded tuples return a value for any integer index.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">### CLASS VARIABLES ###</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_items&quot;</span><span class="p">,</span> <span class="s2">&quot;_pad&quot;</span><span class="p">)</span>

    <span class="c1">### INITIALIZER ###</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pad</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">items</span> <span class="ow">or</span> <span class="p">()</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span> <span class="o">=</span> <span class="n">items</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pad</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">pad</span><span class="p">)</span>
        <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">pad</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">pad</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pad</span> <span class="o">=</span> <span class="n">pad</span>

    <span class="c1">### SPECIAL METHODS ###</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when padded tuple contains ``item``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when ``argument`` is a tuple with ``items`` and ``pad`` equal</span>
<span class="sd">        to those of this padded tuple.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">==</span> <span class="n">argument</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">==</span> <span class="n">argument</span><span class="o">.</span><span class="n">_items</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets item or slice identified by ``argument``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets slice open at right:</span>

<span class="sd">            &gt;&gt;&gt; baca.PaddedTuple(&#39;abcd&#39;, pad=3)[2:]</span>
<span class="sd">            (&#39;c&#39;, &#39;d&#39;)</span>

<span class="sd">            Gets slice closed at right:</span>

<span class="sd">            &gt;&gt;&gt; slice_ = baca.PaddedTuple(&#39;abcd&#39;, pad=3)[:15]</span>
<span class="sd">            &gt;&gt;&gt; slice_</span>
<span class="sd">            (&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;b&#39;, &#39;c&#39;)</span>

<span class="sd">            &gt;&gt;&gt; len(slice_)</span>
<span class="sd">            15</span>

<span class="sd">        Raises index error when ``argument`` can not be found in padded tuple.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">argument</span><span class="o">.</span><span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">argument</span><span class="o">.</span><span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">stride</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">argument</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span>
                    <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">stride</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">argument</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">argument</span><span class="o">.</span><span class="n">stop</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">stride</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">elif</span> <span class="n">argument</span><span class="o">.</span><span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">argument</span><span class="o">.</span><span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">stride</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">argument</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>
                    <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">stride</span> <span class="o">=</span> <span class="n">argument</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">argument</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">stride</span> <span class="o">=</span> <span class="n">argument</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">elif</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">argument</span><span class="o">.</span><span class="n">start</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">argument</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">stride</span> <span class="o">=</span> <span class="n">argument</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">argument</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">argument</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">argument</span><span class="o">.</span><span class="n">stop</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">stride</span> <span class="o">=</span> <span class="n">argument</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">argument</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">stride</span><span class="p">):</span>
                <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;padded tuple is empty: </span><span class="si">{</span><span class="bp">self</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">argument</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">length</span> <span class="o">&lt;=</span> <span class="n">argument</span><span class="p">:</span>
            <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad</span>
            <span class="n">left</span> <span class="o">=</span> <span class="n">length</span> <span class="o">-</span> <span class="n">right</span>
            <span class="n">overage</span> <span class="o">=</span> <span class="n">argument</span> <span class="o">-</span> <span class="n">length</span>
            <span class="n">argument</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="p">(</span><span class="n">overage</span> <span class="o">%</span> <span class="n">right</span><span class="p">)</span>
        <span class="k">elif</span> <span class="o">-</span><span class="n">length</span> <span class="o">&lt;=</span> <span class="n">argument</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">argument</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">length</span>
            <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad</span>
            <span class="n">right</span> <span class="o">=</span> <span class="n">length</span> <span class="o">-</span> <span class="n">left</span>
            <span class="k">assert</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span> <span class="o">==</span> <span class="n">length</span>
            <span class="n">overage</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span> <span class="o">-</span> <span class="n">length</span>
            <span class="n">overage</span> <span class="o">=</span> <span class="n">overage</span> <span class="o">%</span> <span class="n">left</span>
            <span class="k">if</span> <span class="n">overage</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">overage</span> <span class="o">=</span> <span class="n">left</span>
            <span class="n">positive_argument</span> <span class="o">=</span> <span class="n">right</span> <span class="o">+</span> <span class="n">overage</span>
            <span class="n">argument</span> <span class="o">=</span> <span class="o">-</span><span class="n">positive_argument</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hashes padded tuple.</span>

<span class="sd">        Redefined in tandem with __eq__.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterator</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates padded tuple.</span>

<span class="sd">        Iterates items only once.</span>

<span class="sd">        Does not iterate infinitely.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets length of padded tuple.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; len(baca.PaddedTuple(&#39;abcd&#39;, pad=3))</span>
<span class="sd">            4</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets interpreter representation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">abjad</span><span class="o">.</span><span class="n">StorageFormatManager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_repr_format</span><span class="p">()</span>

    <span class="c1">### PRIVATE METHODS ###</span>

    <span class="k">def</span> <span class="nf">_get_format_specification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">abjad</span><span class="o">.</span><span class="n">FormatSpecification</span><span class="p">(</span>
            <span class="n">client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">repr_is_indented</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">storage_format_args_values</span><span class="o">=</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">)],</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_index</span><span class="p">,</span> <span class="n">stop_index</span><span class="p">):</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">stop_index</span> <span class="ow">and</span> <span class="n">start_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">stop_index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">start_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">start_index</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">stop_index</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_index</span><span class="p">,</span> <span class="n">stop_index</span><span class="p">):</span>
                <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">start_index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">stop_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_index</span><span class="p">,</span> <span class="n">stop_index</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;slice index signs must be equal.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

    <span class="c1">### PUBLIC PROPERTIES ###</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets items.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; baca.PaddedTuple(&#39;abcd&#39;, pad=1).items</span>
<span class="sd">            (&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;)</span>

<span class="sd">            &gt;&gt;&gt; baca.PaddedTuple([1, 2, 3, 4], pad=1).items</span>
<span class="sd">            (1, 2, 3, 4)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pad</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets pad.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            With nonnegative indices:</span>

<span class="sd">            &gt;&gt;&gt; tuple_ = baca.PaddedTuple(&#39;abcd&#39;, pad=1)</span>
<span class="sd">            &gt;&gt;&gt; for i in range(8):</span>
<span class="sd">            ...     print(i, tuple_[i])</span>
<span class="sd">            ...</span>
<span class="sd">            0 a</span>
<span class="sd">            1 b</span>
<span class="sd">            2 c</span>
<span class="sd">            3 d</span>
<span class="sd">            4 d</span>
<span class="sd">            5 d</span>
<span class="sd">            6 d</span>
<span class="sd">            7 d</span>

<span class="sd">            &gt;&gt;&gt; tuple_ = baca.PaddedTuple(&#39;abcd&#39;, pad=2)</span>
<span class="sd">            &gt;&gt;&gt; for i in range(8):</span>
<span class="sd">            ...     print(i, tuple_[i])</span>
<span class="sd">            ...</span>
<span class="sd">            0 a</span>
<span class="sd">            1 b</span>
<span class="sd">            2 c</span>
<span class="sd">            3 d</span>
<span class="sd">            4 c</span>
<span class="sd">            5 d</span>
<span class="sd">            6 c</span>
<span class="sd">            7 d</span>

<span class="sd">            &gt;&gt;&gt; tuple_ = baca.PaddedTuple(&#39;abcd&#39;, pad=3)</span>
<span class="sd">            &gt;&gt;&gt; for i in range(8):</span>
<span class="sd">            ...     print(i, tuple_[i])</span>
<span class="sd">            ...</span>
<span class="sd">            0 a</span>
<span class="sd">            1 b</span>
<span class="sd">            2 c</span>
<span class="sd">            3 d</span>
<span class="sd">            4 b</span>
<span class="sd">            5 c</span>
<span class="sd">            6 d</span>
<span class="sd">            7 b</span>

<span class="sd">            &gt;&gt;&gt; tuple_ = baca.PaddedTuple(&#39;abcd&#39;, pad=4)</span>
<span class="sd">            &gt;&gt;&gt; for i in range(8):</span>
<span class="sd">            ...     print(i, tuple_[i])</span>
<span class="sd">            ...</span>
<span class="sd">            0 a</span>
<span class="sd">            1 b</span>
<span class="sd">            2 c</span>
<span class="sd">            3 d</span>
<span class="sd">            4 a</span>
<span class="sd">            5 b</span>
<span class="sd">            6 c</span>
<span class="sd">            7 d</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            With nonpositive indices:</span>

<span class="sd">            &gt;&gt;&gt; tuple_ = baca.PaddedTuple(&#39;abcd&#39;, pad=1)</span>
<span class="sd">            &gt;&gt;&gt; for i in range(-1, -9, -1):</span>
<span class="sd">            ...     print(i, tuple_[i])</span>
<span class="sd">            ...</span>
<span class="sd">            -1 d</span>
<span class="sd">            -2 c</span>
<span class="sd">            -3 b</span>
<span class="sd">            -4 a</span>
<span class="sd">            -5 a</span>
<span class="sd">            -6 a</span>
<span class="sd">            -7 a</span>
<span class="sd">            -8 a</span>

<span class="sd">            &gt;&gt;&gt; tuple_ = baca.PaddedTuple(&#39;abcd&#39;, pad=2)</span>
<span class="sd">            &gt;&gt;&gt; for i in range(-1, -9, -1):</span>
<span class="sd">            ...     print(i, tuple_[i])</span>
<span class="sd">            ...</span>
<span class="sd">            -1 d</span>
<span class="sd">            -2 c</span>
<span class="sd">            -3 b</span>
<span class="sd">            -4 a</span>
<span class="sd">            -5 b</span>
<span class="sd">            -6 a</span>
<span class="sd">            -7 b</span>
<span class="sd">            -8 a</span>

<span class="sd">            &gt;&gt;&gt; tuple_ = baca.PaddedTuple(&#39;abcd&#39;, pad=3)</span>
<span class="sd">            &gt;&gt;&gt; for i in range(-1, -9, -1):</span>
<span class="sd">            ...     print(i, tuple_[i])</span>
<span class="sd">            ...</span>
<span class="sd">            -1 d</span>
<span class="sd">            -2 c</span>
<span class="sd">            -3 b</span>
<span class="sd">            -4 a</span>
<span class="sd">            -5 c</span>
<span class="sd">            -6 b</span>
<span class="sd">            -7 a</span>
<span class="sd">            -8 c</span>

<span class="sd">            &gt;&gt;&gt; tuple_ = baca.PaddedTuple(&#39;abcd&#39;, pad=4)</span>
<span class="sd">            &gt;&gt;&gt; for i in range(-1, -9, -1):</span>
<span class="sd">            ...     print(i, tuple_[i])</span>
<span class="sd">            ...</span>
<span class="sd">            -1 d</span>
<span class="sd">            -2 c</span>
<span class="sd">            -3 b</span>
<span class="sd">            -4 a</span>
<span class="sd">            -5 d</span>
<span class="sd">            -6 c</span>
<span class="sd">            -7 b</span>
<span class="sd">            -8 a</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pad</span>


<span class="k">class</span> <span class="nc">SchemeManifest</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scheme manifest.</span>

<span class="sd">    New functions defined in ``~/baca/lilypond/baca.ily`` must</span>
<span class="sd">    currently be added here by hand.</span>

<span class="sd">    TODO: eliminate duplication. Define custom Scheme functions here</span>
<span class="sd">    (``SchemeManifest``) and teach ``SchemeManifest`` to write</span>
<span class="sd">    ``~/baca/lilypond/baca.ily`` automatically.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">### CLASS VARIABLES ###</span>

    <span class="n">__documentation_section__</span> <span class="o">=</span> <span class="s2">&quot;Classes&quot;</span>

    <span class="n">_dynamics</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;baca-appena-udibile&quot;</span><span class="p">,</span> <span class="s2">&quot;appena udibile&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-f-but-accents-sffz&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-f-sub-but-accents-continue-sffz&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-ffp&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-fffp&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;niente&quot;</span><span class="p">,</span> <span class="s2">&quot;niente&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-p-sub-but-accents-continue-sffz&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">),</span>
        <span class="c1">#</span>
        <span class="p">(</span><span class="s2">&quot;baca-pppf&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-pppff&quot;</span><span class="p">,</span> <span class="s2">&quot;ff&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-pppfff&quot;</span><span class="p">,</span> <span class="s2">&quot;fff&quot;</span><span class="p">),</span>
        <span class="c1">#</span>
        <span class="p">(</span><span class="s2">&quot;baca-ppf&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-ppff&quot;</span><span class="p">,</span> <span class="s2">&quot;ff&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-ppfff&quot;</span><span class="p">,</span> <span class="s2">&quot;fff&quot;</span><span class="p">),</span>
        <span class="c1">#</span>
        <span class="p">(</span><span class="s2">&quot;baca-pf&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-pff&quot;</span><span class="p">,</span> <span class="s2">&quot;ff&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-pfff&quot;</span><span class="p">,</span> <span class="s2">&quot;fff&quot;</span><span class="p">),</span>
        <span class="c1">#</span>
        <span class="p">(</span><span class="s2">&quot;baca-ppp-ppp&quot;</span><span class="p">,</span> <span class="s2">&quot;ppp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-ppp-pp&quot;</span><span class="p">,</span> <span class="s2">&quot;pp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-ppp-p&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-ppp-mp&quot;</span><span class="p">,</span> <span class="s2">&quot;mp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-ppp-mf&quot;</span><span class="p">,</span> <span class="s2">&quot;mf&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-ppp-f&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-ppp-ff&quot;</span><span class="p">,</span> <span class="s2">&quot;ff&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-ppp-fff&quot;</span><span class="p">,</span> <span class="s2">&quot;fff&quot;</span><span class="p">),</span>
        <span class="c1">#</span>
        <span class="p">(</span><span class="s2">&quot;baca-pp-ppp&quot;</span><span class="p">,</span> <span class="s2">&quot;ppp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-pp-pp&quot;</span><span class="p">,</span> <span class="s2">&quot;pp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-pp-p&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-pp-mp&quot;</span><span class="p">,</span> <span class="s2">&quot;mp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-pp-mf&quot;</span><span class="p">,</span> <span class="s2">&quot;mf&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-pp-f&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-pp-ff&quot;</span><span class="p">,</span> <span class="s2">&quot;ff&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-pp-fff&quot;</span><span class="p">,</span> <span class="s2">&quot;fff&quot;</span><span class="p">),</span>
        <span class="c1">#</span>
        <span class="p">(</span><span class="s2">&quot;baca-p-ppp&quot;</span><span class="p">,</span> <span class="s2">&quot;ppp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-p-pp&quot;</span><span class="p">,</span> <span class="s2">&quot;pp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-p-p&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-p-mp&quot;</span><span class="p">,</span> <span class="s2">&quot;mp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-p-mf&quot;</span><span class="p">,</span> <span class="s2">&quot;mf&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-p-f&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-p-ff&quot;</span><span class="p">,</span> <span class="s2">&quot;ff&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-p-fff&quot;</span><span class="p">,</span> <span class="s2">&quot;fff&quot;</span><span class="p">),</span>
        <span class="c1">#</span>
        <span class="p">(</span><span class="s2">&quot;baca-mp-ppp&quot;</span><span class="p">,</span> <span class="s2">&quot;ppp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-mp-pp&quot;</span><span class="p">,</span> <span class="s2">&quot;pp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-mp-p&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-mp-mp&quot;</span><span class="p">,</span> <span class="s2">&quot;mp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-mp-mf&quot;</span><span class="p">,</span> <span class="s2">&quot;mf&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-mp-f&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-mp-ff&quot;</span><span class="p">,</span> <span class="s2">&quot;ff&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-mp-fff&quot;</span><span class="p">,</span> <span class="s2">&quot;fff&quot;</span><span class="p">),</span>
        <span class="c1">#</span>
        <span class="p">(</span><span class="s2">&quot;baca-mf-ppp&quot;</span><span class="p">,</span> <span class="s2">&quot;ppp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-mf-pp&quot;</span><span class="p">,</span> <span class="s2">&quot;pp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-mf-p&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-mf-mp&quot;</span><span class="p">,</span> <span class="s2">&quot;mp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-mf-mf&quot;</span><span class="p">,</span> <span class="s2">&quot;mf&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-mf-f&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-mf-ff&quot;</span><span class="p">,</span> <span class="s2">&quot;ff&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-mf-fff&quot;</span><span class="p">,</span> <span class="s2">&quot;fff&quot;</span><span class="p">),</span>
        <span class="c1">#</span>
        <span class="p">(</span><span class="s2">&quot;baca-f-ppp&quot;</span><span class="p">,</span> <span class="s2">&quot;ppp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-f-pp&quot;</span><span class="p">,</span> <span class="s2">&quot;pp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-f-p&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-f-mp&quot;</span><span class="p">,</span> <span class="s2">&quot;mp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-f-mf&quot;</span><span class="p">,</span> <span class="s2">&quot;mf&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-f-f&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-f-ff&quot;</span><span class="p">,</span> <span class="s2">&quot;ff&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-f-fff&quot;</span><span class="p">,</span> <span class="s2">&quot;fff&quot;</span><span class="p">),</span>
        <span class="c1">#</span>
        <span class="p">(</span><span class="s2">&quot;baca-ff-ppp&quot;</span><span class="p">,</span> <span class="s2">&quot;ppp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-ff-pp&quot;</span><span class="p">,</span> <span class="s2">&quot;pp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-ff-p&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-ff-mp&quot;</span><span class="p">,</span> <span class="s2">&quot;mp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-ff-mf&quot;</span><span class="p">,</span> <span class="s2">&quot;mf&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-ff-f&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-ff-ff&quot;</span><span class="p">,</span> <span class="s2">&quot;ff&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-ff-fff&quot;</span><span class="p">,</span> <span class="s2">&quot;fff&quot;</span><span class="p">),</span>
        <span class="c1">#</span>
        <span class="p">(</span><span class="s2">&quot;baca-fff-ppp&quot;</span><span class="p">,</span> <span class="s2">&quot;ppp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-fff-pp&quot;</span><span class="p">,</span> <span class="s2">&quot;pp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-fff-p&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-fff-mp&quot;</span><span class="p">,</span> <span class="s2">&quot;mp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-fff-mf&quot;</span><span class="p">,</span> <span class="s2">&quot;mf&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-fff-f&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-fff-ff&quot;</span><span class="p">,</span> <span class="s2">&quot;ff&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-fff-fff&quot;</span><span class="p">,</span> <span class="s2">&quot;fff&quot;</span><span class="p">),</span>
        <span class="c1">#</span>
        <span class="p">(</span><span class="s2">&quot;baca-sff&quot;</span><span class="p">,</span> <span class="s2">&quot;ff&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-sffp&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-sffpp&quot;</span><span class="p">,</span> <span class="s2">&quot;pp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-sfffz&quot;</span><span class="p">,</span> <span class="s2">&quot;fff&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-sffz&quot;</span><span class="p">,</span> <span class="s2">&quot;ff&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-sfpp&quot;</span><span class="p">,</span> <span class="s2">&quot;pp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-sfz-f&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;baca-sfz-p&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1">### PUBLIC PROPERTIES ###</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets dynamics.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; scheme_manifest = baca.SchemeManifest()</span>
<span class="sd">            &gt;&gt;&gt; for dynamic in scheme_manifest.dynamics:</span>
<span class="sd">            ...     dynamic</span>
<span class="sd">            ...</span>
<span class="sd">            &#39;baca-appena-udibile&#39;</span>
<span class="sd">            &#39;baca-f-but-accents-sffz&#39;</span>
<span class="sd">            &#39;baca-f-sub-but-accents-continue-sffz&#39;</span>
<span class="sd">            &#39;baca-ffp&#39;</span>
<span class="sd">            &#39;baca-fffp&#39;</span>
<span class="sd">            &#39;niente&#39;</span>
<span class="sd">            &#39;baca-p-sub-but-accents-continue-sffz&#39;</span>
<span class="sd">            &#39;baca-pppf&#39;</span>
<span class="sd">            &#39;baca-pppff&#39;</span>
<span class="sd">            &#39;baca-pppfff&#39;</span>
<span class="sd">            &#39;baca-ppf&#39;</span>
<span class="sd">            &#39;baca-ppff&#39;</span>
<span class="sd">            &#39;baca-ppfff&#39;</span>
<span class="sd">            &#39;baca-pf&#39;</span>
<span class="sd">            &#39;baca-pff&#39;</span>
<span class="sd">            &#39;baca-pfff&#39;</span>
<span class="sd">            &#39;baca-ppp-ppp&#39;</span>
<span class="sd">            &#39;baca-ppp-pp&#39;</span>
<span class="sd">            &#39;baca-ppp-p&#39;</span>
<span class="sd">            &#39;baca-ppp-mp&#39;</span>
<span class="sd">            &#39;baca-ppp-mf&#39;</span>
<span class="sd">            &#39;baca-ppp-f&#39;</span>
<span class="sd">            &#39;baca-ppp-ff&#39;</span>
<span class="sd">            &#39;baca-ppp-fff&#39;</span>
<span class="sd">            &#39;baca-pp-ppp&#39;</span>
<span class="sd">            &#39;baca-pp-pp&#39;</span>
<span class="sd">            &#39;baca-pp-p&#39;</span>
<span class="sd">            &#39;baca-pp-mp&#39;</span>
<span class="sd">            &#39;baca-pp-mf&#39;</span>
<span class="sd">            &#39;baca-pp-f&#39;</span>
<span class="sd">            &#39;baca-pp-ff&#39;</span>
<span class="sd">            &#39;baca-pp-fff&#39;</span>
<span class="sd">            &#39;baca-p-ppp&#39;</span>
<span class="sd">            &#39;baca-p-pp&#39;</span>
<span class="sd">            &#39;baca-p-p&#39;</span>
<span class="sd">            &#39;baca-p-mp&#39;</span>
<span class="sd">            &#39;baca-p-mf&#39;</span>
<span class="sd">            &#39;baca-p-f&#39;</span>
<span class="sd">            &#39;baca-p-ff&#39;</span>
<span class="sd">            &#39;baca-p-fff&#39;</span>
<span class="sd">            &#39;baca-mp-ppp&#39;</span>
<span class="sd">            &#39;baca-mp-pp&#39;</span>
<span class="sd">            &#39;baca-mp-p&#39;</span>
<span class="sd">            &#39;baca-mp-mp&#39;</span>
<span class="sd">            &#39;baca-mp-mf&#39;</span>
<span class="sd">            &#39;baca-mp-f&#39;</span>
<span class="sd">            &#39;baca-mp-ff&#39;</span>
<span class="sd">            &#39;baca-mp-fff&#39;</span>
<span class="sd">            &#39;baca-mf-ppp&#39;</span>
<span class="sd">            &#39;baca-mf-pp&#39;</span>
<span class="sd">            &#39;baca-mf-p&#39;</span>
<span class="sd">            &#39;baca-mf-mp&#39;</span>
<span class="sd">            &#39;baca-mf-mf&#39;</span>
<span class="sd">            &#39;baca-mf-f&#39;</span>
<span class="sd">            &#39;baca-mf-ff&#39;</span>
<span class="sd">            &#39;baca-mf-fff&#39;</span>
<span class="sd">            &#39;baca-f-ppp&#39;</span>
<span class="sd">            &#39;baca-f-pp&#39;</span>
<span class="sd">            &#39;baca-f-p&#39;</span>
<span class="sd">            &#39;baca-f-mp&#39;</span>
<span class="sd">            &#39;baca-f-mf&#39;</span>
<span class="sd">            &#39;baca-f-f&#39;</span>
<span class="sd">            &#39;baca-f-ff&#39;</span>
<span class="sd">            &#39;baca-f-fff&#39;</span>
<span class="sd">            &#39;baca-ff-ppp&#39;</span>
<span class="sd">            &#39;baca-ff-pp&#39;</span>
<span class="sd">            &#39;baca-ff-p&#39;</span>
<span class="sd">            &#39;baca-ff-mp&#39;</span>
<span class="sd">            &#39;baca-ff-mf&#39;</span>
<span class="sd">            &#39;baca-ff-f&#39;</span>
<span class="sd">            &#39;baca-ff-ff&#39;</span>
<span class="sd">            &#39;baca-ff-fff&#39;</span>
<span class="sd">            &#39;baca-fff-ppp&#39;</span>
<span class="sd">            &#39;baca-fff-pp&#39;</span>
<span class="sd">            &#39;baca-fff-p&#39;</span>
<span class="sd">            &#39;baca-fff-mp&#39;</span>
<span class="sd">            &#39;baca-fff-mf&#39;</span>
<span class="sd">            &#39;baca-fff-f&#39;</span>
<span class="sd">            &#39;baca-fff-ff&#39;</span>
<span class="sd">            &#39;baca-fff-fff&#39;</span>
<span class="sd">            &#39;baca-sff&#39;</span>
<span class="sd">            &#39;baca-sffp&#39;</span>
<span class="sd">            &#39;baca-sffpp&#39;</span>
<span class="sd">            &#39;baca-sfffz&#39;</span>
<span class="sd">            &#39;baca-sffz&#39;</span>
<span class="sd">            &#39;baca-sfpp&#39;</span>
<span class="sd">            &#39;baca-sfz-f&#39;</span>
<span class="sd">            &#39;baca-sfz-p&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dynamics</span><span class="p">]</span>

    <span class="c1">### PUBLIC METHODS ###</span>

    <span class="k">def</span> <span class="nf">dynamic_to_steady_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes ``dynamic`` to steady state.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; scheme_manifest = baca.SchemeManifest()</span>
<span class="sd">            &gt;&gt;&gt; scheme_manifest.dynamic_to_steady_state(&#39;sfz-p&#39;)</span>
<span class="sd">            &#39;p&#39;</span>

<span class="sd">        Returns string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">dynamic_</span><span class="p">,</span> <span class="n">steady_state</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dynamics</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dynamic_</span> <span class="o">==</span> <span class="n">dynamic</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">steady_state</span>
            <span class="k">if</span> <span class="n">dynamic_</span> <span class="o">==</span> <span class="s2">&quot;baca-&quot;</span> <span class="o">+</span> <span class="n">dynamic</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">steady_state</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">dynamic</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Selection</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Selection.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">### CLASS VARIABLES ###</span>

    <span class="n">__documentation_section__</span> <span class="o">=</span> <span class="s2">&quot;Classes&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>

    <span class="c1">### PUBLIC METHODS ###</span>

    <span class="k">def</span> <span class="nf">chead</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Note</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects chord head ``n``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects chord head -1:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).chead(-1)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cheads</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">cheads</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects chord heads.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects chord heads:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).cheads()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;d&#39; e&#39;&gt;4&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;e&#39; fs&#39;&gt;4&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Chord</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">head</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clparts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects leaves cyclically partitioned by ``counts`` (with overhang).</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects leaves cyclically partitioned 2, 3, 4:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).clparts([2, 3, 4])</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Selection([Rest(&#39;r16&#39;), Note(&quot;bf&#39;16&quot;)])</span>
<span class="sd">            Selection([Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;), Note(&quot;c&#39;16&quot;), Chord(&quot;&lt;d&#39; e&#39;&gt;4&quot;)])</span>
<span class="sd">            Selection([Chord(&quot;&lt;d&#39; e&#39;&gt;16&quot;), Rest(&#39;r16&#39;), Note(&quot;bf&#39;16&quot;), Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)])</span>
<span class="sd">            Selection([Note(&quot;d&#39;16&quot;), Chord(&quot;&lt;e&#39; fs&#39;&gt;4&quot;)])</span>
<span class="sd">            Selection([Chord(&quot;&lt;e&#39; fs&#39;&gt;16&quot;), Rest(&#39;r16&#39;), Note(&quot;bf&#39;16&quot;)])</span>
<span class="sd">            Selection([Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;), Note(&quot;e&#39;16&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">super</span><span class="p">()</span>
            <span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>
            <span class="o">.</span><span class="n">partition_by_counts</span><span class="p">(</span><span class="n">counts</span><span class="o">=</span><span class="n">counts</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">cmgroups</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="s2">&quot;Selection&quot;</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Partitions measure-grouped leaves (cyclically).</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions measure-grouped leaves into pairs:</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;r8 d&#39; e&#39; f&#39; g&#39; a&#39; b&#39; r d&#39;&#39;&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((2, 8)), staff[0])</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((3, 8)), staff[4])</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((1, 8)), staff[7])</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).cmgroups([2])</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Selection([Rest(&#39;r8&#39;), Note(&quot;d&#39;8&quot;), Note(&quot;e&#39;8&quot;), Note(&quot;f&#39;8&quot;)])</span>
<span class="sd">            Selection([Note(&quot;g&#39;8&quot;), Note(&quot;a&#39;8&quot;), Note(&quot;b&#39;8&quot;), Rest(&#39;r8&#39;)])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \time 2/8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    r8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    d&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    e&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    f&#39;8</span>
<span class="sd">                    \time 3/8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    g&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    a&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    b&#39;8</span>
<span class="sd">                    \time 1/8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    r8</span>
<span class="sd">                    d&#39;&#39;8</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">group_by_measure</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">partition_by_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">Selection</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Selection</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>
        <span class="n">result_</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_</span><span class="p">,</span> <span class="n">Selection</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">result_</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result_</span>

    <span class="k">def</span> <span class="nf">enchain</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enchains items in selection.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Enchains leaves in alternating groups of 5:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).leaves().enchain([5])</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            Selection([Rest(&#39;r16&#39;), Note(&quot;bf&#39;16&quot;), Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;), Note(&quot;c&#39;16&quot;), Chord(&quot;&lt;d&#39; e&#39;&gt;4&quot;)])</span>
<span class="sd">            Selection([Chord(&quot;&lt;d&#39; e&#39;&gt;4&quot;), Chord(&quot;&lt;d&#39; e&#39;&gt;16&quot;), Rest(&#39;r16&#39;), Note(&quot;bf&#39;16&quot;), Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)])</span>
<span class="sd">            Selection([Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;), Note(&quot;d&#39;16&quot;), Chord(&quot;&lt;e&#39; fs&#39;&gt;4&quot;), Chord(&quot;&lt;e&#39; fs&#39;&gt;16&quot;), Rest(&#39;r16&#39;)])</span>
<span class="sd">            Selection([Rest(&#39;r16&#39;), Note(&quot;bf&#39;16&quot;), Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;), Note(&quot;e&#39;16&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;)])</span>
<span class="sd">            Selection([Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)])</span>

<span class="sd">            &gt;&gt;&gt; for i, selection in enumerate(result):</span>
<span class="sd">            ...     if i % 2 == 0:</span>
<span class="sd">            ...         color, direction = &quot;#red&quot;, abjad.Up</span>
<span class="sd">            ...     else:</span>
<span class="sd">            ...         color, direction = &quot;#blue&quot;, abjad.Down</span>
<span class="sd">            ...     string = rf&#39;\markup {{ \bold \with-color {color} * }}&#39;</span>
<span class="sd">            ...     for leaf in selection:</span>
<span class="sd">            ...         markup = abjad.Markup(string, literal=True)</span>
<span class="sd">            ...         markup = abjad.new(markup, direction=direction)</span>
<span class="sd">            ...         abjad.attach(markup, leaf)</span>

<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TextScript.staff_padding = 6</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TextScript.staff-padding = 6</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        ^ \markup { \bold \with-color #red * }</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        ^ \markup { \bold \with-color #red * }</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        ^ \markup { \bold \with-color #red * }</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        ^ \markup { \bold \with-color #red * }</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ^ \markup { \bold \with-color #red * }</span>
<span class="sd">                        _ \markup { \bold \with-color #blue * }</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                        _ \markup { \bold \with-color #blue * }</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        _ \markup { \bold \with-color #blue * }</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        _ \markup { \bold \with-color #blue * }</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        ^ \markup { \bold \with-color #red * }</span>
<span class="sd">                        _ \markup { \bold \with-color #blue * }</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        ^ \markup { \bold \with-color #red * }</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ^ \markup { \bold \with-color #red * }</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                        ^ \markup { \bold \with-color #red * }</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        ^ \markup { \bold \with-color #red * }</span>
<span class="sd">                        _ \markup { \bold \with-color #blue * }</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        _ \markup { \bold \with-color #blue * }</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        _ \markup { \bold \with-color #blue * }</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        _ \markup { \bold \with-color #blue * }</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ^ \markup { \bold \with-color #red * }</span>
<span class="sd">                        _ \markup { \bold \with-color #blue * }</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        ^ \markup { \bold \with-color #red * }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        Returns new selection (or expression).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_by_counts</span><span class="p">(</span>
            <span class="n">counts</span><span class="o">=</span><span class="n">counts</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">enchain</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">grace</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects grace ``n``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects grace -1:</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;c&#39;8 d&#39;8 e&#39;8 f&#39;8&quot;)</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.BeforeGraceContainer(&quot;cf&#39;&#39;16 bf&#39;16&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(container, staff[1])</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.AfterGraceContainer(&quot;af&#39;16 gf&#39;16&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(container, staff[1])</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).grace(-1)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            Note(&quot;gf&#39;16&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                    \grace {</span>
<span class="sd">                        cf&#39;&#39;16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \afterGrace</span>
<span class="sd">                    d&#39;8</span>
<span class="sd">                    {</span>
<span class="sd">                        af&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        gf&#39;16</span>
<span class="sd">                    }</span>
<span class="sd">                    e&#39;8</span>
<span class="sd">                    f&#39;8</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graces</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">graces</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects graces.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects graces:</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;c&#39;8 d&#39;8 e&#39;8 f&#39;8&quot;)</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.BeforeGraceContainer(&quot;cf&#39;&#39;16 bf&#39;16&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(container, staff[1])</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.AfterGraceContainer(&quot;af&#39;16 gf&#39;16&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(container, staff[1])</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).graces()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Note(&quot;cf&#39;&#39;16&quot;)</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>
<span class="sd">            Note(&quot;af&#39;16&quot;)</span>
<span class="sd">            Note(&quot;gf&#39;16&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                    \grace {</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        cf&#39;&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \afterGrace</span>
<span class="sd">                    d&#39;8</span>
<span class="sd">                    {</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        af&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        gf&#39;16</span>
<span class="sd">                    }</span>
<span class="sd">                    e&#39;8</span>
<span class="sd">                    f&#39;8</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">grace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hleaf</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects haupt leaf ``n``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects haupt leaf 1:</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;c&#39;8 d&#39;8 e&#39;8 f&#39;8&quot;)</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.BeforeGraceContainer(&quot;cf&#39;&#39;16 bf&#39;16&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(container, staff[1])</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.AfterGraceContainer(&quot;af&#39;16 gf&#39;16&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(container, staff[1])</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).hleaf(1)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            Note(&quot;d&#39;8&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                    \grace {</span>
<span class="sd">                        cf&#39;&#39;16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \abjad-color-music #&#39;green</span>
<span class="sd">                    \afterGrace</span>
<span class="sd">                    d&#39;8</span>
<span class="sd">                    {</span>
<span class="sd">                        af&#39;16</span>
<span class="sd">                        gf&#39;16</span>
<span class="sd">                    }</span>
<span class="sd">                    e&#39;8</span>
<span class="sd">                    f&#39;8</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hleaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">hleaves</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects haupt leaves.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects haupt leaves:</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;c&#39;8 d&#39;8 e&#39;8 f&#39;8&quot;)</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.BeforeGraceContainer(&quot;cf&#39;&#39;16 bf&#39;16&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(container, staff[1])</span>
<span class="sd">            &gt;&gt;&gt; container = abjad.AfterGraceContainer(&quot;af&#39;16 gf&#39;16&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(container, staff[1])</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).hleaves()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Note(&quot;c&#39;8&quot;)</span>
<span class="sd">            Note(&quot;d&#39;8&quot;)</span>
<span class="sd">            Note(&quot;e&#39;8&quot;)</span>
<span class="sd">            Note(&quot;f&#39;8&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                    \grace {</span>
<span class="sd">                        cf&#39;&#39;16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    \afterGrace</span>
<span class="sd">                    d&#39;8</span>
<span class="sd">                    {</span>
<span class="sd">                        af&#39;16</span>
<span class="sd">                        gf&#39;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    e&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    f&#39;8</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">grace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">lleaf</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects leaf ``n`` from leaves leaked to the left.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects leaf 0 from leaves (leaked to the left) in tuplet 1:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).tuplets()[1:2].lleaf(0)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            Chord(&quot;&lt;d&#39; e&#39;&gt;16&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lleaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">lleak</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Leaks to the left.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects runs (each leaked to the left):</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;c&#39;8 r8 d&#39;8 e&#39;8 r8 f&#39;8 g&#39;8 a&#39;8&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>

<span class="sd">            &gt;&gt;&gt; result = baca.Selection(staff).runs()</span>
<span class="sd">            &gt;&gt;&gt; result = [baca.Selection(_).lleak() for _ in result]</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Selection([Note(&quot;c&#39;8&quot;)])</span>
<span class="sd">            Selection([Rest(&#39;r8&#39;), Note(&quot;d&#39;8&quot;), Note(&quot;e&#39;8&quot;)])</span>
<span class="sd">            Selection([Rest(&#39;r8&#39;), Note(&quot;f&#39;8&quot;), Note(&quot;g&#39;8&quot;), Note(&quot;a&#39;8&quot;)])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    r8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    d&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    e&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    r8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    f&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    g&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    a&#39;8</span>
<span class="sd">                }</span>

<span class="sd">        Returns new selection (or expression).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_previous_leaf</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">lleaves</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects leaves, leaked to the left.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects leaves (leaked to the left) in tuplet 1:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).tuplets()[1:2].lleaves()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Chord(&quot;&lt;d&#39; e&#39;&gt;16&quot;)</span>
<span class="sd">            Rest(&#39;r16&#39;)</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;d&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;e&#39; fs&#39;&gt;4&quot;)</span>
<span class="sd">            Chord(&quot;&lt;e&#39; fs&#39;&gt;16&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">with_previous_leaf</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">lparts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects leaves partitioned by ``counts``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects leaves partitioned 2, 3, 4:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).lparts([2, 3, 4])</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Selection([Rest(&#39;r16&#39;), Note(&quot;bf&#39;16&quot;)])</span>
<span class="sd">            Selection([Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;), Note(&quot;c&#39;16&quot;), Chord(&quot;&lt;d&#39; e&#39;&gt;4&quot;)])</span>
<span class="sd">            Selection([Chord(&quot;&lt;d&#39; e&#39;&gt;16&quot;), Rest(&#39;r16&#39;), Note(&quot;bf&#39;16&quot;), Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">partition_by_counts</span><span class="p">(</span><span class="n">counts</span><span class="o">=</span><span class="n">counts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">lt</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects logical tie ``n``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects logical tie -1:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).lt(-1)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            LogicalTie([Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lts</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">ltleaf</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects left-trimmed leaf ``n``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects left-trimmed leaf 0:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 r4 r16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).ltleaf(0)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        r4</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ltleaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">ltleaves</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects left-trimmed leaves.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects left-trimmed leaves:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 r4 r16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).ltleaves()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;c&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;d&#39; e&#39;&gt;4&quot;)</span>
<span class="sd">            Chord(&quot;&lt;d&#39; e&#39;&gt;16&quot;)</span>
<span class="sd">            Rest(&#39;r16&#39;)</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;d&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;e&#39; fs&#39;&gt;4&quot;)</span>
<span class="sd">            Chord(&quot;&lt;e&#39; fs&#39;&gt;16&quot;)</span>
<span class="sd">            Rest(&#39;r16&#39;)</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;e&#39;16&quot;)</span>
<span class="sd">            Rest(&#39;r4&#39;)</span>
<span class="sd">            Rest(&#39;r16&#39;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        r4</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="n">abjad</span><span class="o">.</span><span class="n">Left</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ltqrun</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects logical tie equipitch run ``n``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects logical tie equipitch run -1:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 c&#39;16 c&#39;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 d&#39;16 d&#39;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 e&#39;16 e&#39;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).ltqrun(-1)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            Selection([LogicalTie([Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)])])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ltqruns</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">ltqruns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects logical tie equipitch runs.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects logical tie equipitch runs:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 c&#39;16 c&#39;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 d&#39;16 d&#39;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 e&#39;16 e&#39;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).ltqruns()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Selection([LogicalTie([Note(&quot;c&#39;16&quot;)]), LogicalTie([Note(&quot;c&#39;16&quot;)]), LogicalTie([Note(&quot;c&#39;16&quot;)])])</span>
<span class="sd">            Selection([LogicalTie([Chord(&quot;&lt;d&#39; e&#39;&gt;4&quot;), Chord(&quot;&lt;d&#39; e&#39;&gt;16&quot;)])])</span>
<span class="sd">            Selection([LogicalTie([Note(&quot;d&#39;16&quot;)]), LogicalTie([Note(&quot;d&#39;16&quot;)]), LogicalTie([Note(&quot;d&#39;16&quot;)])])</span>
<span class="sd">            Selection([LogicalTie([Chord(&quot;&lt;e&#39; fs&#39;&gt;4&quot;), Chord(&quot;&lt;e&#39; fs&#39;&gt;16&quot;)])])</span>
<span class="sd">            Selection([LogicalTie([Note(&quot;e&#39;16&quot;)]), LogicalTie([Note(&quot;e&#39;16&quot;)]), LogicalTie([Note(&quot;e&#39;16&quot;)])])</span>
<span class="sd">            Selection([LogicalTie([Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)])])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plts</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">group_by_pitch</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">Selection</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Selection</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="o">.</span><span class="n">group_by_contiguity</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">Selection</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">([</span><span class="n">Selection</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">ltrun</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects logical tie run ``n``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects logical tie run -1:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 c&#39;16 c&#39;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 d&#39;16 d&#39;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 e&#39;16 e&#39;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).ltrun(-1)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            Selection([LogicalTie([Note(&quot;e&#39;16&quot;)]), LogicalTie([Note(&quot;e&#39;16&quot;)]), LogicalTie([Note(&quot;e&#39;16&quot;)]), LogicalTie([Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)])])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ltruns</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">ltruns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects logical tie runs.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects logical tie runs:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 c&#39;16 c&#39;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 d&#39;16 d&#39;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 e&#39;16 e&#39;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).ltruns()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Selection([LogicalTie([Note(&quot;c&#39;16&quot;)]), LogicalTie([Note(&quot;c&#39;16&quot;)]), LogicalTie([Note(&quot;c&#39;16&quot;)]), LogicalTie([Chord(&quot;&lt;d&#39; e&#39;&gt;4&quot;), Chord(&quot;&lt;d&#39; e&#39;&gt;16&quot;)])])</span>
<span class="sd">            Selection([LogicalTie([Note(&quot;d&#39;16&quot;)]), LogicalTie([Note(&quot;d&#39;16&quot;)]), LogicalTie([Note(&quot;d&#39;16&quot;)]), LogicalTie([Chord(&quot;&lt;e&#39; fs&#39;&gt;4&quot;), Chord(&quot;&lt;e&#39; fs&#39;&gt;16&quot;)])])</span>
<span class="sd">            Selection([LogicalTie([Note(&quot;e&#39;16&quot;)]), LogicalTie([Note(&quot;e&#39;16&quot;)]), LogicalTie([Note(&quot;e&#39;16&quot;)]), LogicalTie([Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)])])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_ties</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">pitched</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">group_by_contiguity</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">Selection</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">([</span><span class="n">Selection</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">lts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">nontrivial</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects logical ties.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects logical ties:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).lts()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            LogicalTie([Rest(&#39;r16&#39;)])</span>
<span class="sd">            LogicalTie([Note(&quot;bf&#39;16&quot;)])</span>
<span class="sd">            LogicalTie([Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)])</span>
<span class="sd">            LogicalTie([Note(&quot;c&#39;16&quot;)])</span>
<span class="sd">            LogicalTie([Chord(&quot;&lt;d&#39; e&#39;&gt;4&quot;), Chord(&quot;&lt;d&#39; e&#39;&gt;16&quot;)])</span>
<span class="sd">            LogicalTie([Rest(&#39;r16&#39;)])</span>
<span class="sd">            LogicalTie([Note(&quot;bf&#39;16&quot;)])</span>
<span class="sd">            LogicalTie([Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)])</span>
<span class="sd">            LogicalTie([Note(&quot;d&#39;16&quot;)])</span>
<span class="sd">            LogicalTie([Chord(&quot;&lt;e&#39; fs&#39;&gt;4&quot;), Chord(&quot;&lt;e&#39; fs&#39;&gt;16&quot;)])</span>
<span class="sd">            LogicalTie([Rest(&#39;r16&#39;)])</span>
<span class="sd">            LogicalTie([Note(&quot;bf&#39;16&quot;)])</span>
<span class="sd">            LogicalTie([Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)])</span>
<span class="sd">            LogicalTie([Note(&quot;e&#39;16&quot;)])</span>
<span class="sd">            LogicalTie([Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_ties</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">nontrivial</span><span class="o">=</span><span class="n">nontrivial</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mgroups</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">counts</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="s2">&quot;Selection&quot;</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Partitions measure-grouped leaves.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions measure-grouped leaves into one part of length 2:</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;r8 d&#39; e&#39; f&#39; g&#39; a&#39; b&#39; r d&#39;&#39;&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((2, 8)), staff[0])</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((3, 8)), staff[4])</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((1, 8)), staff[7])</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).mgroups([2])</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Selection([Rest(&#39;r8&#39;), Note(&quot;d&#39;8&quot;), Note(&quot;e&#39;8&quot;), Note(&quot;f&#39;8&quot;)])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \time 2/8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    r8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    d&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    e&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    f&#39;8</span>
<span class="sd">                    \time 3/8</span>
<span class="sd">                    g&#39;8</span>
<span class="sd">                    a&#39;8</span>
<span class="sd">                    b&#39;8</span>
<span class="sd">                    \time 1/8</span>
<span class="sd">                    r8</span>
<span class="sd">                    d&#39;&#39;8</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">group_by_measure</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">partition_by_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">Selection</span><span class="p">)</span>
        <span class="n">result_</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span><span class="n">Selection</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_</span><span class="p">,</span> <span class="n">Selection</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">result_</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result_</span>

    <span class="k">def</span> <span class="nf">mleaves</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;Selection&quot;</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects all leaves in ``count`` measures.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects leaves in first three measures:</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;r8 d&#39; e&#39; f&#39; g&#39; a&#39; b&#39; r&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((2, 8)), staff[0])</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((3, 8)), staff[4])</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((1, 8)), staff[7])</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).mleaves(3)</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Rest(&#39;r8&#39;)</span>
<span class="sd">            Note(&quot;d&#39;8&quot;)</span>
<span class="sd">            Note(&quot;e&#39;8&quot;)</span>
<span class="sd">            Note(&quot;f&#39;8&quot;)</span>
<span class="sd">            Note(&quot;g&#39;8&quot;)</span>
<span class="sd">            Note(&quot;a&#39;8&quot;)</span>
<span class="sd">            Note(&quot;b&#39;8&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \time 2/8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    r8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    d&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    e&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    f&#39;8</span>
<span class="sd">                    \time 3/8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    g&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    a&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    b&#39;8</span>
<span class="sd">                    \time 1/8</span>
<span class="sd">                    r8</span>
<span class="sd">                }</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects leaves in last three measures:</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;r8 d&#39; e&#39; f&#39; g&#39; a&#39; b&#39; r&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((2, 8)), staff[0])</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((3, 8)), staff[4])</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((1, 8)), staff[7])</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).mleaves(-3)</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Note(&quot;e&#39;8&quot;)</span>
<span class="sd">            Note(&quot;f&#39;8&quot;)</span>
<span class="sd">            Note(&quot;g&#39;8&quot;)</span>
<span class="sd">            Note(&quot;a&#39;8&quot;)</span>
<span class="sd">            Note(&quot;b&#39;8&quot;)</span>
<span class="sd">            Rest(&#39;r8&#39;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \time 2/8</span>
<span class="sd">                    r8</span>
<span class="sd">                    d&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    e&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    f&#39;8</span>
<span class="sd">                    \time 3/8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    g&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    a&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    b&#39;8</span>
<span class="sd">                    \time 1/8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    r8</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">group_by_measure</span><span class="p">()</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">count</span><span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">mmrest</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Note</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects multimeasure rest ``n``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects multimeasure rest -1:</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;R1 R1 R1&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).mmrest(-1)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            MultimeasureRest(&#39;R1&#39;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    R1</span>
<span class="sd">                    R1</span>
<span class="sd">                    \abjad-color-music #&#39;green</span>
<span class="sd">                    R1</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mmrests</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">mmrests</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects multimeasure rests.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects multimeasure rests:</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;R1 R1 R1&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).mmrests()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            MultimeasureRest(&#39;R1&#39;)</span>
<span class="sd">            MultimeasureRest(&#39;R1&#39;)</span>
<span class="sd">            MultimeasureRest(&#39;R1&#39;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    R1</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    R1</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    R1</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">MultimeasureRest</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ntrun</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects nontrivial run ``n``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects nontrivial run -1:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 c&#39;16 c&#39;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 d&#39;16 d&#39;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 e&#39;16 e&#39;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).ntrun(-1)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            Selection([Note(&quot;e&#39;16&quot;), Note(&quot;e&#39;16&quot;), Note(&quot;e&#39;16&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ntruns</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">ntruns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects nontrivial runs.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects nontrivial runs:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 c&#39;16 c&#39;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 d&#39;16 d&#39;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 e&#39;16 e&#39;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).ntruns()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Selection([Note(&quot;c&#39;16&quot;), Note(&quot;c&#39;16&quot;), Note(&quot;c&#39;16&quot;), Chord(&quot;&lt;d&#39; e&#39;&gt;4&quot;), Chord(&quot;&lt;d&#39; e&#39;&gt;16&quot;)])</span>
<span class="sd">            Selection([Note(&quot;d&#39;16&quot;), Note(&quot;d&#39;16&quot;), Note(&quot;d&#39;16&quot;), Chord(&quot;&lt;e&#39; fs&#39;&gt;4&quot;), Chord(&quot;&lt;e&#39; fs&#39;&gt;16&quot;)])</span>
<span class="sd">            Selection([Note(&quot;e&#39;16&quot;), Note(&quot;e&#39;16&quot;), Note(&quot;e&#39;16&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">runs</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">nontrivial</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">omgroups</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">counts</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="s2">&quot;Selection&quot;</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Partitions measure-grouped leaves (with overhang).</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Partitions measure-grouped leaves into one part of length 2 followed by an</span>
<span class="sd">            overhang part of remaining measures:</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;r8 d&#39; e&#39; f&#39; g&#39; a&#39; b&#39; r d&#39;&#39;&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((2, 8)), staff[0])</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((3, 8)), staff[4])</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((1, 8)), staff[7])</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).omgroups([2])</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Selection([Rest(&#39;r8&#39;), Note(&quot;d&#39;8&quot;), Note(&quot;e&#39;8&quot;), Note(&quot;f&#39;8&quot;)])</span>
<span class="sd">            Selection([Note(&quot;g&#39;8&quot;), Note(&quot;a&#39;8&quot;), Note(&quot;b&#39;8&quot;), Rest(&#39;r8&#39;), Note(&quot;d&#39;&#39;8&quot;)])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \time 2/8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    r8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    d&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    e&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    f&#39;8</span>
<span class="sd">                    \time 3/8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    g&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    a&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    b&#39;8</span>
<span class="sd">                    \time 1/8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    r8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    d&#39;&#39;8</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">group_by_measure</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">partition_by_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">Selection</span><span class="p">)</span>
        <span class="n">result_</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span><span class="n">Selection</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_</span><span class="p">,</span> <span class="n">Selection</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">result_</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result_</span>

    <span class="k">def</span> <span class="nf">ompltgroups</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">counts</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="s2">&quot;Selection&quot;</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Partitions measure-grouped plts (with overhang).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plts</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">group_by_measure</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">partition_by_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">Selection</span><span class="p">)</span>
        <span class="n">result_</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span><span class="n">Selection</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_</span><span class="p">,</span> <span class="n">Selection</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">result_</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result_</span>

    <span class="k">def</span> <span class="nf">phead</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Note</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Chord</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects pitched head ``n``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects pitched head -1:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).phead(-1)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pheads</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">pheads</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">grace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects pitched heads.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects pitched heads:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).pheads()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;c&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;d&#39; e&#39;&gt;4&quot;)</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;d&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;e&#39; fs&#39;&gt;4&quot;)</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;e&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plts</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">grace</span><span class="o">=</span><span class="n">grace</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">Selection</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span><span class="n">Selection</span><span class="p">(</span><span class="n">_</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">pleaf</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">grace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Note</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Chord</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects pitched leaf ``n``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects pitched leaf -1:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).pleaf(-1)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pleaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">grace</span><span class="o">=</span><span class="n">grace</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">pleaves</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">grace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects pitched leaves.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects pitched leaves:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).pleaves()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;c&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;d&#39; e&#39;&gt;4&quot;)</span>
<span class="sd">            Chord(&quot;&lt;d&#39; e&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;d&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;e&#39; fs&#39;&gt;4&quot;)</span>
<span class="sd">            Chord(&quot;&lt;e&#39; fs&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;e&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;)</span>
<span class="sd">            Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">grace</span><span class="o">=</span><span class="n">grace</span><span class="p">,</span> <span class="n">pitched</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plt</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">grace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects pitched logical tie ``n``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects pitched logical tie -1:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).plt(-1)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            LogicalTie([Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plts</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">grace</span><span class="o">=</span><span class="n">grace</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">plts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">grace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects pitched logical ties.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects pitched logical ties:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).plts()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            LogicalTie([Note(&quot;bf&#39;16&quot;)])</span>
<span class="sd">            LogicalTie([Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)])</span>
<span class="sd">            LogicalTie([Note(&quot;c&#39;16&quot;)])</span>
<span class="sd">            LogicalTie([Chord(&quot;&lt;d&#39; e&#39;&gt;4&quot;), Chord(&quot;&lt;d&#39; e&#39;&gt;16&quot;)])</span>
<span class="sd">            LogicalTie([Note(&quot;bf&#39;16&quot;)])</span>
<span class="sd">            LogicalTie([Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)])</span>
<span class="sd">            LogicalTie([Note(&quot;d&#39;16&quot;)])</span>
<span class="sd">            LogicalTie([Chord(&quot;&lt;e&#39; fs&#39;&gt;4&quot;), Chord(&quot;&lt;e&#39; fs&#39;&gt;16&quot;)])</span>
<span class="sd">            LogicalTie([Note(&quot;bf&#39;16&quot;)])</span>
<span class="sd">            LogicalTie([Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)])</span>
<span class="sd">            LogicalTie([Note(&quot;e&#39;16&quot;)])</span>
<span class="sd">            LogicalTie([Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_ties</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">grace</span><span class="o">=</span><span class="n">grace</span><span class="p">,</span> <span class="n">pitched</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ptail</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Note</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Chord</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects pitched tail ``n``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects pitched tail -1:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).ptail(-1)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptails</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">ptails</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects pitched tails.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects pitched tails:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).ptails()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;c&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;d&#39; e&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;d&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;e&#39; fs&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;e&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plts</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">Selection</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span><span class="n">Selection</span><span class="p">(</span><span class="n">_</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">ptlt</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects pitched trivial logical tie ``n``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects pitched trivial logical tie -1:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).ptlt(-1)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            LogicalTie([Note(&quot;e&#39;16&quot;)])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptlts</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">ptlts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects pitched trivial logical ties.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects pitched trivial logical ties:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).ptlts()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            LogicalTie([Note(&quot;bf&#39;16&quot;)])</span>
<span class="sd">            LogicalTie([Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)])</span>
<span class="sd">            LogicalTie([Note(&quot;c&#39;16&quot;)])</span>
<span class="sd">            LogicalTie([Note(&quot;bf&#39;16&quot;)])</span>
<span class="sd">            LogicalTie([Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)])</span>
<span class="sd">            LogicalTie([Note(&quot;d&#39;16&quot;)])</span>
<span class="sd">            LogicalTie([Note(&quot;bf&#39;16&quot;)])</span>
<span class="sd">            LogicalTie([Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)])</span>
<span class="sd">            LogicalTie([Note(&quot;e&#39;16&quot;)])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_ties</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">nontrivial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pitched</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qrun</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects equipitch run ``n``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects equipitch run -1:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 c&#39;16 c&#39;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 d&#39;16 d&#39;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 e&#39;16 e&#39;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).qrun(-1)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            Selection([Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">qruns</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">qruns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects equipitch runs.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects equipitch runs:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 c&#39;16 c&#39;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 d&#39;16 d&#39;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 e&#39;16 e&#39;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).qruns()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Selection([Note(&quot;c&#39;16&quot;), Note(&quot;c&#39;16&quot;), Note(&quot;c&#39;16&quot;)])</span>
<span class="sd">            Selection([Chord(&quot;&lt;d&#39; e&#39;&gt;4&quot;), Chord(&quot;&lt;d&#39; e&#39;&gt;16&quot;)])</span>
<span class="sd">            Selection([Note(&quot;d&#39;16&quot;), Note(&quot;d&#39;16&quot;), Note(&quot;d&#39;16&quot;)])</span>
<span class="sd">            Selection([Chord(&quot;&lt;e&#39; fs&#39;&gt;4&quot;), Chord(&quot;&lt;e&#39; fs&#39;&gt;16&quot;)])</span>
<span class="sd">            Selection([Note(&quot;e&#39;16&quot;), Note(&quot;e&#39;16&quot;), Note(&quot;e&#39;16&quot;)])</span>
<span class="sd">            Selection([Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pleaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">group_by_pitch</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">Selection</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span><span class="n">Selection</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="o">.</span><span class="n">group_by_contiguity</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">Selection</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span><span class="n">Selection</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">rleaf</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects leaf ``n`` from leaves leaked to the right.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects leaf -1 from leaves (leaked to the right) in tuplet 1:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).tuplets()[1:2].rleaf(-1)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            Rest(&#39;r16&#39;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rleaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">rleak</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">grace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Leaks to the right.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects runs (each leaked to the right):</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;c&#39;8 r8 d&#39;8 e&#39;8 r8 f&#39;8 g&#39;8 a&#39;8&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>

<span class="sd">            &gt;&gt;&gt; result = baca.Selection(staff).runs()</span>
<span class="sd">            &gt;&gt;&gt; result = [baca.Selection(_).rleak() for _ in result]</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Selection([Note(&quot;c&#39;8&quot;), Rest(&#39;r8&#39;)])</span>
<span class="sd">            Selection([Note(&quot;d&#39;8&quot;), Note(&quot;e&#39;8&quot;), Rest(&#39;r8&#39;)])</span>
<span class="sd">            Selection([Note(&quot;f&#39;8&quot;), Note(&quot;g&#39;8&quot;), Note(&quot;a&#39;8&quot;)])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    r8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    d&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    e&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    r8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    f&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    g&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    a&#39;8</span>
<span class="sd">                }</span>

<span class="sd">        Returns new selection (or expression).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_next_leaf</span><span class="p">(</span><span class="n">grace</span><span class="o">=</span><span class="n">grace</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rleaves</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects leaves, leaked to the right.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects leaves (leaked to the right) in tuplet 1:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).tuplets()[1:2].rleaves()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Rest(&#39;r16&#39;)</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;d&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;e&#39; fs&#39;&gt;4&quot;)</span>
<span class="sd">            Chord(&quot;&lt;e&#39; fs&#39;&gt;16&quot;)</span>
<span class="sd">            Rest(&#39;r16&#39;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">with_next_leaf</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">rmleaves</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects all leaves in ``count`` measures, leaked one leaf to the right.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects leaves in first two measures, leaked on leaf to the right:</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;r8 d&#39; e&#39; f&#39; g&#39; a&#39; b&#39; r&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((2, 8)), staff[0])</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((3, 8)), staff[4])</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((1, 8)), staff[7])</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).rmleaves(2)</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Rest(&#39;r8&#39;)</span>
<span class="sd">            Note(&quot;d&#39;8&quot;)</span>
<span class="sd">            Note(&quot;e&#39;8&quot;)</span>
<span class="sd">            Note(&quot;f&#39;8&quot;)</span>
<span class="sd">            Note(&quot;g&#39;8&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \time 2/8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    r8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    d&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    e&#39;8</span>
<span class="sd">                    \abjad-color-music #&#39;blue</span>
<span class="sd">                    f&#39;8</span>
<span class="sd">                    \time 3/8</span>
<span class="sd">                    \abjad-color-music #&#39;red</span>
<span class="sd">                    g&#39;8</span>
<span class="sd">                    a&#39;8</span>
<span class="sd">                    b&#39;8</span>
<span class="sd">                    \time 1/8</span>
<span class="sd">                    r8</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mleaves</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">rleak</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">rrun</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects run ``n`` (leaked to the right).</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects run 1 (leaked to the right):</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 c&#39;16 c&#39;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 d&#39;16 d&#39;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 e&#39;16 e&#39;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).rrun(1)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            Selection([Note(&quot;d&#39;16&quot;), Note(&quot;d&#39;16&quot;), Note(&quot;d&#39;16&quot;), Chord(&quot;&lt;e&#39; fs&#39;&gt;4&quot;), Chord(&quot;&lt;e&#39; fs&#39;&gt;16&quot;), Rest(&#39;r16&#39;)])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        r16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rruns</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">rruns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects runs (leaked to the right).</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects runs (leaked to the right):</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 c&#39;16 c&#39;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 d&#39;16 d&#39;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 e&#39;16 e&#39;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).rruns()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Selection([Note(&quot;c&#39;16&quot;), Note(&quot;c&#39;16&quot;), Note(&quot;c&#39;16&quot;), Chord(&quot;&lt;d&#39; e&#39;&gt;4&quot;), Chord(&quot;&lt;d&#39; e&#39;&gt;16&quot;), Rest(&#39;r16&#39;)])</span>
<span class="sd">            Selection([Note(&quot;d&#39;16&quot;), Note(&quot;d&#39;16&quot;), Note(&quot;d&#39;16&quot;), Chord(&quot;&lt;e&#39; fs&#39;&gt;4&quot;), Chord(&quot;&lt;e&#39; fs&#39;&gt;16&quot;), Rest(&#39;r16&#39;)])</span>
<span class="sd">            Selection([Note(&quot;e&#39;16&quot;), Note(&quot;e&#39;16&quot;), Note(&quot;e&#39;16&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;), Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)])</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runs</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">Selection</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span><span class="n">Selection</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="o">.</span><span class="n">rleak</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">skip</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Skip</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects skip ``n``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects skip -1:</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;c&#39;8 s e&#39; f&#39; g&#39; s b&#39; s&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((2, 8)), staff[0])</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((3, 8)), staff[4])</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((1, 8)), staff[7])</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).skip(-1)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            Skip(&#39;s8&#39;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \time 2/8</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                    s8</span>
<span class="sd">                    e&#39;8</span>
<span class="sd">                    f&#39;8</span>
<span class="sd">                    \time 3/8</span>
<span class="sd">                    g&#39;8</span>
<span class="sd">                    s8</span>
<span class="sd">                    b&#39;8</span>
<span class="sd">                    % green</span>
<span class="sd">                    \time 1/8</span>
<span class="sd">                    s8</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">skips</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">skips</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects skips.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects skips:</span>

<span class="sd">            &gt;&gt;&gt; staff = abjad.Staff(&quot;c&#39;8 s e&#39; f&#39; g&#39; s b&#39; s&quot;)</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((2, 8)), staff[0])</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((3, 8)), staff[4])</span>
<span class="sd">            &gt;&gt;&gt; abjad.attach(abjad.TimeSignature((1, 8)), staff[7])</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).skips()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            Skip(&#39;s8&#39;)</span>
<span class="sd">            Skip(&#39;s8&#39;)</span>
<span class="sd">            Skip(&#39;s8&#39;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \time 2/8</span>
<span class="sd">                    c&#39;8</span>
<span class="sd">                    % red</span>
<span class="sd">                    s8</span>
<span class="sd">                    e&#39;8</span>
<span class="sd">                    f&#39;8</span>
<span class="sd">                    \time 3/8</span>
<span class="sd">                    g&#39;8</span>
<span class="sd">                    % blue</span>
<span class="sd">                    s8</span>
<span class="sd">                    b&#39;8</span>
<span class="sd">                    % red</span>
<span class="sd">                    \time 1/8</span>
<span class="sd">                    s8</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Skip</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tleaf</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">grace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects trimmed leaf ``n``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects trimmed leaf 0:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).tleaf(0)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tleaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">grace</span><span class="o">=</span><span class="n">grace</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">tleaves</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">grace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects trimmed leaves.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects trimmed leaves:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).tleaves()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;c&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;d&#39; e&#39;&gt;4&quot;)</span>
<span class="sd">            Chord(&quot;&lt;d&#39; e&#39;&gt;16&quot;)</span>
<span class="sd">            Rest(&#39;r16&#39;)</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;d&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;e&#39; fs&#39;&gt;4&quot;)</span>
<span class="sd">            Chord(&quot;&lt;e&#39; fs&#39;&gt;16&quot;)</span>
<span class="sd">            Rest(&#39;r16&#39;)</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;e&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;fs&#39; gs&#39;&gt;4&quot;)</span>
<span class="sd">            Chord(&quot;&lt;fs&#39; gs&#39;&gt;16&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">grace</span><span class="o">=</span><span class="n">grace</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">wleaf</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects leaf ``n`` from leaves leaked wide.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects leaf 0 from leaves (leaked to both the left and right) in tuplet 1:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).tuplets()[1:2].wleaf(0)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            Chord(&quot;&lt;d&#39; e&#39;&gt;16&quot;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects leaf -1 from leaves (leaked to both the left and right) in tuplet 1:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).tuplets()[1:2].wleaf(-1)</span>
<span class="sd">            &gt;&gt;&gt; result</span>
<span class="sd">            Rest(&#39;r16&#39;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector(lone=True)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;green</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">(),</span> <span class="n">lone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wleaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">wleaves</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Strings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Selection</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects leaves, leaked &quot;wide&quot; (to both the left and right).</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Selects leaves (leaked wide) in tuplet 1:</span>

<span class="sd">            &gt;&gt;&gt; tuplets = [</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 c&#39;16 &lt;d&#39; e&#39;&gt;4 ~ &lt;d&#39; e&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 d&#39;16 &lt;e&#39; fs&#39;&gt;4 ~ &lt;e&#39; fs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     &quot;r16 bf&#39;16 &lt;a&#39;&#39; b&#39;&#39;&gt;16 e&#39;16 &lt;fs&#39; gs&#39;&gt;4 ~ &lt;fs&#39; gs&#39;&gt;16&quot;,</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = zip([(10, 9), (8, 9), (10, 9)], tuplets)</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.Tuplet(*_) for _ in tuplets]</span>
<span class="sd">            &gt;&gt;&gt; tuplets = [abjad.select(tuplets)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(tuplets)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[abjad.Staff]</span>
<span class="sd">            &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.direction = abjad.Up</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TupletBracket.staff_padding = 3</span>

<span class="sd">            &gt;&gt;&gt; result = baca.select(staff).tuplets()[1:2].wleaves()</span>
<span class="sd">            &gt;&gt;&gt; for item in result:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Chord(&quot;&lt;d&#39; e&#39;&gt;16&quot;)</span>
<span class="sd">            Rest(&#39;r16&#39;)</span>
<span class="sd">            Note(&quot;bf&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;a&#39;&#39; b&#39;&#39;&gt;16&quot;)</span>
<span class="sd">            Note(&quot;d&#39;16&quot;)</span>
<span class="sd">            Chord(&quot;&lt;e&#39; fs&#39;&gt;4&quot;)</span>
<span class="sd">            Chord(&quot;&lt;e&#39; fs&#39;&gt;16&quot;)</span>
<span class="sd">            Rest(&#39;r16&#39;)</span>

<span class="sd">            &gt;&gt;&gt; abjad.Label(result).by_selector()</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Staff</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override TupletBracket.direction = #up</span>
<span class="sd">                    \override TupletBracket.staff-padding = 3</span>
<span class="sd">                    autoBeaming = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        r16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;d&#39; e&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \times 8/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        r16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \abjad-color-music #&#39;red</span>
<span class="sd">                        &lt;e&#39; fs&#39;&gt;16</span>
<span class="sd">                    }</span>
<span class="sd">                    \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                    \times 10/9 {</span>
<span class="sd">                        \abjad-color-music #&#39;blue</span>
<span class="sd">                        r16</span>
<span class="sd">                        bf&#39;16</span>
<span class="sd">                        &lt;a&#39;&#39; b&#39;&#39;&gt;16</span>
<span class="sd">                        e&#39;16</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        &lt;fs&#39; gs&#39;&gt;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_expression</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span><span class="o">.</span><span class="n">with_previous_leaf</span><span class="p">()</span><span class="o">.</span><span class="n">with_next_leaf</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Sequence</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Sequence</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sequence.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Initializes from numbers:</span>

<span class="sd">        &gt;&gt;&gt; baca.Sequence([1, 2, 3, 4, 5, 6])</span>
<span class="sd">        Sequence([1, 2, 3, 4, 5, 6])</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Initializes from collection:</span>

<span class="sd">        &gt;&gt;&gt; items = [-2, -1.5, 6, 7, -1.5, 7]</span>
<span class="sd">        &gt;&gt;&gt; collection = abjad.PitchClassSegment(items=items)</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = abjad.illustrate(collection)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; voice = lilypond_file[abjad.Score][0][0]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(voice)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \new Voice</span>
<span class="sd">            {</span>
<span class="sd">                bf&#39;8</span>
<span class="sd">                bqf&#39;8</span>
<span class="sd">                fs&#39;8</span>
<span class="sd">                g&#39;8</span>
<span class="sd">                bqf&#39;8</span>
<span class="sd">                g&#39;8</span>
<span class="sd">                \bar &quot;|.&quot;</span>
<span class="sd">                \override Score.BarLine.transparent = ##f</span>
<span class="sd">            }</span>

<span class="sd">        &gt;&gt;&gt; baca.Sequence(collection)</span>
<span class="sd">        Sequence([NumberedPitchClass(10), NumberedPitchClass(10.5), NumberedPitchClass(6), NumberedPitchClass(7), NumberedPitchClass(10.5), NumberedPitchClass(7)])</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Maps transposition to multiple collections:</span>

<span class="sd">        &gt;&gt;&gt; items = [-2, -1.5, 6, 7, -1.5, 7]</span>
<span class="sd">        &gt;&gt;&gt; collection = abjad.PitchClassSegment(items=items)</span>
<span class="sd">        &gt;&gt;&gt; collections = [</span>
<span class="sd">        ...     abjad.PitchClassSegment(items=[-2, -1.5, 6]),</span>
<span class="sd">        ...     abjad.PitchClassSegment(items=[7, -1.5, 7]),</span>
<span class="sd">        ...     ]</span>

<span class="sd">        &gt;&gt;&gt; sequence = baca.Sequence(collections)</span>
<span class="sd">        &gt;&gt;&gt; sequence = sequence.map(lambda _: _.transpose(n=1))</span>
<span class="sd">        &gt;&gt;&gt; sequence.join()</span>
<span class="sd">        Sequence([PitchClassSegment([11, 11.5, 7, 8, 11.5, 8])])</span>

<span class="sd">        &gt;&gt;&gt; collection = sequence.join()[0]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = abjad.illustrate(collection)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; voice = lilypond_file[abjad.Score][0][0]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(voice)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \new Voice</span>
<span class="sd">            {</span>
<span class="sd">                b&#39;8</span>
<span class="sd">                bqs&#39;8</span>
<span class="sd">                g&#39;8</span>
<span class="sd">                af&#39;8</span>
<span class="sd">                bqs&#39;8</span>
<span class="sd">                af&#39;8</span>
<span class="sd">                \bar &quot;|.&quot;</span>
<span class="sd">                \override Score.BarLine.transparent = ##f</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">### CLASS VARIABLES ###</span>

    <span class="n">__documentation_section__</span> <span class="o">=</span> <span class="s2">&quot;Classes&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>

    <span class="c1">### PUBLIC METHODS ###</span>

<div class="viewcode-block" id="Sequence.accumulate"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.accumulate">[docs]</a>    <span class="k">def</span> <span class="nf">accumulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operands</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Accumulates ``operands`` calls against sequence to identity.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Accumulates identity operator:</span>

<span class="sd">            &gt;&gt;&gt; collection_1 = baca.PitchClassSegment([0, 1, 2, 3])</span>
<span class="sd">            &gt;&gt;&gt; collection_2 = baca.PitchClassSegment([4, 5])</span>
<span class="sd">            &gt;&gt;&gt; baca.Sequence([collection_1, collection_2])</span>
<span class="sd">            Sequence([PitchClassSegment([0, 1, 2, 3]), PitchClassSegment([4, 5])])</span>

<span class="sd">            &gt;&gt;&gt; sequence = baca.Sequence([collection_1, collection_2])</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence.accumulate():</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([PitchClassSegment([0, 1, 2, 3]), PitchClassSegment([4, 5])])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Accumulates alpha:</span>

<span class="sd">            &gt;&gt;&gt; collection_1 = baca.PitchClassSegment([0, 1, 2, 3])</span>
<span class="sd">            &gt;&gt;&gt; collection_2 = baca.PitchClassSegment([4, 5])</span>
<span class="sd">            &gt;&gt;&gt; baca.Sequence([collection_1, collection_2])</span>
<span class="sd">            Sequence([PitchClassSegment([0, 1, 2, 3]), PitchClassSegment([4, 5])])</span>

<span class="sd">            &gt;&gt;&gt; sequence = baca.Sequence([collection_1, collection_2])</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence.accumulate([lambda _: _.alpha()]):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([PitchClassSegment([0, 1, 2, 3]), PitchClassSegment([4, 5])])</span>
<span class="sd">            Sequence([PitchClassSegment([1, 0, 3, 2]), PitchClassSegment([5, 4])])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Accumulates transposition:</span>

<span class="sd">            &gt;&gt;&gt; collection_1 = baca.PitchClassSegment([0, 1, 2, 3])</span>
<span class="sd">            &gt;&gt;&gt; collection_2 = baca.PitchClassSegment([4, 5])</span>
<span class="sd">            &gt;&gt;&gt; baca.Sequence([collection_1, collection_2])</span>
<span class="sd">            Sequence([PitchClassSegment([0, 1, 2, 3]), PitchClassSegment([4, 5])])</span>

<span class="sd">            &gt;&gt;&gt; sequence = baca.Sequence([collection_1, collection_2])</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence.accumulate([lambda _: _.transpose(n=3)]):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([PitchClassSegment([0, 1, 2, 3]), PitchClassSegment([4, 5])])</span>
<span class="sd">            Sequence([PitchClassSegment([3, 4, 5, 6]), PitchClassSegment([7, 8])])</span>
<span class="sd">            Sequence([PitchClassSegment([6, 7, 8, 9]), PitchClassSegment([10, 11])])</span>
<span class="sd">            Sequence([PitchClassSegment([9, 10, 11, 0]), PitchClassSegment([1, 2])])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Accumulates alpha followed by transposition:</span>

<span class="sd">            &gt;&gt;&gt; collection_1 = baca.PitchClassSegment([0, 1, 2, 3])</span>
<span class="sd">            &gt;&gt;&gt; collection_2 = baca.PitchClassSegment([4, 5])</span>
<span class="sd">            &gt;&gt;&gt; baca.Sequence([collection_1, collection_2])</span>
<span class="sd">            Sequence([PitchClassSegment([0, 1, 2, 3]), PitchClassSegment([4, 5])])</span>

<span class="sd">            &gt;&gt;&gt; sequence = baca.Sequence([collection_1, collection_2])</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence.accumulate([lambda _: _.alpha(), lambda _: _.transpose(n=3)]):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([PitchClassSegment([0, 1, 2, 3]), PitchClassSegment([4, 5])])</span>
<span class="sd">            Sequence([PitchClassSegment([1, 0, 3, 2]), PitchClassSegment([5, 4])])</span>
<span class="sd">            Sequence([PitchClassSegment([4, 3, 6, 5]), PitchClassSegment([8, 7])])</span>
<span class="sd">            Sequence([PitchClassSegment([5, 2, 7, 4]), PitchClassSegment([9, 6])])</span>
<span class="sd">            Sequence([PitchClassSegment([8, 5, 10, 7]), PitchClassSegment([0, 9])])</span>
<span class="sd">            Sequence([PitchClassSegment([9, 4, 11, 6]), PitchClassSegment([1, 8])])</span>
<span class="sd">            Sequence([PitchClassSegment([0, 7, 2, 9]), PitchClassSegment([4, 11])])</span>
<span class="sd">            Sequence([PitchClassSegment([1, 6, 3, 8]), PitchClassSegment([5, 10])])</span>
<span class="sd">            Sequence([PitchClassSegment([4, 9, 6, 11]), PitchClassSegment([8, 1])])</span>
<span class="sd">            Sequence([PitchClassSegment([5, 8, 7, 10]), PitchClassSegment([9, 0])])</span>
<span class="sd">            Sequence([PitchClassSegment([8, 11, 10, 1]), PitchClassSegment([0, 3])])</span>
<span class="sd">            Sequence([PitchClassSegment([9, 10, 11, 0]), PitchClassSegment([1, 2])])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Accumulates permutation:</span>

<span class="sd">            &gt;&gt;&gt; collection_1 = baca.PitchClassSegment([0, 1, 2, 3])</span>
<span class="sd">            &gt;&gt;&gt; collection_2 = baca.PitchClassSegment([4, 5])</span>
<span class="sd">            &gt;&gt;&gt; baca.Sequence([collection_1, collection_2])</span>
<span class="sd">            Sequence([PitchClassSegment([0, 1, 2, 3]), PitchClassSegment([4, 5])])</span>

<span class="sd">            &gt;&gt;&gt; row = [10, 0, 2, 6, 8, 7, 5, 3, 1, 9, 4, 11]</span>
<span class="sd">            &gt;&gt;&gt; sequence = baca.Sequence([collection_1, collection_2])</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence.accumulate([lambda _: _.permute(row)]):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([PitchClassSegment([0, 1, 2, 3]), PitchClassSegment([4, 5])])</span>
<span class="sd">            Sequence([PitchClassSegment([10, 0, 2, 6]), PitchClassSegment([8, 7])])</span>
<span class="sd">            Sequence([PitchClassSegment([4, 10, 2, 5]), PitchClassSegment([1, 3])])</span>
<span class="sd">            Sequence([PitchClassSegment([8, 4, 2, 7]), PitchClassSegment([0, 6])])</span>
<span class="sd">            Sequence([PitchClassSegment([1, 8, 2, 3]), PitchClassSegment([10, 5])])</span>
<span class="sd">            Sequence([PitchClassSegment([0, 1, 2, 6]), PitchClassSegment([4, 7])])</span>
<span class="sd">            Sequence([PitchClassSegment([10, 0, 2, 5]), PitchClassSegment([8, 3])])</span>
<span class="sd">            Sequence([PitchClassSegment([4, 10, 2, 7]), PitchClassSegment([1, 6])])</span>
<span class="sd">            Sequence([PitchClassSegment([8, 4, 2, 3]), PitchClassSegment([0, 5])])</span>
<span class="sd">            Sequence([PitchClassSegment([1, 8, 2, 6]), PitchClassSegment([10, 7])])</span>
<span class="sd">            Sequence([PitchClassSegment([0, 1, 2, 5]), PitchClassSegment([4, 3])])</span>
<span class="sd">            Sequence([PitchClassSegment([10, 0, 2, 7]), PitchClassSegment([8, 6])])</span>
<span class="sd">            Sequence([PitchClassSegment([4, 10, 2, 3]), PitchClassSegment([1, 5])])</span>
<span class="sd">            Sequence([PitchClassSegment([8, 4, 2, 6]), PitchClassSegment([0, 7])])</span>
<span class="sd">            Sequence([PitchClassSegment([1, 8, 2, 5]), PitchClassSegment([10, 3])])</span>
<span class="sd">            Sequence([PitchClassSegment([0, 1, 2, 7]), PitchClassSegment([4, 6])])</span>
<span class="sd">            Sequence([PitchClassSegment([10, 0, 2, 3]), PitchClassSegment([8, 5])])</span>
<span class="sd">            Sequence([PitchClassSegment([4, 10, 2, 6]), PitchClassSegment([1, 7])])</span>
<span class="sd">            Sequence([PitchClassSegment([8, 4, 2, 5]), PitchClassSegment([0, 3])])</span>
<span class="sd">            Sequence([PitchClassSegment([1, 8, 2, 7]), PitchClassSegment([10, 6])])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Accumulates permutation followed by transposition:</span>

<span class="sd">            &gt;&gt;&gt; collection_1 = baca.PitchClassSegment([0, 1, 2, 3])</span>
<span class="sd">            &gt;&gt;&gt; collection_2 = baca.PitchClassSegment([4, 5])</span>
<span class="sd">            &gt;&gt;&gt; baca.Sequence([collection_1, collection_2])</span>
<span class="sd">            Sequence([PitchClassSegment([0, 1, 2, 3]), PitchClassSegment([4, 5])])</span>

<span class="sd">            &gt;&gt;&gt; row = [10, 0, 2, 6, 8, 7, 5, 3, 1, 9, 4, 11]</span>
<span class="sd">            &gt;&gt;&gt; sequence = baca.Sequence([collection_1, collection_2])</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence.accumulate(</span>
<span class="sd">            ...     [lambda _: _.permute(row), lambda _: _.transpose(n=3)],</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([PitchClassSegment([0, 1, 2, 3]), PitchClassSegment([4, 5])])</span>
<span class="sd">            Sequence([PitchClassSegment([10, 0, 2, 6]), PitchClassSegment([8, 7])])</span>
<span class="sd">            Sequence([PitchClassSegment([1, 3, 5, 9]), PitchClassSegment([11, 10])])</span>
<span class="sd">            Sequence([PitchClassSegment([0, 6, 7, 9]), PitchClassSegment([11, 4])])</span>
<span class="sd">            Sequence([PitchClassSegment([3, 9, 10, 0]), PitchClassSegment([2, 7])])</span>
<span class="sd">            Sequence([PitchClassSegment([6, 9, 4, 10]), PitchClassSegment([2, 3])])</span>
<span class="sd">            Sequence([PitchClassSegment([9, 0, 7, 1]), PitchClassSegment([5, 6])])</span>
<span class="sd">            Sequence([PitchClassSegment([9, 10, 3, 0]), PitchClassSegment([7, 5])])</span>
<span class="sd">            Sequence([PitchClassSegment([0, 1, 6, 3]), PitchClassSegment([10, 8])])</span>
<span class="sd">            Sequence([PitchClassSegment([10, 0, 5, 6]), PitchClassSegment([4, 1])])</span>
<span class="sd">            Sequence([PitchClassSegment([1, 3, 8, 9]), PitchClassSegment([7, 4])])</span>
<span class="sd">            Sequence([PitchClassSegment([0, 6, 1, 9]), PitchClassSegment([3, 8])])</span>
<span class="sd">            Sequence([PitchClassSegment([3, 9, 4, 0]), PitchClassSegment([6, 11])])</span>
<span class="sd">            Sequence([PitchClassSegment([6, 9, 8, 10]), PitchClassSegment([5, 11])])</span>
<span class="sd">            Sequence([PitchClassSegment([9, 0, 11, 1]), PitchClassSegment([8, 2])])</span>
<span class="sd">            Sequence([PitchClassSegment([9, 10, 11, 0]), PitchClassSegment([1, 2])])</span>

<span class="sd">        Returns sequence of accumulated sequences.</span>

<span class="sd">        Returns sequence of length ``count`` + 1 with integer ``count``.</span>

<span class="sd">        Returns sequence of orbit length with ``count`` set to identity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Exact</span>
        <span class="n">operands</span> <span class="o">=</span> <span class="n">operands</span> <span class="ow">or</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="n">_</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operands</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">operands</span> <span class="o">=</span> <span class="p">[</span><span class="n">operands</span><span class="p">]</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Exact</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
                <span class="n">sequence</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">operand</span> <span class="ow">in</span> <span class="n">operands</span><span class="p">:</span>
                    <span class="n">sequence</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">operand</span><span class="p">)</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sequence</span> <span class="o">==</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;1000 iterations without identity:&quot;</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">!r}</span><span class="s2"> to </span><span class="si">{</span><span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">!r}</span><span class="s2">.&quot;</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">sequence</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">operand</span> <span class="ow">in</span> <span class="n">operands</span><span class="p">:</span>
                    <span class="n">sequence</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">operand</span><span class="p">)</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.boustrophedon"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.boustrophedon">[docs]</a>    <span class="k">def</span> <span class="nf">boustrophedon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates sequence boustrophedon.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Iterates atoms boustrophedon:</span>

<span class="sd">            &gt;&gt;&gt; sequence = baca.Sequence([1, 2, 3, 4, 5])</span>

<span class="sd">            &gt;&gt;&gt; sequence.boustrophedon(count=0)</span>
<span class="sd">            Sequence([])</span>

<span class="sd">            &gt;&gt;&gt; sequence.boustrophedon(count=1)</span>
<span class="sd">            Sequence([1, 2, 3, 4, 5])</span>

<span class="sd">            &gt;&gt;&gt; sequence.boustrophedon(count=2)</span>
<span class="sd">            Sequence([1, 2, 3, 4, 5, 4, 3, 2, 1])</span>

<span class="sd">            &gt;&gt;&gt; sequence.boustrophedon(count=3)</span>
<span class="sd">            Sequence([1, 2, 3, 4, 5, 4, 3, 2, 1, 2, 3, 4, 5])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Iterates collections boustrophedon:</span>

<span class="sd">            &gt;&gt;&gt; collections = [</span>
<span class="sd">            ...     baca.PitchClassSegment([1, 2, 3]),</span>
<span class="sd">            ...     baca.PitchClassSegment([4, 5, 6]),</span>
<span class="sd">            ...     ]</span>
<span class="sd">            &gt;&gt;&gt; sequence = baca.Sequence(collections)</span>

<span class="sd">            &gt;&gt;&gt; sequence.boustrophedon(count=0)</span>
<span class="sd">            Sequence([])</span>

<span class="sd">            &gt;&gt;&gt; for collection in sequence.boustrophedon(count=1):</span>
<span class="sd">            ...     collection</span>
<span class="sd">            ...</span>
<span class="sd">            PitchClassSegment([1, 2, 3])</span>
<span class="sd">            PitchClassSegment([4, 5, 6])</span>

<span class="sd">            &gt;&gt;&gt; for collection in sequence.boustrophedon(count=2):</span>
<span class="sd">            ...     collection</span>
<span class="sd">            ...</span>
<span class="sd">            PitchClassSegment([1, 2, 3])</span>
<span class="sd">            PitchClassSegment([4, 5, 6])</span>
<span class="sd">            PitchClassSegment([5, 4])</span>
<span class="sd">            PitchClassSegment([3, 2, 1])</span>

<span class="sd">            &gt;&gt;&gt; for collection in sequence.boustrophedon(count=3):</span>
<span class="sd">            ...     collection</span>
<span class="sd">            ...</span>
<span class="sd">            PitchClassSegment([1, 2, 3])</span>
<span class="sd">            PitchClassSegment([4, 5, 6])</span>
<span class="sd">            PitchClassSegment([5, 4])</span>
<span class="sd">            PitchClassSegment([3, 2, 1])</span>
<span class="sd">            PitchClassSegment([2, 3])</span>
<span class="sd">            PitchClassSegment([4, 5, 6])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Iterates mixed items boustrophedon:</span>

<span class="sd">            &gt;&gt;&gt; collection = baca.PitchClassSegment([1, 2, 3])</span>
<span class="sd">            &gt;&gt;&gt; sequence = baca.Sequence([collection, 4, 5])</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence.boustrophedon(count=3):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            PitchClassSegment([1, 2, 3])</span>
<span class="sd">            4</span>
<span class="sd">            5</span>
<span class="sd">            4</span>
<span class="sd">            PitchClassSegment([3, 2, 1])</span>
<span class="sd">            PitchClassSegment([2, 3])</span>
<span class="sd">            4</span>
<span class="sd">            5</span>

<span class="sd">        Returns new sequence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])(</span><span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))[</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
                        <span class="n">item</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)(</span><span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">item</span><span class="p">)))</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.degree_of_rotational_symmetry"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.degree_of_rotational_symmetry">[docs]</a>    <span class="k">def</span> <span class="nf">degree_of_rotational_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets degree of rotational symmetry.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; baca.Sequence([1, 1, 1, 1, 1, 1]).degree_of_rotational_symmetry()</span>
<span class="sd">            6</span>

<span class="sd">            &gt;&gt;&gt; baca.Sequence([1, 2, 1, 2, 1, 2]).degree_of_rotational_symmetry()</span>
<span class="sd">            3</span>

<span class="sd">            &gt;&gt;&gt; baca.Sequence([1, 2, 3, 1, 2, 3]).degree_of_rotational_symmetry()</span>
<span class="sd">            2</span>

<span class="sd">            &gt;&gt;&gt; baca.Sequence([1, 2, 3, 4, 5, 6]).degree_of_rotational_symmetry()</span>
<span class="sd">            1</span>

<span class="sd">            &gt;&gt;&gt; baca.Sequence().degree_of_rotational_symmetry()</span>
<span class="sd">            1</span>

<span class="sd">        Returns positive integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">degree_of_rotational_symmetry</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="n">rotation</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[:</span><span class="n">index</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">rotation</span> <span class="o">==</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">degree_of_rotational_symmetry</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">degree_of_rotational_symmetry</span> <span class="o">=</span> <span class="n">degree_of_rotational_symmetry</span> <span class="ow">or</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">degree_of_rotational_symmetry</span></div>

    <span class="c1"># TODO: remove ``counts`` in favor of partition-then-``indices`` recipe</span>
    <span class="c1"># TODO: generalize ``indices`` to pattern</span>
<div class="viewcode-block" id="Sequence.fuse"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.fuse">[docs]</a>    <span class="k">def</span> <span class="nf">fuse</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">counts</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">cyclic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">indices</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fuses sequence by ``counts``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Fuses items:</span>

<span class="sd">            &gt;&gt;&gt; divisions = baca.fractions([(7, 8), (3, 8), (5, 8)])</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(divisions).fuse()</span>
<span class="sd">            &gt;&gt;&gt; divisions = divisions.flatten(depth=-1)</span>
<span class="sd">            &gt;&gt;&gt; divisions</span>
<span class="sd">            Sequence([NonreducedFraction(15, 8)])</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions)</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music, divisions)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 15/8</span>
<span class="sd">                        s1 * 15/8</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;1...</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Fuses first two items and then remaining items:</span>

<span class="sd">            &gt;&gt;&gt; divisions = baca.fractions([(2, 8), (2, 8), (4, 8), (4, 8), (2, 4)])</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(divisions).fuse([2])</span>
<span class="sd">            &gt;&gt;&gt; for division in divisions:</span>
<span class="sd">            ...     division</span>
<span class="sd">            NonreducedFraction(4, 8)</span>
<span class="sd">            NonreducedFraction(12, 8)</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions)</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 2/1</span>
<span class="sd">                        s1 * 2</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;2</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;1.</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Fuses items two at a time:</span>

<span class="sd">            &gt;&gt;&gt; divisions = baca.fractions([(2, 8), (2, 8), (4, 8), (4, 8), (2, 4)])</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(divisions).fuse([2], cyclic=True)</span>
<span class="sd">            &gt;&gt;&gt; for division in divisions:</span>
<span class="sd">            ...     division</span>
<span class="sd">            NonreducedFraction(4, 8)</span>
<span class="sd">            NonreducedFraction(8, 8)</span>
<span class="sd">            NonreducedFraction(2, 4)</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions)</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 2/1</span>
<span class="sd">                        s1 * 2</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;2</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;1</span>
<span class="sd">                        c&#39;2</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Splits each item by ``3/8``;  then flattens; then fuses into differently</span>
<span class="sd">            sized groups:</span>

<span class="sd">            &gt;&gt;&gt; divisions = baca.fractions([(7, 8), (3, 8), (5, 8)])</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(divisions).map(</span>
<span class="sd">            ...     lambda _: baca.Sequence(_).split_divisions([(3, 8)], cyclic=True)</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; divisions = divisions.flatten(depth=-1)</span>
<span class="sd">            &gt;&gt;&gt; divisions = divisions.fuse([2, 3, 1])</span>
<span class="sd">            &gt;&gt;&gt; for division in divisions:</span>
<span class="sd">            ...     division</span>
<span class="sd">            NonreducedFraction(6, 8)</span>
<span class="sd">            NonreducedFraction(7, 8)</span>
<span class="sd">            NonreducedFraction(2, 8)</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions)</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 15/8</span>
<span class="sd">                        s1 * 15/8</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;2.</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;2..</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Splits into sixteenths; partitions; then fuses every other part:</span>

<span class="sd">            &gt;&gt;&gt; divisions = baca.fractions([(7, 8), (3, 8), (5, 8)])</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(divisions)</span>
<span class="sd">            &gt;&gt;&gt; divisions = divisions.fuse()</span>
<span class="sd">            &gt;&gt;&gt; divisions = divisions.map(</span>
<span class="sd">            ...     lambda _: baca.Sequence(_).split_divisions([(1, 16)], cyclic=True)</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; divisions = divisions.flatten(depth=-1)</span>
<span class="sd">            &gt;&gt;&gt; divisions = divisions.partition_by_ratio_of_lengths((1, 1, 1, 1, 1, 1))</span>
<span class="sd">            &gt;&gt;&gt; divisions = divisions.fuse(indices=[1, 3, 5])</span>
<span class="sd">            &gt;&gt;&gt; divisions = divisions.flatten(depth=-1)</span>
<span class="sd">            &gt;&gt;&gt; for division in divisions:</span>
<span class="sd">            ...     division</span>
<span class="sd">            NonreducedFraction(1, 16)</span>
<span class="sd">            NonreducedFraction(1, 16)</span>
<span class="sd">            NonreducedFraction(1, 16)</span>
<span class="sd">            NonreducedFraction(1, 16)</span>
<span class="sd">            NonreducedFraction(1, 16)</span>
<span class="sd">            NonreducedFraction(5, 16)</span>
<span class="sd">            NonreducedFraction(1, 16)</span>
<span class="sd">            NonreducedFraction(1, 16)</span>
<span class="sd">            NonreducedFraction(1, 16)</span>
<span class="sd">            NonreducedFraction(1, 16)</span>
<span class="sd">            NonreducedFraction(1, 16)</span>
<span class="sd">            NonreducedFraction(5, 16)</span>
<span class="sd">            NonreducedFraction(1, 16)</span>
<span class="sd">            NonreducedFraction(1, 16)</span>
<span class="sd">            NonreducedFraction(1, 16)</span>
<span class="sd">            NonreducedFraction(1, 16)</span>
<span class="sd">            NonreducedFraction(1, 16)</span>
<span class="sd">            NonreducedFraction(5, 16)</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions)</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 15/8</span>
<span class="sd">                        s1 * 15/8</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">indices</span> <span class="ow">and</span> <span class="n">counts</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;do not set indices and counts together.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span> <span class="ow">or</span> <span class="p">[]</span>
            <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_by_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cyclic</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">items_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sequence</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">indices</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                <span class="n">item_</span> <span class="o">=</span> <span class="n">item</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># item_ = _divisions(item).sum()</span>
                <span class="n">item_</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">items_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_</span><span class="p">)</span>
        <span class="c1"># sequence = _divisions(items_)</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">(</span><span class="n">items_</span><span class="p">)</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">depth</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sequence</span></div>

<div class="viewcode-block" id="Sequence.group_by_sign"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.group_by_sign">[docs]</a>    <span class="k">def</span> <span class="nf">group_by_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Groups sequence by sign of items.</span>

<span class="sd">        &gt;&gt;&gt; sequence = baca.Sequence([0, 0, -1, -1, 2, 3, -5, 1, 2, 5, -5, -6])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.group_by_sign():</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([0, 0])</span>
<span class="sd">            Sequence([-1, -1])</span>
<span class="sd">            Sequence([2, 3])</span>
<span class="sd">            Sequence([-5])</span>
<span class="sd">            Sequence([1, 2, 5])</span>
<span class="sd">            Sequence([-5, -6])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.group_by_sign([-1]):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([0])</span>
<span class="sd">            Sequence([0])</span>
<span class="sd">            Sequence([-1, -1])</span>
<span class="sd">            Sequence([2])</span>
<span class="sd">            Sequence([3])</span>
<span class="sd">            Sequence([-5])</span>
<span class="sd">            Sequence([1])</span>
<span class="sd">            Sequence([2])</span>
<span class="sd">            Sequence([5])</span>
<span class="sd">            Sequence([-5, -6])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.group_by_sign([0]):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([0, 0])</span>
<span class="sd">            Sequence([-1])</span>
<span class="sd">            Sequence([-1])</span>
<span class="sd">            Sequence([2])</span>
<span class="sd">            Sequence([3])</span>
<span class="sd">            Sequence([-5])</span>
<span class="sd">            Sequence([1])</span>
<span class="sd">            Sequence([2])</span>
<span class="sd">            Sequence([5])</span>
<span class="sd">            Sequence([-5])</span>
<span class="sd">            Sequence([-6])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.group_by_sign([1]):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([0])</span>
<span class="sd">            Sequence([0])</span>
<span class="sd">            Sequence([-1])</span>
<span class="sd">            Sequence([-1])</span>
<span class="sd">            Sequence([2, 3])</span>
<span class="sd">            Sequence([-5])</span>
<span class="sd">            Sequence([1, 2, 5])</span>
<span class="sd">            Sequence([-5])</span>
<span class="sd">            Sequence([-6])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.group_by_sign([-1, 0]):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([0, 0])</span>
<span class="sd">            Sequence([-1, -1])</span>
<span class="sd">            Sequence([2])</span>
<span class="sd">            Sequence([3])</span>
<span class="sd">            Sequence([-5])</span>
<span class="sd">            Sequence([1])</span>
<span class="sd">            Sequence([2])</span>
<span class="sd">            Sequence([5])</span>
<span class="sd">            Sequence([-5, -6])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.group_by_sign([-1, 1]):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([0])</span>
<span class="sd">            Sequence([0])</span>
<span class="sd">            Sequence([-1, -1])</span>
<span class="sd">            Sequence([2, 3])</span>
<span class="sd">            Sequence([-5])</span>
<span class="sd">            Sequence([1, 2, 5])</span>
<span class="sd">            Sequence([-5, -6])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.group_by_sign([0, 1]):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([0, 0])</span>
<span class="sd">            Sequence([-1])</span>
<span class="sd">            Sequence([-1])</span>
<span class="sd">            Sequence([2, 3])</span>
<span class="sd">            Sequence([-5])</span>
<span class="sd">            Sequence([1, 2, 5])</span>
<span class="sd">            Sequence([-5])</span>
<span class="sd">            Sequence([-6])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; for item in sequence.group_by_sign([-1, 0, 1]):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([0, 0])</span>
<span class="sd">            Sequence([-1, -1])</span>
<span class="sd">            Sequence([2, 3])</span>
<span class="sd">            Sequence([-5])</span>
<span class="sd">            Sequence([1, 2, 5])</span>
<span class="sd">            Sequence([-5, -6])</span>

<span class="sd">        Groups negative elements when ``-1`` in ``sign``.</span>

<span class="sd">        Groups zero-valued elements When ``0`` in ``sign``.</span>

<span class="sd">        Groups positive elements when ``1`` in ``sign``.</span>

<span class="sd">        Returns nested sequence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sign</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">current_sign</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_sign</span> <span class="ow">in</span> <span class="n">sign</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">group</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)([</span><span class="n">item</span><span class="p">]))</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.helianthate"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.helianthate">[docs]</a>    <span class="k">def</span> <span class="nf">helianthate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helianthates sequence.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Helianthates list of lists:</span>

<span class="sd">            &gt;&gt;&gt; sequence = baca.Sequence([[1, 2, 3], [4, 5], [6, 7, 8]])</span>
<span class="sd">            &gt;&gt;&gt; sequence = sequence.helianthate(n=-1, m=1)</span>
<span class="sd">            &gt;&gt;&gt; for item in sequence:</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            [1, 2, 3]</span>
<span class="sd">            [4, 5]</span>
<span class="sd">            [6, 7, 8]</span>
<span class="sd">            [5, 4]</span>
<span class="sd">            [8, 6, 7]</span>
<span class="sd">            [3, 1, 2]</span>
<span class="sd">            [7, 8, 6]</span>
<span class="sd">            [2, 3, 1]</span>
<span class="sd">            [4, 5]</span>
<span class="sd">            [1, 2, 3]</span>
<span class="sd">            [5, 4]</span>
<span class="sd">            [6, 7, 8]</span>
<span class="sd">            [4, 5]</span>
<span class="sd">            [8, 6, 7]</span>
<span class="sd">            [3, 1, 2]</span>
<span class="sd">            [7, 8, 6]</span>
<span class="sd">            [2, 3, 1]</span>
<span class="sd">            [5, 4]</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Helianthates list of collections:</span>

<span class="sd">            &gt;&gt;&gt; J = baca.PitchClassSegment(items=[0, 2, 4])</span>
<span class="sd">            &gt;&gt;&gt; K = baca.PitchClassSegment(items=[5, 6])</span>
<span class="sd">            &gt;&gt;&gt; L = baca.PitchClassSegment(items=[7, 9, 11])</span>
<span class="sd">            &gt;&gt;&gt; sequence = baca.Sequence([J, K, L])</span>
<span class="sd">            &gt;&gt;&gt; sequence = sequence.helianthate(n=-1, m=1)</span>
<span class="sd">            &gt;&gt;&gt; for collection in sequence:</span>
<span class="sd">            ...     collection</span>
<span class="sd">            ...</span>
<span class="sd">            PitchClassSegment([0, 2, 4])</span>
<span class="sd">            PitchClassSegment([5, 6])</span>
<span class="sd">            PitchClassSegment([7, 9, 11])</span>
<span class="sd">            PitchClassSegment([6, 5])</span>
<span class="sd">            PitchClassSegment([11, 7, 9])</span>
<span class="sd">            PitchClassSegment([4, 0, 2])</span>
<span class="sd">            PitchClassSegment([9, 11, 7])</span>
<span class="sd">            PitchClassSegment([2, 4, 0])</span>
<span class="sd">            PitchClassSegment([5, 6])</span>
<span class="sd">            PitchClassSegment([0, 2, 4])</span>
<span class="sd">            PitchClassSegment([6, 5])</span>
<span class="sd">            PitchClassSegment([7, 9, 11])</span>
<span class="sd">            PitchClassSegment([5, 6])</span>
<span class="sd">            PitchClassSegment([11, 7, 9])</span>
<span class="sd">            PitchClassSegment([4, 0, 2])</span>
<span class="sd">            PitchClassSegment([9, 11, 7])</span>
<span class="sd">            PitchClassSegment([2, 4, 0])</span>
<span class="sd">            PitchClassSegment([6, 5])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Trivial helianthation:</span>

<span class="sd">            &gt;&gt;&gt; items = [[1, 2, 3], [4, 5], [6, 7, 8]]</span>
<span class="sd">            &gt;&gt;&gt; sequence = baca.Sequence(items)</span>
<span class="sd">            &gt;&gt;&gt; sequence.helianthate()</span>
<span class="sd">            Sequence([[1, 2, 3], [4, 5], [6, 7, 8]])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">[:])</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">[:])</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">original_n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">original_m</span> <span class="o">=</span> <span class="n">m</span>

        <span class="k">def</span> <span class="nf">_generalized_rotate</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="s2">&quot;rotate&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">argument</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
            <span class="n">argument_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>
            <span class="n">argument</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">argument</span><span class="p">)</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
            <span class="n">argument</span> <span class="o">=</span> <span class="n">argument_type</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">argument</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">inner</span> <span class="o">=</span> <span class="p">[</span><span class="n">_generalized_rotate</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
            <span class="n">candidate</span> <span class="o">=</span> <span class="n">_generalized_rotate</span><span class="p">(</span><span class="n">inner</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">candidate</span> <span class="o">==</span> <span class="n">start</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="n">original_n</span>
            <span class="n">m</span> <span class="o">+=</span> <span class="n">original_m</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;1000 iterations without identity.&quot;</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.partition"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.partition">[docs]</a>    <span class="k">def</span> <span class="nf">partition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Partitions sequence cyclically by ``counts`` with overhang.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; sequence = baca.Sequence(range(16))</span>
<span class="sd">            &gt;&gt;&gt; parts = sequence.partition([3])</span>

<span class="sd">            &gt;&gt;&gt; for part in parts:</span>
<span class="sd">            ...     part</span>
<span class="sd">            Sequence([0, 1, 2])</span>
<span class="sd">            Sequence([3, 4, 5])</span>
<span class="sd">            Sequence([6, 7, 8])</span>
<span class="sd">            Sequence([9, 10, 11])</span>
<span class="sd">            Sequence([12, 13, 14])</span>
<span class="sd">            Sequence([15])</span>

<span class="sd">        Returns new sequence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_by_counts</span><span class="p">(</span><span class="n">counts</span><span class="o">=</span><span class="n">counts</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.period_of_rotation"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.period_of_rotation">[docs]</a>    <span class="k">def</span> <span class="nf">period_of_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets period of rotation.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; baca.Sequence([1, 2, 3, 4, 5, 6]).period_of_rotation()</span>
<span class="sd">            6</span>

<span class="sd">            &gt;&gt;&gt; baca.Sequence([1, 2, 3, 1, 2, 3]).period_of_rotation()</span>
<span class="sd">            3</span>

<span class="sd">            &gt;&gt;&gt; baca.Sequence([1, 2, 1, 2, 1, 2]).period_of_rotation()</span>
<span class="sd">            2</span>

<span class="sd">            &gt;&gt;&gt; baca.Sequence([1, 1, 1, 1, 1, 1]).period_of_rotation()</span>
<span class="sd">            1</span>

<span class="sd">            &gt;&gt;&gt; baca.Sequence().period_of_rotation()</span>
<span class="sd">            0</span>

<span class="sd">        Defined equal to length of sequence divided by degree of rotational symmetry of</span>
<span class="sd">        sequence.</span>

<span class="sd">        Returns positive integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree_of_rotational_symmetry</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sequence.quarters"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.quarters">[docs]</a>    <span class="k">def</span> <span class="nf">quarters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">compound</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">DurationTyping</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">remainder</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">VerticalAlignment</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Splits sequence into quarter-note durations.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; list_ = baca.fractions([(2, 4), (6, 4)])</span>
<span class="sd">            &gt;&gt;&gt; for item in baca.Sequence(list_).quarters():</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([NonreducedFraction(1, 4)])</span>
<span class="sd">            Sequence([NonreducedFraction(1, 4)])</span>
<span class="sd">            Sequence([NonreducedFraction(1, 4)])</span>
<span class="sd">            Sequence([NonreducedFraction(1, 4)])</span>
<span class="sd">            Sequence([NonreducedFraction(1, 4)])</span>
<span class="sd">            Sequence([NonreducedFraction(1, 4)])</span>
<span class="sd">            Sequence([NonreducedFraction(1, 4)])</span>
<span class="sd">            Sequence([NonreducedFraction(1, 4)])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; list_ = baca.fractions([(6, 4)])</span>
<span class="sd">            &gt;&gt;&gt; for item in baca.Sequence(list_).quarters(compound=(3, 2)):</span>
<span class="sd">            ...     item</span>
<span class="sd">            ...</span>
<span class="sd">            Sequence([NonreducedFraction(3, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(3, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(3, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(3, 8)])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Maps to each division: splits by ``1/4`` with remainder on right:</span>

<span class="sd">            &gt;&gt;&gt; divisions = baca.fractions([(7, 8), (3, 8), (5, 8)])</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(divisions).map(</span>
<span class="sd">            ...     lambda _: baca.Sequence(_).quarters()</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; for sequence in divisions:</span>
<span class="sd">            ...     print(&quot;sequence:&quot;)</span>
<span class="sd">            ...     for division in sequence:</span>
<span class="sd">            ...         print(f&quot;\t{repr(division)}&quot;)</span>
<span class="sd">            sequence:</span>
<span class="sd">                Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">                Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">                Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">                Sequence([NonreducedFraction(1, 8)])</span>
<span class="sd">            sequence:</span>
<span class="sd">                Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">                Sequence([NonreducedFraction(1, 8)])</span>
<span class="sd">            sequence:</span>
<span class="sd">                Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">                Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">                Sequence([NonreducedFraction(1, 8)])</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions.flatten(depth=-1))</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 15/8</span>
<span class="sd">                        s1 * 15/8</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_divisions</span><span class="p">(</span>
            <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)],</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compound</span><span class="o">=</span><span class="n">compound</span><span class="p">,</span> <span class="n">remainder</span><span class="o">=</span><span class="n">remainder</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">sequence</span></div>

<div class="viewcode-block" id="Sequence.ratios"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.ratios">[docs]</a>    <span class="k">def</span> <span class="nf">ratios</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ratios</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">RatioTyping</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">rounded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Splits sequence by ``ratios``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Splits sequence by exact ``2:1`` ratio:</span>

<span class="sd">            &gt;&gt;&gt; time_signatures = baca.fractions([(5, 8), (6, 8)])</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(time_signatures)</span>
<span class="sd">            &gt;&gt;&gt; divisions = divisions.ratios([(2, 1)])</span>
<span class="sd">            &gt;&gt;&gt; for item in divisions:</span>
<span class="sd">            ...     print(&quot;sequence:&quot;)</span>
<span class="sd">            ...     for division in item:</span>
<span class="sd">            ...         print(f&quot;\t{repr(division)}&quot;)</span>
<span class="sd">            sequence:</span>
<span class="sd">                NonreducedFraction(5, 8)</span>
<span class="sd">                NonreducedFraction(7, 24)</span>
<span class="sd">            sequence:</span>
<span class="sd">                NonreducedFraction(11, 24)</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions.flatten(depth=-1))</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music, time_signatures)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 5/8</span>
<span class="sd">                        s1 * 5/8</span>
<span class="sd">                        \time 6/8</span>
<span class="sd">                        s1 * 3/4</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;2</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        \tweak edge-height #&#39;(0.7 . 0)</span>
<span class="sd">                        \times 16/24 {</span>
<span class="sd">                            c&#39;4..</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak edge-height #&#39;(0.7 . 0)</span>
<span class="sd">                        \times 16/24 {</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">            Splits divisions by rounded ``2:1`` ratio:</span>

<span class="sd">            &gt;&gt;&gt; time_signatures = baca.fractions([(5, 8), (6, 8)])</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(time_signatures)</span>
<span class="sd">            &gt;&gt;&gt; divisions = divisions.ratios([(2, 1)], rounded=True)</span>
<span class="sd">            &gt;&gt;&gt; for item in divisions:</span>
<span class="sd">            ...     print(&quot;sequence:&quot;)</span>
<span class="sd">            ...     for division in item:</span>
<span class="sd">            ...         print(f&quot;\t{repr(division)}&quot;)</span>
<span class="sd">            sequence:</span>
<span class="sd">                NonreducedFraction(5, 8)</span>
<span class="sd">                NonreducedFraction(2, 8)</span>
<span class="sd">            sequence:</span>
<span class="sd">                NonreducedFraction(4, 8)</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions.flatten(depth=-1))</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music, time_signatures)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 5/8</span>
<span class="sd">                        s1 * 5/8</span>
<span class="sd">                        \time 6/8</span>
<span class="sd">                        s1 * 3/4</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;2</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;2</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Splits each division by exact ``2:1`` ratio:</span>

<span class="sd">            &gt;&gt;&gt; time_signatures = baca.fractions([(5, 8), (6, 8)])</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(time_signatures).map(</span>
<span class="sd">            ...     lambda _: baca.Sequence(_).ratios([(2, 1)])</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; for item in divisions:</span>
<span class="sd">            ...     print(&quot;sequence:&quot;)</span>
<span class="sd">            ...     for division in item:</span>
<span class="sd">            ...         print(f&quot;\t{repr(division)}&quot;)</span>
<span class="sd">            sequence:</span>
<span class="sd">                Sequence([NonreducedFraction(10, 24)])</span>
<span class="sd">                Sequence([NonreducedFraction(5, 24)])</span>
<span class="sd">            sequence:</span>
<span class="sd">                Sequence([NonreducedFraction(4, 8)])</span>
<span class="sd">                Sequence([NonreducedFraction(2, 8)])</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions.flatten(depth=-1))</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music, time_signatures)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 5/8</span>
<span class="sd">                        s1 * 5/8</span>
<span class="sd">                        \time 6/8</span>
<span class="sd">                        s1 * 3/4</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        \tweak edge-height #&#39;(0.7 . 0)</span>
<span class="sd">                        \times 16/24 {</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                            - \tweak staff-padding 11</span>
<span class="sd">                            - \tweak transparent ##t</span>
<span class="sd">                            ^ \markup I</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak edge-height #&#39;(0.7 . 0)</span>
<span class="sd">                        \times 16/24 {</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                        }</span>
<span class="sd">                        c&#39;2</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">            Splits each division by rounded ``2:1`` ratio:</span>

<span class="sd">            &gt;&gt;&gt; time_signatures = baca.fractions([(5, 8), (6, 8)])</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(time_signatures).map(</span>
<span class="sd">            ...     lambda _: baca.Sequence(_).ratios([(2, 1)], rounded=True)</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; for item in divisions:</span>
<span class="sd">            ...     print(&quot;sequence:&quot;)</span>
<span class="sd">            ...     for division in item:</span>
<span class="sd">            ...         print(f&quot;\t{repr(division)}&quot;)</span>
<span class="sd">            sequence:</span>
<span class="sd">                Sequence([NonreducedFraction(3, 8)])</span>
<span class="sd">                Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            sequence:</span>
<span class="sd">                Sequence([NonreducedFraction(4, 8)])</span>
<span class="sd">                Sequence([NonreducedFraction(2, 8)])</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions.flatten(depth=-1))</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music, time_signatures)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 5/8</span>
<span class="sd">                        s1 * 5/8</span>
<span class="sd">                        \time 6/8</span>
<span class="sd">                        s1 * 3/4</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;4.</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;2</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Splits divisions with alternating exact ``2:1`` and ``1:1:1`` ratios:</span>

<span class="sd">            &gt;&gt;&gt; ratios = abjad.CyclicTuple([(2, 1), (1, 1, 1)])</span>
<span class="sd">            &gt;&gt;&gt; time_signatures = baca.fractions([(5, 8), (6, 8)])</span>
<span class="sd">            &gt;&gt;&gt; divisions = []</span>
<span class="sd">            &gt;&gt;&gt; for i, time_signature in enumerate(time_signatures):</span>
<span class="sd">            ...     ratio = ratios[i]</span>
<span class="sd">            ...     sequence = baca.Sequence(time_signature)</span>
<span class="sd">            ...     sequence = sequence.ratios([ratio])</span>
<span class="sd">            ...     divisions.append(sequence)</span>
<span class="sd">            ...</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(divisions)</span>
<span class="sd">            &gt;&gt;&gt; for item in divisions:</span>
<span class="sd">            ...     print(&quot;sequence:&quot;)</span>
<span class="sd">            ...     for division in item:</span>
<span class="sd">            ...         print(f&quot;\t{repr(division)}&quot;)</span>
<span class="sd">            sequence:</span>
<span class="sd">                Sequence([NonreducedFraction(10, 24)])</span>
<span class="sd">                Sequence([NonreducedFraction(5, 24)])</span>
<span class="sd">            sequence:</span>
<span class="sd">                Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">                Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">                Sequence([NonreducedFraction(2, 8)])</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions.flatten(depth=-1))</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music, time_signatures)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 5/8</span>
<span class="sd">                        s1 * 5/8</span>
<span class="sd">                        \time 6/8</span>
<span class="sd">                        s1 * 3/4</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        \tweak edge-height #&#39;(0.7 . 0)</span>
<span class="sd">                        \times 16/24 {</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                            - \tweak staff-padding 11</span>
<span class="sd">                            - \tweak transparent ##t</span>
<span class="sd">                            ^ \markup I</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak edge-height #&#39;(0.7 . 0)</span>
<span class="sd">                        \times 16/24 {</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                        }</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">            Splits divisions with alternating rounded ``2:1`` and ``1:1:1`` ratios:</span>

<span class="sd">            &gt;&gt;&gt; ratios = abjad.CyclicTuple([(2, 1), (1, 1, 1)])</span>
<span class="sd">            &gt;&gt;&gt; time_signatures = baca.fractions([(5, 8), (6, 8)])</span>
<span class="sd">            &gt;&gt;&gt; divisions = []</span>
<span class="sd">            &gt;&gt;&gt; for i, time_signature in enumerate(time_signatures):</span>
<span class="sd">            ...     ratio = ratios[i]</span>
<span class="sd">            ...     sequence = baca.Sequence(time_signature)</span>
<span class="sd">            ...     sequence = sequence.ratios([ratio], rounded=True)</span>
<span class="sd">            ...     divisions.append(sequence)</span>
<span class="sd">            ...</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(divisions)</span>
<span class="sd">            &gt;&gt;&gt; for item in divisions:</span>
<span class="sd">            ...     print(&quot;sequence:&quot;)</span>
<span class="sd">            ...     for division in item:</span>
<span class="sd">            ...         print(f&quot;\t{repr(division)}&quot;)</span>
<span class="sd">            sequence:</span>
<span class="sd">                Sequence([NonreducedFraction(3, 8)])</span>
<span class="sd">                Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            sequence:</span>
<span class="sd">                Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">                Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">                Sequence([NonreducedFraction(2, 8)])</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions.flatten(depth=-1))</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music, time_signatures)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 5/8</span>
<span class="sd">                        s1 * 5/8</span>
<span class="sd">                        \time 6/8</span>
<span class="sd">                        s1 * 3/4</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;4.</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ratios_</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">CyclicTuple</span><span class="p">([</span><span class="n">abjad</span><span class="o">.</span><span class="n">Ratio</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">ratios</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">rounded</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rounded</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">rounded</span><span class="p">)</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">NonreducedFraction</span><span class="p">)</span>
        <span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span> <span class="o">=</span> <span class="n">weight</span><span class="o">.</span><span class="n">pair</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">ratios_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">rounded</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">numerators</span> <span class="o">=</span> <span class="n">ratio</span><span class="o">.</span><span class="n">partition_integer</span><span class="p">(</span><span class="n">numerator</span><span class="p">)</span>
            <span class="n">divisions</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">abjad</span><span class="o">.</span><span class="n">NonreducedFraction</span><span class="p">((</span><span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">numerator</span> <span class="ow">in</span> <span class="n">numerators</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">divisions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ratio_weight</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">ratio</span><span class="p">:</span>
                <span class="n">multiplier</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Fraction</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">ratio_weight</span><span class="p">)</span>
                <span class="n">division</span> <span class="o">=</span> <span class="n">multiplier</span> <span class="o">*</span> <span class="n">weight</span>
                <span class="n">divisions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">division</span><span class="p">)</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">divisions</span><span class="p">)</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sequence</span></div>

<div class="viewcode-block" id="Sequence.repeat_by"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.repeat_by">[docs]</a>    <span class="k">def</span> <span class="nf">repeat_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Repeat sequence elements at ``counts``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            With no counts:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; baca.Sequence([[1, 2, 3], 4, [5, 6]]).repeat_by()</span>
<span class="sd">                Sequence([[1, 2, 3], 4, [5, 6]])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            With acyclic counts:</span>

<span class="sd">            &gt;&gt;&gt; sequence = baca.Sequence([[1, 2, 3], 4, [5, 6]])</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([0])</span>
<span class="sd">                Sequence([4, [5, 6]])</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([1])</span>
<span class="sd">                Sequence([[1, 2, 3], 4, [5, 6]])</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([2])</span>
<span class="sd">                Sequence([[1, 2, 3], [1, 2, 3], 4, [5, 6]])</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([3])</span>
<span class="sd">                Sequence([[1, 2, 3], [1, 2, 3], [1, 2, 3], 4, [5, 6]])</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([1, 0])</span>
<span class="sd">                Sequence([[1, 2, 3], [5, 6]])</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([1, 1])</span>
<span class="sd">                Sequence([[1, 2, 3], 4, [5, 6]])</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([1, 2])</span>
<span class="sd">                Sequence([[1, 2, 3], 4, 4, [5, 6]])</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([1, 3])</span>
<span class="sd">                Sequence([[1, 2, 3], 4, 4, 4, [5, 6]])</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([1, 1, 0])</span>
<span class="sd">                Sequence([[1, 2, 3], 4])</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([1, 1, 1])</span>
<span class="sd">                Sequence([[1, 2, 3], 4, [5, 6]])</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([1, 1, 2])</span>
<span class="sd">                Sequence([[1, 2, 3], 4, [5, 6], [5, 6]])</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([1, 1, 3])</span>
<span class="sd">                Sequence([[1, 2, 3], 4, [5, 6], [5, 6], [5, 6]])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            With cyclic counts:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([0], cyclic=True)</span>
<span class="sd">                Sequence([])</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([1], cyclic=True)</span>
<span class="sd">                Sequence([[1, 2, 3], 4, [5, 6]])</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([2], cyclic=True)</span>
<span class="sd">                Sequence([[1, 2, 3], [1, 2, 3], 4, 4, [5, 6], [5, 6]])</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([3], cyclic=True)</span>
<span class="sd">                Sequence([[1, 2, 3], [1, 2, 3], [1, 2, 3], 4, 4, 4, [5, 6], [5, 6], [5, 6]])</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([2, 0], cyclic=True)</span>
<span class="sd">                Sequence([[1, 2, 3], [1, 2, 3], [5, 6], [5, 6]])</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([2, 1], cyclic=True)</span>
<span class="sd">                Sequence([[1, 2, 3], [1, 2, 3], 4, [5, 6], [5, 6]])</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([2, 2], cyclic=True)</span>
<span class="sd">                Sequence([[1, 2, 3], [1, 2, 3], 4, 4, [5, 6], [5, 6]])</span>

<span class="sd">                &gt;&gt;&gt; sequence.repeat_by([2, 3], cyclic=True)</span>
<span class="sd">                Sequence([[1, 2, 3], [1, 2, 3], 4, 4, 4, [5, 6], [5, 6]])</span>

<span class="sd">        Raises exception on negative counts.</span>

<span class="sd">        Returns new sequence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">counts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span> <span class="ow">or</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cyclic</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">CyclicTuple</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">items</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">count</span> <span class="o">*</span> <span class="p">[</span><span class="n">item</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.reveal"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.reveal">[docs]</a>    <span class="k">def</span> <span class="nf">reveal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reveals contents of sequence.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            With no count:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; baca.Sequence([[1, 2, 3], 4, [5, 6]]).reveal()</span>
<span class="sd">                Sequence([[1, 2, 3], 4, [5, 6]])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            With zero count:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; baca.Sequence([[1, 2, 3], 4, [5, 6]]).reveal(count=0)</span>
<span class="sd">                Sequence([])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            With positive count:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; baca.Sequence([[1, 2, 3], 4, [5, 6]]).reveal(count=1)</span>
<span class="sd">                Sequence([[1]])</span>

<span class="sd">                &gt;&gt;&gt; baca.Sequence([[1, 2, 3], 4, [5, 6]]).reveal(count=2)</span>
<span class="sd">                Sequence([[1, 2]])</span>

<span class="sd">                &gt;&gt;&gt; baca.Sequence([[1, 2, 3], 4, [5, 6]]).reveal(count=3)</span>
<span class="sd">                Sequence([[1, 2, 3]])</span>

<span class="sd">                &gt;&gt;&gt; baca.Sequence([[1, 2, 3], 4, [5, 6]]).reveal(count=4)</span>
<span class="sd">                Sequence([[1, 2, 3], 4])</span>

<span class="sd">                &gt;&gt;&gt; baca.Sequence([[1, 2, 3], 4, [5, 6]]).reveal(count=5)</span>
<span class="sd">                Sequence([[1, 2, 3], 4, [5]])</span>

<span class="sd">                &gt;&gt;&gt; baca.Sequence([[1, 2, 3], 4, [5, 6]]).reveal(count=6)</span>
<span class="sd">                Sequence([[1, 2, 3], 4, [5, 6]])</span>

<span class="sd">                &gt;&gt;&gt; baca.Sequence([[1, 2, 3], 4, [5, 6]]).reveal(count=99)</span>
<span class="sd">                Sequence([[1, 2, 3], 4, [5, 6]])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            With negative count:</span>

<span class="sd">            ..  container:: example</span>

<span class="sd">                &gt;&gt;&gt; baca.Sequence([[1, 2, 3], 4, [5, 6]]).reveal(count=-1)</span>
<span class="sd">                Sequence([[6]])</span>

<span class="sd">                &gt;&gt;&gt; baca.Sequence([[1, 2, 3], 4, [5, 6]]).reveal(count=-2)</span>
<span class="sd">                Sequence([[5, 6]])</span>

<span class="sd">                &gt;&gt;&gt; baca.Sequence([[1, 2, 3], 4, [5, 6]]).reveal(count=-3)</span>
<span class="sd">                Sequence([4, [5, 6]])</span>

<span class="sd">                &gt;&gt;&gt; baca.Sequence([[1, 2, 3], 4, [5, 6]]).reveal(count=-4)</span>
<span class="sd">                Sequence([[3], 4, [5, 6]])</span>

<span class="sd">                &gt;&gt;&gt; baca.Sequence([[1, 2, 3], 4, [5, 6]]).reveal(count=-5)</span>
<span class="sd">                Sequence([[2, 3], 4, [5, 6]])</span>

<span class="sd">                &gt;&gt;&gt; baca.Sequence([[1, 2, 3], 4, [5, 6]]).reveal(count=-6)</span>
<span class="sd">                Sequence([[1, 2, 3], 4, [5, 6]])</span>

<span class="sd">                &gt;&gt;&gt; baca.Sequence([[1, 2, 3], 4, [5, 6]]).reveal(count=-99)</span>
<span class="sd">                Sequence([[1, 2, 3], 4, [5, 6]])</span>

<span class="sd">        Returns new sequence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)()</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">(</span><span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">reveal</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">reverse</span><span class="p">(</span><span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">items_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
                <span class="n">subitems_</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">subitem</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                    <span class="n">subitems_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subitem</span><span class="p">)</span>
                    <span class="n">current</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">current</span> <span class="o">==</span> <span class="n">count</span><span class="p">:</span>
                        <span class="n">item_</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)(</span><span class="n">subitems_</span><span class="p">)</span>
                        <span class="n">items_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_</span><span class="p">)</span>
                        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">items_</span><span class="p">)</span>
                <span class="n">item_</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)(</span><span class="n">subitems_</span><span class="p">)</span>
                <span class="n">items_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">items_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">current</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">current</span> <span class="o">==</span> <span class="n">count</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">items_</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">items_</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.split_divisions"><a class="viewcode-back" href="../../api/evans/sequence.html#evans.sequence.Sequence.split_divisions">[docs]</a>    <span class="k">def</span> <span class="nf">split_divisions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">durations</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">DurationTyping</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">compound</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">DurationTyping</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cyclic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">remainder</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">HorizontalAlignment</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">remainder_fuse_threshold</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">DurationTyping</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Splits sequence divisions by ``durations``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Splits every five sixteenths:</span>

<span class="sd">            &gt;&gt;&gt; divisions = baca.fractions(10 * [(1, 8)])</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(divisions)</span>
<span class="sd">            &gt;&gt;&gt; divisions = divisions.split_divisions([(5, 16)], cyclic=True)</span>
<span class="sd">            &gt;&gt;&gt; for i, sequence_ in enumerate(divisions):</span>
<span class="sd">            ...     print(f&quot;sequence {i}&quot;)</span>
<span class="sd">            ...     for division in sequence_:</span>
<span class="sd">            ...         print(&quot;\t&quot; + repr(division))</span>
<span class="sd">            sequence 0</span>
<span class="sd">                NonreducedFraction(1, 8)</span>
<span class="sd">                NonreducedFraction(1, 8)</span>
<span class="sd">                NonreducedFraction(1, 16)</span>
<span class="sd">            sequence 1</span>
<span class="sd">                NonreducedFraction(1, 16)</span>
<span class="sd">                NonreducedFraction(1, 8)</span>
<span class="sd">                NonreducedFraction(1, 8)</span>
<span class="sd">            sequence 2</span>
<span class="sd">                NonreducedFraction(1, 8)</span>
<span class="sd">                NonreducedFraction(1, 8)</span>
<span class="sd">                NonreducedFraction(1, 16)</span>
<span class="sd">            sequence 3</span>
<span class="sd">                NonreducedFraction(1, 16)</span>
<span class="sd">                NonreducedFraction(1, 8)</span>
<span class="sd">                NonreducedFraction(1, 8)</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Fuses divisions and then splits by ``1/4`` with remainder on right:</span>

<span class="sd">            &gt;&gt;&gt; divisions = [(7, 8), (3, 8), (5, 8)]</span>
<span class="sd">            &gt;&gt;&gt; divisions = [abjad.NonreducedFraction(_) for _ in divisions]</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(divisions).fuse()</span>
<span class="sd">            &gt;&gt;&gt; divisions = divisions.split_divisions([(1, 4)], cyclic=True)</span>
<span class="sd">            &gt;&gt;&gt; for item in divisions:</span>
<span class="sd">            ...     item</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(1, 8)])</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions.flatten(depth=-1))</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 15/8</span>
<span class="sd">                        s1 * 15/8</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">            Fuses remainder:</span>

<span class="sd">            &gt;&gt;&gt; divisions = [(7, 8), (3, 8), (5, 8)]</span>
<span class="sd">            &gt;&gt;&gt; divisions = [abjad.NonreducedFraction(_) for _ in divisions]</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(divisions).fuse()</span>
<span class="sd">            &gt;&gt;&gt; divisions = divisions.split_divisions(</span>
<span class="sd">            ...     [(1, 4)],</span>
<span class="sd">            ...     cyclic=True,</span>
<span class="sd">            ...     remainder_fuse_threshold=(1, 8),</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; for item in divisions:</span>
<span class="sd">            ...     item</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(3, 8)])</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions.flatten(depth=-1))</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 15/8</span>
<span class="sd">                        s1 * 15/8</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4.</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Fuses divisions and then splits by ``1/4`` with remainder on left:</span>

<span class="sd">            &gt;&gt;&gt; divisions = [(7, 8), (3, 8), (5, 8)]</span>
<span class="sd">            &gt;&gt;&gt; divisions = [abjad.NonreducedFraction(_) for _ in divisions]</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(divisions).fuse()</span>
<span class="sd">            &gt;&gt;&gt; divisions = divisions.split_divisions(</span>
<span class="sd">            ...     [(1, 4)],</span>
<span class="sd">            ...     cyclic=True,</span>
<span class="sd">            ...     remainder=abjad.Left,</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; for item in divisions:</span>
<span class="sd">            ...     item</span>
<span class="sd">            Sequence([NonreducedFraction(1, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions.flatten(depth=-1))</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 15/8</span>
<span class="sd">                        s1 * 15/8</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">            Fuses remainder:</span>

<span class="sd">            &gt;&gt;&gt; divisions = [(7, 8), (3, 8), (5, 8)]</span>
<span class="sd">            &gt;&gt;&gt; divisions = [abjad.NonreducedFraction(_) for _ in divisions]</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(divisions).fuse()</span>
<span class="sd">            &gt;&gt;&gt; divisions = divisions.split_divisions(</span>
<span class="sd">            ...     [(1, 4)],</span>
<span class="sd">            ...     cyclic=True,</span>
<span class="sd">            ...     remainder=abjad.Left,</span>
<span class="sd">            ...     remainder_fuse_threshold=(1, 8),</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; for item in divisions:</span>
<span class="sd">            ...     item</span>
<span class="sd">            Sequence([NonreducedFraction(3, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>
<span class="sd">            Sequence([NonreducedFraction(2, 8)])</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions.flatten(depth=-1))</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 15/8</span>
<span class="sd">                        s1 * 15/8</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;4.</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Splits each division into quarters and positions remainder at right:</span>

<span class="sd">            &gt;&gt;&gt; def quarters(sequence):</span>
<span class="sd">            ...     sequence = baca.Sequence(sequence)</span>
<span class="sd">            ...     sequence = sequence.quarters()</span>
<span class="sd">            ...     sequence = sequence.flatten(depth=-1)</span>
<span class="sd">            ...     return sequence</span>

<span class="sd">            &gt;&gt;&gt; time_signatures = baca.fractions([(7, 8), (7, 8), (7, 16)])</span>
<span class="sd">            &gt;&gt;&gt; time_signatures = [abjad.NonreducedFraction(_) for _ in time_signatures]</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(time_signatures).map(quarters)</span>
<span class="sd">            &gt;&gt;&gt; for item in divisions:</span>
<span class="sd">            ...     print(&quot;sequence:&quot;)</span>
<span class="sd">            ...     for division in item:</span>
<span class="sd">            ...         print(f&quot;\t{repr(division)}&quot;)</span>
<span class="sd">            sequence:</span>
<span class="sd">                NonreducedFraction(2, 8)</span>
<span class="sd">                NonreducedFraction(2, 8)</span>
<span class="sd">                NonreducedFraction(2, 8)</span>
<span class="sd">                NonreducedFraction(1, 8)</span>
<span class="sd">            sequence:</span>
<span class="sd">                NonreducedFraction(2, 8)</span>
<span class="sd">                NonreducedFraction(2, 8)</span>
<span class="sd">                NonreducedFraction(2, 8)</span>
<span class="sd">                NonreducedFraction(1, 8)</span>
<span class="sd">            sequence:</span>
<span class="sd">                NonreducedFraction(4, 16)</span>
<span class="sd">                NonreducedFraction(3, 16)</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions.flatten(depth=-1))</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music, time_signatures)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 7/8</span>
<span class="sd">                        s1 * 7/8</span>
<span class="sd">                        \time 7/8</span>
<span class="sd">                        s1 * 7/8</span>
<span class="sd">                        \time 7/16</span>
<span class="sd">                        s1 * 7/16</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Splits each division into quarters and positions remainder at left:</span>

<span class="sd">            &gt;&gt;&gt; def quarters(sequence):</span>
<span class="sd">            ...     sequence = baca.Sequence(sequence)</span>
<span class="sd">            ...     sequence = sequence.quarters(remainder=abjad.Left)</span>
<span class="sd">            ...     sequence = sequence.flatten(depth=-1)</span>
<span class="sd">            ...     return sequence</span>

<span class="sd">            &gt;&gt;&gt; time_signatures = [(7, 8), (7, 8), (7, 16)]</span>
<span class="sd">            &gt;&gt;&gt; time_signatures = [abjad.NonreducedFraction(_) for _ in time_signatures]</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(time_signatures).map(quarters)</span>
<span class="sd">            &gt;&gt;&gt; for item in divisions:</span>
<span class="sd">            ...     print(&quot;sequence:&quot;)</span>
<span class="sd">            ...     for division in item:</span>
<span class="sd">            ...         print(f&quot;\t{repr(division)}&quot;)</span>
<span class="sd">            sequence:</span>
<span class="sd">                NonreducedFraction(1, 8)</span>
<span class="sd">                NonreducedFraction(2, 8)</span>
<span class="sd">                NonreducedFraction(2, 8)</span>
<span class="sd">                NonreducedFraction(2, 8)</span>
<span class="sd">            sequence:</span>
<span class="sd">                NonreducedFraction(1, 8)</span>
<span class="sd">                NonreducedFraction(2, 8)</span>
<span class="sd">                NonreducedFraction(2, 8)</span>
<span class="sd">                NonreducedFraction(2, 8)</span>
<span class="sd">            sequence:</span>
<span class="sd">                NonreducedFraction(3, 16)</span>
<span class="sd">                NonreducedFraction(4, 16)</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions.flatten(depth=-1))</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music, time_signatures)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 7/8</span>
<span class="sd">                        s1 * 7/8</span>
<span class="sd">                        \time 7/8</span>
<span class="sd">                        s1 * 7/8</span>
<span class="sd">                        \time 7/16</span>
<span class="sd">                        s1 * 7/16</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        - \tweak staff-padding 18</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Splits each division into quarters and fuses remainder less than or equal to</span>
<span class="sd">            ``1/8`` to the right:</span>

<span class="sd">            &gt;&gt;&gt; def quarters(sequence):</span>
<span class="sd">            ...     sequence = baca.Sequence(sequence)</span>
<span class="sd">            ...     sequence = sequence.split_divisions(</span>
<span class="sd">            ...         [(1, 4)],</span>
<span class="sd">            ...         cyclic=True,</span>
<span class="sd">            ...         remainder_fuse_threshold=(1, 8),</span>
<span class="sd">            ...     )</span>
<span class="sd">            ...     sequence = sequence.flatten(depth=-1)</span>
<span class="sd">            ...     return sequence</span>

<span class="sd">            &gt;&gt;&gt; time_signatures = [abjad.NonreducedFraction(5, 8)]</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(time_signatures).map(quarters)</span>
<span class="sd">            &gt;&gt;&gt; for item in divisions:</span>
<span class="sd">            ...     print(&quot;sequence:&quot;)</span>
<span class="sd">            ...     for division in item:</span>
<span class="sd">            ...         print(f&quot;\t{repr(division)}&quot;)</span>
<span class="sd">            sequence:</span>
<span class="sd">                NonreducedFraction(2, 8)</span>
<span class="sd">                NonreducedFraction(3, 8)</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions.flatten(depth=-1))</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music, time_signatures)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 5/8</span>
<span class="sd">                        s1 * 5/8</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;4.</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Splits each division into quarters and fuses remainder less than or equal to</span>
<span class="sd">            ``1/8`` to the left:</span>

<span class="sd">            &gt;&gt;&gt; def quarters(sequence):</span>
<span class="sd">            ...     sequence = baca.Sequence(sequence)</span>
<span class="sd">            ...     sequence = sequence.split_divisions(</span>
<span class="sd">            ...         [(1, 4)],</span>
<span class="sd">            ...         cyclic=True,</span>
<span class="sd">            ...         remainder=abjad.Left,</span>
<span class="sd">            ...         remainder_fuse_threshold=(1, 8),</span>
<span class="sd">            ...     )</span>
<span class="sd">            ...     sequence = sequence.flatten(depth=-1)</span>
<span class="sd">            ...     return sequence</span>

<span class="sd">            &gt;&gt;&gt; time_signatures = [abjad.NonreducedFraction(5, 8)]</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(time_signatures).map(quarters)</span>
<span class="sd">            &gt;&gt;&gt; for item in divisions:</span>
<span class="sd">            ...     print(&quot;sequence:&quot;)</span>
<span class="sd">            ...     for division in item:</span>
<span class="sd">            ...         print(f&quot;\t{repr(division)}&quot;)</span>
<span class="sd">            sequence:</span>
<span class="sd">                NonreducedFraction(3, 8)</span>
<span class="sd">                NonreducedFraction(2, 8)</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions.flatten(depth=-1))</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(</span>
<span class="sd">            ...     music, time_signatures</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 5/8</span>
<span class="sd">                        s1 * 5/8</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;4.</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Splits each division into compound quarters:</span>

<span class="sd">            &gt;&gt;&gt; def quarters(sequence):</span>
<span class="sd">            ...     sequence = baca.Sequence(sequence)</span>
<span class="sd">            ...     sequence = sequence.quarters(compound=(3, 2))</span>
<span class="sd">            ...     sequence = sequence.flatten(depth=-1)</span>
<span class="sd">            ...     return sequence</span>

<span class="sd">            &gt;&gt;&gt; time_signatures = baca.fractions([(3, 4), (6, 8)])</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(time_signatures)</span>
<span class="sd">            &gt;&gt;&gt; divisions = divisions.map(quarters)</span>
<span class="sd">            &gt;&gt;&gt; for item in divisions:</span>
<span class="sd">            ...     print(&quot;sequence:&quot;)</span>
<span class="sd">            ...     for division in item:</span>
<span class="sd">            ...         print(f&quot;\t{repr(division)}&quot;)</span>
<span class="sd">            sequence:</span>
<span class="sd">                NonreducedFraction(1, 4)</span>
<span class="sd">                NonreducedFraction(1, 4)</span>
<span class="sd">                NonreducedFraction(1, 4)</span>
<span class="sd">            sequence:</span>
<span class="sd">                NonreducedFraction(3, 8)</span>
<span class="sd">                NonreducedFraction(3, 8)</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions.flatten(depth=-1))</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music, time_signatures)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 3/4</span>
<span class="sd">                        s1 * 3/4</span>
<span class="sd">                        \time 6/8</span>
<span class="sd">                        s1 * 3/4</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4.</span>
<span class="sd">                        c&#39;4.</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Splits each division by durations and rotates durations one to the left at</span>
<span class="sd">            each new division:</span>

<span class="sd">            &gt;&gt;&gt; durations = baca.Sequence([(1, 16), (1, 8), (1, 4)])</span>
<span class="sd">            &gt;&gt;&gt; time_signatures = baca.fractions([(7, 16), (7, 16), (7, 16)])</span>
<span class="sd">            &gt;&gt;&gt; divisions = []</span>
<span class="sd">            &gt;&gt;&gt; for i, time_signature in enumerate(time_signatures):</span>
<span class="sd">            ...     durations_ = durations.rotate(n=-i)</span>
<span class="sd">            ...     sequence = baca.Sequence(time_signature)</span>
<span class="sd">            ...     sequence = sequence.split_divisions(durations_)</span>
<span class="sd">            ...     sequence = sequence.flatten(depth=-1)</span>
<span class="sd">            ...     divisions.append(sequence)</span>
<span class="sd">            ...</span>
<span class="sd">            &gt;&gt;&gt; divisions = baca.Sequence(divisions)</span>
<span class="sd">            &gt;&gt;&gt; for item in divisions:</span>
<span class="sd">            ...     print(&quot;sequence:&quot;)</span>
<span class="sd">            ...     for division in item:</span>
<span class="sd">            ...         print(f&quot;\t{repr(division)}&quot;)</span>
<span class="sd">            sequence:</span>
<span class="sd">                NonreducedFraction(1, 16)</span>
<span class="sd">                NonreducedFraction(2, 16)</span>
<span class="sd">                NonreducedFraction(4, 16)</span>
<span class="sd">            sequence:</span>
<span class="sd">                NonreducedFraction(2, 16)</span>
<span class="sd">                NonreducedFraction(4, 16)</span>
<span class="sd">                NonreducedFraction(1, 16)</span>
<span class="sd">            sequence:</span>
<span class="sd">                NonreducedFraction(4, 16)</span>
<span class="sd">                NonreducedFraction(1, 16)</span>
<span class="sd">                NonreducedFraction(2, 16)</span>

<span class="sd">            &gt;&gt;&gt; rhythm_maker = rmakers.note()</span>
<span class="sd">            &gt;&gt;&gt; divisions = divisions.flatten(depth=-1)</span>
<span class="sd">            &gt;&gt;&gt; music = rhythm_maker(divisions)</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = abjad.LilyPondFile.rhythm(music, time_signatures)</span>
<span class="sd">            &gt;&gt;&gt; abjad.illustrators.attach_markup_struts(lilypond_file)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(lilypond_file[abjad.Score])</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \new Score</span>
<span class="sd">                &lt;&lt;</span>
<span class="sd">                    \new GlobalContext</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 7/16</span>
<span class="sd">                        s1 * 7/16</span>
<span class="sd">                        \time 7/16</span>
<span class="sd">                        s1 * 7/16</span>
<span class="sd">                        \time 7/16</span>
<span class="sd">                        s1 * 7/16</span>
<span class="sd">                    }</span>
<span class="sd">                    \new RhythmicStaff</span>
<span class="sd">                    {</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        - \tweak staff-padding 11</span>
<span class="sd">                        - \tweak transparent ##t</span>
<span class="sd">                        ^ \markup I</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                    }</span>
<span class="sd">                &gt;&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">durations</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">compound</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">compound</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Multiplier</span><span class="p">(</span><span class="n">compound</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">compound</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">divisions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">depth</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">meters</span> <span class="o">=</span> <span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Meter</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">divisions</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">is_compound</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">meters</span><span class="p">):</span>
                <span class="n">durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">compound</span> <span class="o">*</span> <span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">durations</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cyclic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cyclic</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">cyclic</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">remainder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">remainder</span> <span class="ow">in</span> <span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Left</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Right</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">remainder</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">remainder_fuse_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">remainder_fuse_threshold</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">remainder_fuse_threshold</span><span class="p">)</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Sequence</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">durations</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cyclic</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">without_overhang</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Sequence</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">durations</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cyclic</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">sequence</span> <span class="o">!=</span> <span class="n">without_overhang</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
            <span class="n">remaining_item</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">remainder</span> <span class="o">==</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Left</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">remainder_fuse_threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">remaining_item</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">remaining_item</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">remainder_fuse_threshold</span><span class="p">:</span>
                    <span class="n">fused_value</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">([</span><span class="n">remaining_item</span><span class="p">,</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                    <span class="n">fused_value_</span> <span class="o">=</span> <span class="n">fused_value</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">depth</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">fused_value</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">(</span><span class="n">fused_value_</span><span class="p">)</span><span class="o">.</span><span class="n">fuse</span><span class="p">()</span>
                    <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">fused_value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">remaining_item</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">remainder_fuse_threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remaining_item</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">remaining_item</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">remainder_fuse_threshold</span><span class="p">:</span>
                    <span class="n">fused_value</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">([</span><span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">remaining_item</span><span class="p">])</span>
                    <span class="n">fused_value_</span> <span class="o">=</span> <span class="n">fused_value</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">depth</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">fused_value</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">(</span><span class="n">fused_value_</span><span class="p">)</span><span class="o">.</span><span class="n">fuse</span><span class="p">()</span>
                    <span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">fused_value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remaining_item</span><span class="p">)</span>
            <span class="n">sequence</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sequence</span></div>


<span class="k">class</span> <span class="nc">Tree</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tree.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Here&#39;s a tree:</span>

<span class="sd">        &gt;&gt;&gt; items = [[[0, 1], [2, 3]], [4, 5]]</span>
<span class="sd">        &gt;&gt;&gt; tree = baca.Tree(items=items)</span>

<span class="sd">        &gt;&gt;&gt; abjad.graph(tree) # doctest: +SKIP</span>

<span class="sd">        &gt;&gt;&gt; tree.get_payload(nested=True)</span>
<span class="sd">        [[[0, 1], [2, 3]], [4, 5]]</span>

<span class="sd">        &gt;&gt;&gt; tree.get_payload()</span>
<span class="sd">        [0, 1, 2, 3, 4, 5]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Here&#39;s an internal node:</span>

<span class="sd">        &gt;&gt;&gt; tree[1]</span>
<span class="sd">        Tree(items=[Tree(items=4), Tree(items=5)])</span>

<span class="sd">        &gt;&gt;&gt; string = abjad.storage(tree[1])</span>
<span class="sd">        &gt;&gt;&gt; print(string)</span>
<span class="sd">        baca.Tree(</span>
<span class="sd">            items=[</span>
<span class="sd">                baca.Tree(</span>
<span class="sd">                    items=4,</span>
<span class="sd">                    ),</span>
<span class="sd">                baca.Tree(</span>
<span class="sd">                    items=5,</span>
<span class="sd">                    ),</span>
<span class="sd">                ],</span>
<span class="sd">            )</span>

<span class="sd">        &gt;&gt;&gt; tree[1].get_payload(nested=True)</span>
<span class="sd">        [4, 5]</span>

<span class="sd">        &gt;&gt;&gt; tree[1].get_payload()</span>
<span class="sd">        [4, 5]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Here&#39;s a leaf:</span>

<span class="sd">        &gt;&gt;&gt; tree[1][0]</span>
<span class="sd">        Tree(items=4)</span>

<span class="sd">        &gt;&gt;&gt; string = abjad.storage(tree[1][0])</span>
<span class="sd">        &gt;&gt;&gt; print(string)</span>
<span class="sd">        baca.Tree(</span>
<span class="sd">            items=4,</span>
<span class="sd">            )</span>

<span class="sd">        &gt;&gt;&gt; tree[1][0].get_payload(nested=True)</span>
<span class="sd">        4</span>

<span class="sd">        &gt;&gt;&gt; tree[1][0].get_payload()</span>
<span class="sd">        [4]</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Initializes from other trees:</span>

<span class="sd">        &gt;&gt;&gt; tree_1 = baca.Tree(items=[0, 1])</span>
<span class="sd">        &gt;&gt;&gt; tree_2 = baca.Tree(items=[2, 3])</span>
<span class="sd">        &gt;&gt;&gt; tree_3 = baca.Tree(items=[4, 5])</span>
<span class="sd">        &gt;&gt;&gt; tree = baca.Tree(items=[[tree_1, tree_2], tree_3])</span>
<span class="sd">        &gt;&gt;&gt; abjad.graph(tree) # doctest: +SKIP</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">### CLASS VARIABLES ###</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;_children&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_item_class&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_items&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_equivalence_markup&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_expression&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_parent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_payload&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1">### INITIALIZER ###</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">item_class</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_item_class</span> <span class="o">=</span> <span class="n">item_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_payload</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_are_internal_nodes</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_internal_nodes</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_payload</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="n">items</span>

    <span class="c1">### SPECIAL METHODS ###</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when tree contains ``argument``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Tree contains node:</span>

<span class="sd">            &gt;&gt;&gt; items = [[[0, 1], [2, 3]], [4, 5]]</span>
<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items)</span>

<span class="sd">            &gt;&gt;&gt; for node in tree:</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)])])</span>
<span class="sd">            Tree(items=[Tree(items=4), Tree(items=5)])</span>

<span class="sd">            &gt;&gt;&gt; tree[-1] in tree</span>
<span class="sd">            True</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Tree does not contain node:</span>

<span class="sd">            &gt;&gt;&gt; tree[-1][-1] in tree</span>
<span class="sd">            False</span>

<span class="sd">        Returns true or false.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">argument</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Is true when ``argument`` is the same type as tree and when the payload</span>
<span class="sd">        of all subtrees are equal.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Is true when subtrees are equal:</span>

<span class="sd">            &gt;&gt;&gt; sequence_1 = [[[0, 1], [2, 3]], [4, 5]]</span>
<span class="sd">            &gt;&gt;&gt; tree_1 = baca.Tree(sequence_1)</span>
<span class="sd">            &gt;&gt;&gt; sequence_2 = [[[0, 1], [2, 3]], [4, 5]]</span>
<span class="sd">            &gt;&gt;&gt; tree_2 = baca.Tree(sequence_2)</span>
<span class="sd">            &gt;&gt;&gt; sequence_3 = [[0, 1], [2, 3], [4, 5], [6, 7]]</span>
<span class="sd">            &gt;&gt;&gt; tree_3 = baca.Tree(sequence_3)</span>

<span class="sd">            &gt;&gt;&gt; tree_1 == tree_1</span>
<span class="sd">            True</span>
<span class="sd">            &gt;&gt;&gt; tree_1 == tree_2</span>
<span class="sd">            True</span>
<span class="sd">            &gt;&gt;&gt; tree_1 == tree_3</span>
<span class="sd">            False</span>
<span class="sd">            &gt;&gt;&gt; tree_2 == tree_1</span>
<span class="sd">            True</span>
<span class="sd">            &gt;&gt;&gt; tree_2 == tree_2</span>
<span class="sd">            True</span>
<span class="sd">            &gt;&gt;&gt; tree_2 == tree_3</span>
<span class="sd">            False</span>
<span class="sd">            &gt;&gt;&gt; tree_3 == tree_1</span>
<span class="sd">            False</span>
<span class="sd">            &gt;&gt;&gt; tree_3 == tree_2</span>
<span class="sd">            False</span>
<span class="sd">            &gt;&gt;&gt; tree_3 == tree_3</span>
<span class="sd">            True</span>

<span class="sd">        Returns true or false.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_payload</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">argument</span><span class="o">.</span><span class="n">_payload</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_payload</span> <span class="o">==</span> <span class="n">argument</span><span class="o">.</span><span class="n">_payload</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">argument</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_noncyclic_children</span><span class="p">,</span> <span class="n">argument</span><span class="o">.</span><span class="n">_noncyclic_children</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets node or node slice identified by ``argument``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets node:</span>

<span class="sd">            &gt;&gt;&gt; items = [[[0, 1], [2, 3]], [4, 5]]</span>
<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items)</span>

<span class="sd">            &gt;&gt;&gt; tree[-1]</span>
<span class="sd">            Tree(items=[Tree(items=4), Tree(items=5)])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets slice:</span>

<span class="sd">            &gt;&gt;&gt; tree[-1:]</span>
<span class="sd">            [Tree(items=[Tree(items=4), Tree(items=5)])]</span>

<span class="sd">        Returns node or slice of nodes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__graph__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">keywords</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Graphs tree.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Graphs tree:</span>

<span class="sd">            &gt;&gt;&gt; items = [[[0, 1], [2, 3]], [4, 5]]</span>
<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items)</span>

<span class="sd">            &gt;&gt;&gt; abjad.graph(tree) # doctest: +SKIP</span>

<span class="sd">            &gt;&gt;&gt; tree.__graph__()</span>
<span class="sd">            &lt;uqbar.graphs.Graph.Graph object at 0x...&gt;</span>

<span class="sd">        Returns uqbar graph.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">uqbar</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span>
            <span class="n">attributes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bgcolor&quot;</span><span class="p">:</span> <span class="s2">&quot;transparent&quot;</span><span class="p">,</span> <span class="s2">&quot;truecolor&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;G&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">node_mapping</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_depth_first</span><span class="p">():</span>
            <span class="n">graphviz_node</span> <span class="o">=</span> <span class="n">uqbar</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">Node</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                <span class="n">graphviz_node</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;circle&quot;</span>
                <span class="n">graphviz_node</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">graphviz_node</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;box&quot;</span>
                <span class="n">graphviz_node</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">_payload</span><span class="p">)</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graphviz_node</span><span class="p">)</span>
            <span class="n">node_mapping</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">graphviz_node</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">uqbar</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">Edge</span><span class="p">()</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span>
                    <span class="n">node_mapping</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">_parent</span><span class="p">],</span>
                    <span class="n">node_mapping</span><span class="p">[</span><span class="n">node</span><span class="p">],</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">graph</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hashes tree.</span>

<span class="sd">        Required to be explicitly redefined on Python 3 if __eq__ changes.</span>

<span class="sd">        Returns integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span>

    <span class="c1"># TODO: make this work without recursion error</span>
    <span class="c1">#    def __iter__(self):</span>
    <span class="c1">#        &quot;&quot;&quot;</span>
    <span class="c1">#        Iterates tree at level -1.</span>
    <span class="c1">#</span>
    <span class="c1">#        ..  container:: example</span>
    <span class="c1">#</span>
    <span class="c1">#            Gets node:</span>
    <span class="c1">#</span>
    <span class="c1">#                &gt;&gt;&gt; items = [[[0, 1], [2, 3]], [4, 5]]</span>
    <span class="c1">#                &gt;&gt;&gt; tree = baca.Tree(items=items)</span>
    <span class="c1">#</span>
    <span class="c1">#                &gt;&gt;&gt; tree.__iter__()</span>
    <span class="c1">#</span>
    <span class="c1">#        &quot;&quot;&quot;</span>
    <span class="c1">#        return self.iterate(level=-1)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets length of tree.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets length of tree:</span>

<span class="sd">            &gt;&gt;&gt; items = [[[0, 1], [2, 3]], [4, 5]]</span>
<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items)</span>

<span class="sd">            &gt;&gt;&gt; len(tree)</span>
<span class="sd">            2</span>

<span class="sd">        Defined equal to number of nodes in tree at level 1.</span>

<span class="sd">        Returns nonnegative integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets interpreter representation of tree.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets interpreter representation of tree:</span>

<span class="sd">            &gt;&gt;&gt; items = [[[0, 1], [2, 3]], [4, 5]]</span>
<span class="sd">            &gt;&gt;&gt; baca.Tree(items=items)</span>
<span class="sd">            Tree(items=[Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)])]), Tree(items=[Tree(items=4), Tree(items=5)])])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets interpreter representation of leaf:</span>

<span class="sd">            &gt;&gt;&gt; baca.Tree(0)</span>
<span class="sd">            Tree(items=0)</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets interpreter representation of empty tree:</span>

<span class="sd">            &gt;&gt;&gt; baca.Tree()</span>
<span class="sd">            Tree()</span>

<span class="sd">        Returns string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">abjad</span><span class="o">.</span><span class="n">StorageFormatManager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_repr_format</span><span class="p">()</span>

    <span class="c1">### PRIVATE PROPERTIES ###</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_noncyclic_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_parentage</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">### PRIVATE METHODS ###</span>

    <span class="k">def</span> <span class="nf">_apply_to_leaves_and_emit_new_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">iterate</span><span class="p">(</span><span class="n">level</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">leaf</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">leaf</span><span class="p">)</span>
            <span class="n">pitch</span> <span class="o">=</span> <span class="n">leaf</span><span class="o">.</span><span class="n">_items</span>
            <span class="n">pitch</span> <span class="o">=</span> <span class="n">operator</span><span class="p">(</span><span class="n">pitch</span><span class="p">)</span>
            <span class="n">leaf</span><span class="o">.</span><span class="n">_set_leaf_item</span><span class="p">(</span><span class="n">pitch</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_are_internal_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">argument</span><span class="p">,</span> <span class="nb">str</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">argument</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_get_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets depth.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets depth:</span>

<span class="sd">            &gt;&gt;&gt; items = [[[0, 1], [2, 3]], [4, 5]]</span>
<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items)</span>

<span class="sd">            &gt;&gt;&gt; tree[1]._get_depth()</span>
<span class="sd">            2</span>

<span class="sd">        Returns nonnegative integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_depth_first</span><span class="p">():</span>
            <span class="n">levels</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">_get_level</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_level</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_get_format_specification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">abjad</span><span class="o">.</span><span class="n">FormatSpecification</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_index_in_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_get_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">negative</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets level.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets level:</span>

<span class="sd">                &gt;&gt;&gt; items = [[[0, 1], [2, 3]], [4, 5]]</span>
<span class="sd">                &gt;&gt;&gt; tree = baca.Tree(items=items)</span>

<span class="sd">            &gt;&gt;&gt; tree._get_level()</span>
<span class="sd">            0</span>

<span class="sd">            &gt;&gt;&gt; tree[1]._get_level()</span>
<span class="sd">            1</span>

<span class="sd">            &gt;&gt;&gt; tree[1][1]._get_level()</span>
<span class="sd">            2</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets negative level:</span>

<span class="sd">                &gt;&gt;&gt; items = [[[0, 1], [2, 3]], [4, 5]]</span>
<span class="sd">                &gt;&gt;&gt; tree = baca.Tree(items=items)</span>

<span class="sd">            &gt;&gt;&gt; tree._get_level(negative=True)</span>
<span class="sd">            -4</span>

<span class="sd">            &gt;&gt;&gt; tree[1]._get_level(negative=True)</span>
<span class="sd">            -2</span>

<span class="sd">            &gt;&gt;&gt; tree[1][1]._get_level(negative=True)</span>
<span class="sd">            -1</span>

<span class="sd">            &gt;&gt;&gt; tree[-1][-1]._get_level(negative=True)</span>
<span class="sd">            -1</span>

<span class="sd">            &gt;&gt;&gt; tree[-1]._get_level(negative=True)</span>
<span class="sd">            -2</span>

<span class="sd">        Returns nonnegative integer when ``negative`` is false.</span>

<span class="sd">        Returns negative integer when ``negative`` is true.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">negative</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_depth</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_parentage</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="k">def</span> <span class="nf">_get_next_n_nodes_at_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">nodes_must_be_complete</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets next ``n`` nodes ``level``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Nodes don&#39;t need to be complete:</span>

<span class="sd">            &gt;&gt;&gt; items = [[0, 1], [2, 3], [4, 5], [6, 7]]</span>
<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items)</span>

<span class="sd">            Gets all nodes at level 2:</span>

<span class="sd">            &gt;&gt;&gt; tree[0][0]._get_next_n_nodes_at_level(None, 2)</span>
<span class="sd">            [Tree(items=1), Tree(items=2), Tree(items=3), Tree(items=4), Tree(items=5), Tree(items=6), Tree(items=7)]</span>

<span class="sd">            Gets all nodes at level -1:</span>

<span class="sd">            &gt;&gt;&gt; tree[0][0]._get_next_n_nodes_at_level(None, -1)</span>
<span class="sd">            [Tree(items=1), Tree(items=2), Tree(items=3), Tree(items=4), Tree(items=5), Tree(items=6), Tree(items=7)]</span>

<span class="sd">            Gets next 4 nodes at level 2:</span>

<span class="sd">            &gt;&gt;&gt; tree[0][0]._get_next_n_nodes_at_level(4, 2)</span>
<span class="sd">            [Tree(items=1), Tree(items=2), Tree(items=3), Tree(items=4)]</span>

<span class="sd">            Gets next 3 nodes at level 1:</span>

<span class="sd">            &gt;&gt;&gt; tree[0][0]._get_next_n_nodes_at_level(3, 1)</span>
<span class="sd">            [Tree(items=[Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)]), Tree(items=[Tree(items=4), Tree(items=5)])]</span>

<span class="sd">            Gets next node at level 0:</span>

<span class="sd">            &gt;&gt;&gt; tree[0][0]._get_next_n_nodes_at_level(1, 0)</span>
<span class="sd">            [Tree(items=[Tree(items=[Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)]), Tree(items=[Tree(items=4), Tree(items=5)]), Tree(items=[Tree(items=6), Tree(items=7)])])]</span>

<span class="sd">            Gets next 4 nodes at level -1:</span>

<span class="sd">            &gt;&gt;&gt; tree[0][0]._get_next_n_nodes_at_level(4, -1)</span>
<span class="sd">            [Tree(items=1), Tree(items=2), Tree(items=3), Tree(items=4)]</span>

<span class="sd">            Gets next 3 nodes at level -2:</span>

<span class="sd">            &gt;&gt;&gt; tree[0][0]._get_next_n_nodes_at_level(3, -2)</span>
<span class="sd">            [Tree(items=[Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)]), Tree(items=[Tree(items=4), Tree(items=5)])]</span>

<span class="sd">            Gets previous 4 nodes at level 2:</span>

<span class="sd">            &gt;&gt;&gt; tree[-1][-1]._get_next_n_nodes_at_level(-4, 2)</span>
<span class="sd">            [Tree(items=6), Tree(items=5), Tree(items=4), Tree(items=3)]</span>

<span class="sd">            Gets previous 3 nodes at level 1:</span>

<span class="sd">            &gt;&gt;&gt; tree[-1][-1]._get_next_n_nodes_at_level(-3, 1)</span>
<span class="sd">            [Tree(items=[Tree(items=6)]), Tree(items=[Tree(items=4), Tree(items=5)]), Tree(items=[Tree(items=2), Tree(items=3)])]</span>

<span class="sd">            Gets previous node at level 0:</span>

<span class="sd">            &gt;&gt;&gt; tree[-1][-1]._get_next_n_nodes_at_level(-1, 0)</span>
<span class="sd">            [Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)]), Tree(items=[Tree(items=4), Tree(items=5)]), Tree(items=[Tree(items=6)])])]</span>

<span class="sd">            Gets previous 4 nodes at level -1:</span>

<span class="sd">            &gt;&gt;&gt; tree[-1][-1]._get_next_n_nodes_at_level(-4, -1)</span>
<span class="sd">            [Tree(items=6), Tree(items=5), Tree(items=4), Tree(items=3)]</span>

<span class="sd">            Gets previous 3 nodes at level -2:</span>

<span class="sd">            &gt;&gt;&gt; tree[-1][-1]._get_next_n_nodes_at_level(-3, -2)</span>
<span class="sd">            [Tree(items=[Tree(items=6)]), Tree(items=[Tree(items=4), Tree(items=5)]), Tree(items=[Tree(items=2), Tree(items=3)])]</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Tree of length greater than ``1`` for examples with positive ``n``:</span>

<span class="sd">            &gt;&gt;&gt; items = [[0, 1], [2, 3], [4, 5], [6, 7]]</span>
<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items)</span>

<span class="sd">            Gets next 4 nodes at level 2:</span>

<span class="sd">            &gt;&gt;&gt; for node in tree[0][0]._get_next_n_nodes_at_level(</span>
<span class="sd">            ...     4, 2,</span>
<span class="sd">            ...     nodes_must_be_complete=True,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     node</span>
<span class="sd">            ...</span>
<span class="sd">            Tree(items=1)</span>
<span class="sd">            Tree(items=2)</span>
<span class="sd">            Tree(items=3)</span>
<span class="sd">            Tree(items=4)</span>

<span class="sd">            Gets next 3 nodes at level 1:</span>

<span class="sd">            &gt;&gt;&gt; for node in tree[0][0]._get_next_n_nodes_at_level(</span>
<span class="sd">            ...     3, 1,</span>
<span class="sd">            ...     nodes_must_be_complete=True,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=[Tree(items=1)])</span>
<span class="sd">            Tree(items=[Tree(items=2), Tree(items=3)])</span>
<span class="sd">            Tree(items=[Tree(items=4), Tree(items=5)])</span>
<span class="sd">            Tree(items=[Tree(items=6), Tree(items=7)])</span>

<span class="sd">            Gets next 4 nodes at level -1:</span>

<span class="sd">            &gt;&gt;&gt; for node in tree[0][0]._get_next_n_nodes_at_level(4, -1):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=1)</span>
<span class="sd">            Tree(items=2)</span>
<span class="sd">            Tree(items=3)</span>
<span class="sd">            Tree(items=4)</span>

<span class="sd">            Gets next 3 nodes at level -2:</span>

<span class="sd">            &gt;&gt;&gt; for node in tree[0][0]._get_next_n_nodes_at_level(</span>
<span class="sd">            ...     3, -2,</span>
<span class="sd">            ...     nodes_must_be_complete=True,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=[Tree(items=1)])</span>
<span class="sd">            Tree(items=[Tree(items=2), Tree(items=3)])</span>
<span class="sd">            Tree(items=[Tree(items=4), Tree(items=5)])</span>
<span class="sd">            Tree(items=[Tree(items=6), Tree(items=7)])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Tree of length greater than ``1`` for examples with negative ``n``:</span>

<span class="sd">            &gt;&gt;&gt; items = [[0, 1], [2, 3], [4, 5], [6, 7]]</span>
<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items)</span>

<span class="sd">            Gets previous 4 nodes at level 2:</span>

<span class="sd">            &gt;&gt;&gt; for node in tree[-1][-1]._get_next_n_nodes_at_level(</span>
<span class="sd">            ...     -4, 2,</span>
<span class="sd">            ...     nodes_must_be_complete=True,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=6)</span>
<span class="sd">            Tree(items=5)</span>
<span class="sd">            Tree(items=4)</span>
<span class="sd">            Tree(items=3)</span>

<span class="sd">            Gets previous 3 nodes at level 1:</span>

<span class="sd">            &gt;&gt;&gt; for node in tree[-1][-1]._get_next_n_nodes_at_level(</span>
<span class="sd">            ...     -3, 1,</span>
<span class="sd">            ...     nodes_must_be_complete=True,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=[Tree(items=6)])</span>
<span class="sd">            Tree(items=[Tree(items=4), Tree(items=5)])</span>
<span class="sd">            Tree(items=[Tree(items=2), Tree(items=3)])</span>
<span class="sd">            Tree(items=[Tree(items=0), Tree(items=1)])</span>

<span class="sd">            Gets previous 4 nodes at level -1:</span>

<span class="sd">            &gt;&gt;&gt; for node in tree[-1][-1]._get_next_n_nodes_at_level(</span>
<span class="sd">            ...     -4, -1,</span>
<span class="sd">            ...     nodes_must_be_complete=True,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=6)</span>
<span class="sd">            Tree(items=5)</span>
<span class="sd">            Tree(items=4)</span>
<span class="sd">            Tree(items=3)</span>

<span class="sd">            Gets previous 3 nodes at level -2:</span>

<span class="sd">            &gt;&gt;&gt; for node in tree[-1][-1]._get_next_n_nodes_at_level(</span>
<span class="sd">            ...     -3, -2,</span>
<span class="sd">            ...     nodes_must_be_complete=True,</span>
<span class="sd">            ...     ):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=[Tree(items=6)])</span>
<span class="sd">            Tree(items=[Tree(items=4), Tree(items=5)])</span>
<span class="sd">            Tree(items=[Tree(items=2), Tree(items=3)])</span>
<span class="sd">            Tree(items=[Tree(items=0), Tree(items=1)])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid_level</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;invalid level: </span><span class="si">{</span><span class="n">level</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">self_is_found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">first_node_returned_is_trimmed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">all_nodes_at_level</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">reverse</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">all_nodes_at_level</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">generator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root</span><span class="o">.</span><span class="n">_iterate_depth_first</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>
        <span class="n">previous_node</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">generator</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">all_nodes_at_level</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">first_node_returned_is_trimmed</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">nodes_must_be_complete</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">result</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">all_nodes_at_level</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">self_is_found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># test whether node to return is higher in tree than self;</span>
                <span class="c1"># or-clause allows for test of either nonnegative</span>
                <span class="c1"># or negative level</span>
                <span class="k">if</span> <span class="p">((</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">level</span><span class="p">)</span> <span class="ow">and</span> <span class="n">level</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_level</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">level</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">level</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_level</span><span class="p">(</span><span class="n">negative</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="n">first_node_returned_is_trimmed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">subtree_to_trim</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">_parent</span>
                    <span class="c1"># find subtree to trim where level is nonnegative</span>
                    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">level</span><span class="p">:</span>
                        <span class="k">while</span> <span class="n">level</span> <span class="o">&lt;</span> <span class="n">subtree_to_trim</span><span class="o">.</span><span class="n">_get_level</span><span class="p">():</span>
                            <span class="n">subtree_to_trim</span> <span class="o">=</span> <span class="n">subtree_to_trim</span><span class="o">.</span><span class="n">_parent</span>
                    <span class="c1"># find subtree to trim where level is negative</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">while</span> <span class="n">subtree_to_trim</span><span class="o">.</span><span class="n">_get_level</span><span class="p">(</span><span class="n">negative</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">level</span><span class="p">:</span>
                            <span class="n">subtree_to_trim</span> <span class="o">=</span> <span class="n">subtree_to_trim</span><span class="o">.</span><span class="n">_parent</span>
                    <span class="n">position_of_descendant</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">subtree_to_trim</span><span class="o">.</span><span class="n">_get_position_of_descendant</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">first_subtree</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">subtree_to_trim</span><span class="p">)</span>
                    <span class="n">reference_node</span> <span class="o">=</span> <span class="n">first_subtree</span><span class="o">.</span><span class="n">_get_node_at_position</span><span class="p">(</span>
                        <span class="n">position_of_descendant</span>
                    <span class="p">)</span>
                    <span class="n">reference_node</span><span class="o">.</span><span class="n">_remove_to_root</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">first_subtree</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">self_is_found</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">_is_at_level</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                    <span class="c1"># special case to handle a cyclic tree of length 1</span>
                    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">_is_at_level</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">previous_node</span><span class="o">.</span><span class="n">_is_at_level</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
                            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">previous_node</span> <span class="o">=</span> <span class="n">node</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">all_nodes_at_level</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;not enough nodes at level </span><span class="si">{</span><span class="n">level</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_node_at_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">position</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_get_parentage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets parentage.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets parentage with self:</span>

<span class="sd">            &gt;&gt;&gt; items = [[[0, 1], [2, 3]], [4, 5]]</span>
<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items)</span>
<span class="sd">            &gt;&gt;&gt; parentage = tree[1]._get_parentage()</span>
<span class="sd">            &gt;&gt;&gt; for tree in parentage:</span>
<span class="sd">            ...     tree</span>
<span class="sd">            Tree(items=[Tree(items=4), Tree(items=5)])</span>
<span class="sd">            Tree(items=[Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)])]), Tree(items=[Tree(items=4), Tree(items=5)])])</span>

<span class="sd">            Gets parentage without self:</span>

<span class="sd">            &gt;&gt;&gt; items = [[[0, 1], [2, 3]], [4, 5]]</span>
<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items)</span>
<span class="sd">            &gt;&gt;&gt; for tree in tree[1]._get_parentage()[1:]:</span>
<span class="sd">            ...     tree</span>
<span class="sd">            Tree(items=[Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)])]), Tree(items=[Tree(items=4), Tree(items=5)])])</span>

<span class="sd">        Returns tuple.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span>
        <span class="k">while</span> <span class="n">current</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">_parent</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets position.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets position:</span>

<span class="sd">            &gt;&gt;&gt; items = [[[0, 1], [2, 3]], [4, 5]]</span>
<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items)</span>

<span class="sd">            &gt;&gt;&gt; tree[1]._get_position()</span>
<span class="sd">            (1,)</span>

<span class="sd">        Position of node defined relative to root.</span>

<span class="sd">        Returns tuple of zero or more nonnegative integers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_parentage</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">_get_index_in_parent</span><span class="p">())</span>
        <span class="n">result</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_position_of_descendant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">descendant</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets position of ``descendent`` relative to node rather than relative</span>
<span class="sd">        to root.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets position of descendant:</span>

<span class="sd">            &gt;&gt;&gt; items = [[0, 1], [2, 3], [4, 5], [6, 7]]</span>
<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items)</span>

<span class="sd">            &gt;&gt;&gt; tree[3]._get_position_of_descendant(tree[3][0])</span>
<span class="sd">            (0,)</span>

<span class="sd">        Returns tuple of zero or more nonnegative integers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">descendant</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">descendant</span><span class="o">.</span><span class="n">_get_position</span><span class="p">()[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_position</span><span class="p">())</span> <span class="p">:]</span>

    <span class="k">def</span> <span class="nf">_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">current_node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">current_node</span> <span class="ow">is</span> <span class="n">node</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">i</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;not in tree: </span><span class="si">{</span><span class="n">node</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_initialize_internal_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">expression</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;_expression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">equivalence_markup</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;_equivalence_markup&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">child</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">items</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">item_class</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">item_class</span><span class="p">)</span>
            <span class="n">child</span><span class="o">.</span><span class="n">_expression</span> <span class="o">=</span> <span class="n">expression</span>
            <span class="n">child</span><span class="o">.</span><span class="n">_equivalence_markup</span> <span class="o">=</span> <span class="n">equivalence_markup</span>
            <span class="n">child</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span> <span class="o">=</span> <span class="n">children</span>
        <span class="k">return</span> <span class="n">children</span>

    <span class="k">def</span> <span class="nf">_initialize_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">_payload</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_class</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_payload</span> <span class="o">=</span> <span class="n">payload</span>
        <span class="k">return</span> <span class="n">payload</span>

    <span class="k">def</span> <span class="nf">_is_at_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">level</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_level</span><span class="p">()</span> <span class="o">==</span> <span class="n">level</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_level</span><span class="p">(</span>
            <span class="n">negative</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span> <span class="o">==</span> <span class="n">level</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_is_leaf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_level</span><span class="p">(</span><span class="n">negative</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_is_leftmost_leaf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_leaf</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_index_in_parent</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_is_rightmost_leaf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_leaf</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">index_in_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_index_in_parent</span><span class="p">()</span>
        <span class="n">parentage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_parentage</span><span class="p">()</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">parentage</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">index_in_parent</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_is_valid_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="n">maximum_absolute_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_depth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">maximum_absolute_level</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_iterate_depth_first</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates depth-first.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Iterates tree depth-first from left to right:</span>

<span class="sd">            &gt;&gt;&gt; items = [[0, 1], [2, 3], [4, 5], [6, 7]]</span>
<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items)</span>

<span class="sd">            &gt;&gt;&gt; for node in tree._iterate_depth_first(): node</span>
<span class="sd">            ...</span>
<span class="sd">            Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)]), Tree(items=[Tree(items=4), Tree(items=5)]), Tree(items=[Tree(items=6), Tree(items=7)])])</span>
<span class="sd">            Tree(items=[Tree(items=0), Tree(items=1)])</span>
<span class="sd">            Tree(items=0)</span>
<span class="sd">            Tree(items=1)</span>
<span class="sd">            Tree(items=[Tree(items=2), Tree(items=3)])</span>
<span class="sd">            Tree(items=2)</span>
<span class="sd">            Tree(items=3)</span>
<span class="sd">            Tree(items=[Tree(items=4), Tree(items=5)])</span>
<span class="sd">            Tree(items=4)</span>
<span class="sd">            Tree(items=5)</span>
<span class="sd">            Tree(items=[Tree(items=6), Tree(items=7)])</span>
<span class="sd">            Tree(items=6)</span>
<span class="sd">            Tree(items=7)</span>

<span class="sd">        ..  container::</span>

<span class="sd">            Iterates tree depth-first from right to left:</span>

<span class="sd">            &gt;&gt;&gt; for node in tree._iterate_depth_first(reverse=True): node</span>
<span class="sd">            ...</span>
<span class="sd">            Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)]), Tree(items=[Tree(items=4), Tree(items=5)]), Tree(items=[Tree(items=6), Tree(items=7)])])</span>
<span class="sd">            Tree(items=[Tree(items=6), Tree(items=7)])</span>
<span class="sd">            Tree(items=7)</span>
<span class="sd">            Tree(items=6)</span>
<span class="sd">            Tree(items=[Tree(items=4), Tree(items=5)])</span>
<span class="sd">            Tree(items=5)</span>
<span class="sd">            Tree(items=4)</span>
<span class="sd">            Tree(items=[Tree(items=2), Tree(items=3)])</span>
<span class="sd">            Tree(items=3)</span>
<span class="sd">            Tree(items=2)</span>
<span class="sd">            Tree(items=[Tree(items=0), Tree(items=1)])</span>
<span class="sd">            Tree(items=1)</span>
<span class="sd">            Tree(items=0)</span>

<span class="sd">        Returns generator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="bp">self</span>
        <span class="n">iterable_self</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
            <span class="n">iterable_self</span> <span class="o">=</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">iterable_self</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">_iterate_depth_first</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">_remove_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">node</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_remove_to_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes node and all nodes left of node to root.</span>

<span class="sd">        ..container:: example</span>

<span class="sd">            Removes node and all nodes left of node to root:</span>

<span class="sd">            &gt;&gt;&gt; items = [[0, 1], [2, 3], [4, 5], [6, 7]]</span>

<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items)</span>
<span class="sd">            &gt;&gt;&gt; tree[0][0]._remove_to_root()</span>
<span class="sd">            &gt;&gt;&gt; tree.get_payload(nested=True)</span>
<span class="sd">            [[1], [2, 3], [4, 5], [6, 7]]</span>

<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items)</span>
<span class="sd">            &gt;&gt;&gt; tree[0][1]._remove_to_root()</span>
<span class="sd">            &gt;&gt;&gt; tree.get_payload(nested=True)</span>
<span class="sd">            [[2, 3], [4, 5], [6, 7]]</span>

<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items)</span>
<span class="sd">            &gt;&gt;&gt; tree[1]._remove_to_root()</span>
<span class="sd">            &gt;&gt;&gt; tree.get_payload(nested=True)</span>
<span class="sd">            [[4, 5], [6, 7]]</span>

<span class="sd">        Modifies in-place to root.</span>

<span class="sd">        Returns none.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># trim left-siblings of self and self</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span>
        <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
            <span class="n">iterable_parent</span> <span class="o">=</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iterable_parent</span> <span class="o">=</span> <span class="n">parent</span><span class="p">[:]</span>
        <span class="k">for</span> <span class="n">sibling</span> <span class="ow">in</span> <span class="n">iterable_parent</span><span class="p">:</span>
            <span class="n">sibling</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_remove_node</span><span class="p">(</span><span class="n">sibling</span><span class="p">)</span>
            <span class="c1"># break and do not remove siblings to right of self</span>
            <span class="k">if</span> <span class="n">sibling</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="c1"># trim parentage</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">_get_parentage</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">iterable_parent</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">_parent</span><span class="p">[:]</span>
                <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
                    <span class="n">iterable_parent</span> <span class="o">=</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">_parent</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">iterable_parent</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">_parent</span><span class="p">[:]</span>
                <span class="k">for</span> <span class="n">sibling</span> <span class="ow">in</span> <span class="n">iterable_parent</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sibling</span> <span class="ow">is</span> <span class="n">node</span><span class="p">:</span>
                        <span class="c1"># remove node now if it was emptied earlier</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">sibling</span><span class="p">):</span>
                            <span class="n">sibling</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_remove_node</span><span class="p">(</span><span class="n">sibling</span><span class="p">)</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sibling</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_remove_node</span><span class="p">(</span><span class="n">sibling</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_leaf_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_leaf</span><span class="p">(),</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="n">item</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_payload</span> <span class="o">=</span> <span class="n">item</span>

    <span class="c1">### PUBLIC PROPERTIES ###</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">item_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets item class.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Coerces input:</span>

<span class="sd">            &gt;&gt;&gt; items = [[1.1, 2.2], [8.8, 9.9]]</span>
<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items, item_class=int)</span>

<span class="sd">            &gt;&gt;&gt; for node in tree.iterate(level=-1):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=1, item_class=int)</span>
<span class="sd">            Tree(items=2, item_class=int)</span>
<span class="sd">            Tree(items=8, item_class=int)</span>
<span class="sd">            Tree(items=9, item_class=int)</span>

<span class="sd">            &gt;&gt;&gt; tree.get_payload(nested=True)</span>
<span class="sd">            [[1, 2], [8, 9]]</span>

<span class="sd">        Defaults to none.</span>

<span class="sd">        Set to class or none.</span>

<span class="sd">        Returns class or none.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_item_class</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets items.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets items:</span>

<span class="sd">            &gt;&gt;&gt; items = [[[0, 1], [2, 3]], [4, 5]]</span>
<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items)</span>

<span class="sd">            &gt;&gt;&gt; for item in tree.items:</span>
<span class="sd">            ...     item</span>
<span class="sd">            Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)])])</span>
<span class="sd">            Tree(items=[Tree(items=4), Tree(items=5)])</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Returns list:</span>

<span class="sd">            &gt;&gt;&gt; isinstance(tree.items, list)</span>
<span class="sd">            True</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span>

    <span class="c1">### PUBLIC METHODS ###</span>

    <span class="k">def</span> <span class="nf">get_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nested</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets payload.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets payload:</span>

<span class="sd">            &gt;&gt;&gt; items = [[[0, 1], [2, 3]], [4, 5]]</span>
<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items)</span>

<span class="sd">            &gt;&gt;&gt; tree.get_payload()</span>
<span class="sd">            [0, 1, 2, 3, 4, 5]</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets nested payload:</span>

<span class="sd">            &gt;&gt;&gt; tree.get_payload(nested=True)</span>
<span class="sd">            [[[0, 1], [2, 3]], [4, 5]]</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Gets payload in reverse:</span>

<span class="sd">            &gt;&gt;&gt; tree.get_payload(reverse=True)</span>
<span class="sd">            [5, 4, 3, 2, 1, 0]</span>

<span class="sd">        Nested payload in reverse is not yet implemented.</span>

<span class="sd">        Returns list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">nested</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_payload</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_payload</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_noncyclic_children</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">_payload</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">_payload</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">nested</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">leaf_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterate</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">leaf_node</span><span class="o">.</span><span class="n">_payload</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">iterate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates tree at optional ``level``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Example tree:</span>

<span class="sd">            &gt;&gt;&gt; items = [[[0, 1], [2, 3]], [4, 5]]</span>
<span class="sd">            &gt;&gt;&gt; tree = baca.Tree(items=items)</span>
<span class="sd">            &gt;&gt;&gt; abjad.graph(tree) # doctest: +SKIP</span>

<span class="sd">            Iterates all levels:</span>

<span class="sd">            &gt;&gt;&gt; for node in tree.iterate():</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=[Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)])]), Tree(items=[Tree(items=4), Tree(items=5)])])</span>
<span class="sd">            Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)])])</span>
<span class="sd">            Tree(items=[Tree(items=0), Tree(items=1)])</span>
<span class="sd">            Tree(items=0)</span>
<span class="sd">            Tree(items=1)</span>
<span class="sd">            Tree(items=[Tree(items=2), Tree(items=3)])</span>
<span class="sd">            Tree(items=2)</span>
<span class="sd">            Tree(items=3)</span>
<span class="sd">            Tree(items=[Tree(items=4), Tree(items=5)])</span>
<span class="sd">            Tree(items=4)</span>
<span class="sd">            Tree(items=5)</span>

<span class="sd">            Iterates all levels in reverse:</span>

<span class="sd">            &gt;&gt;&gt; for node in tree.iterate(reverse=True):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=[Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)])]), Tree(items=[Tree(items=4), Tree(items=5)])])</span>
<span class="sd">            Tree(items=[Tree(items=4), Tree(items=5)])</span>
<span class="sd">            Tree(items=5)</span>
<span class="sd">            Tree(items=4)</span>
<span class="sd">            Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)])])</span>
<span class="sd">            Tree(items=[Tree(items=2), Tree(items=3)])</span>
<span class="sd">            Tree(items=3)</span>
<span class="sd">            Tree(items=2)</span>
<span class="sd">            Tree(items=[Tree(items=0), Tree(items=1)])</span>
<span class="sd">            Tree(items=1)</span>
<span class="sd">            Tree(items=0)</span>

<span class="sd">            Iterates select levels:</span>

<span class="sd">            &gt;&gt;&gt; for node in tree.iterate(level=0):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=[Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)])]), Tree(items=[Tree(items=4), Tree(items=5)])])</span>

<span class="sd">            &gt;&gt;&gt; for node in tree.iterate(level=1):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)])])</span>
<span class="sd">            Tree(items=[Tree(items=4), Tree(items=5)])</span>

<span class="sd">            &gt;&gt;&gt; for node in tree.iterate(level=2):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=[Tree(items=0), Tree(items=1)])</span>
<span class="sd">            Tree(items=[Tree(items=2), Tree(items=3)])</span>
<span class="sd">            Tree(items=4)</span>
<span class="sd">            Tree(items=5)</span>

<span class="sd">            &gt;&gt;&gt; for node in tree.iterate(level=3):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=0)</span>
<span class="sd">            Tree(items=1)</span>
<span class="sd">            Tree(items=2)</span>
<span class="sd">            Tree(items=3)</span>

<span class="sd">            &gt;&gt;&gt; for node in tree.iterate(level=-4):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=[Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)])]), Tree(items=[Tree(items=4), Tree(items=5)])])</span>

<span class="sd">            &gt;&gt;&gt; for node in tree.iterate(level=-3):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)])])</span>

<span class="sd">            &gt;&gt;&gt; for node in tree.iterate(level=-2):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=[Tree(items=0), Tree(items=1)])</span>
<span class="sd">            Tree(items=[Tree(items=2), Tree(items=3)])</span>
<span class="sd">            Tree(items=[Tree(items=4), Tree(items=5)])</span>

<span class="sd">            &gt;&gt;&gt; for node in tree.iterate(level=-1):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=0)</span>
<span class="sd">            Tree(items=1)</span>
<span class="sd">            Tree(items=2)</span>
<span class="sd">            Tree(items=3)</span>
<span class="sd">            Tree(items=4)</span>
<span class="sd">            Tree(items=5)</span>

<span class="sd">            Iterates select levels in reverse:</span>

<span class="sd">            &gt;&gt;&gt; for node in tree.iterate(level=0, reverse=True):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=[Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)])]), Tree(items=[Tree(items=4), Tree(items=5)])])</span>

<span class="sd">            &gt;&gt;&gt; for node in tree.iterate(level=1, reverse=True):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=[Tree(items=4), Tree(items=5)])</span>
<span class="sd">            Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)])])</span>

<span class="sd">            &gt;&gt;&gt; for node in tree.iterate(level=2, reverse=True):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=5)</span>
<span class="sd">            Tree(items=4)</span>
<span class="sd">            Tree(items=[Tree(items=2), Tree(items=3)])</span>
<span class="sd">            Tree(items=[Tree(items=0), Tree(items=1)])</span>

<span class="sd">            &gt;&gt;&gt; for node in tree.iterate(level=3, reverse=True):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=3)</span>
<span class="sd">            Tree(items=2)</span>
<span class="sd">            Tree(items=1)</span>
<span class="sd">            Tree(items=0)</span>

<span class="sd">            &gt;&gt;&gt; for node in tree.iterate(level=-4, reverse=True):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=[Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)])]), Tree(items=[Tree(items=4), Tree(items=5)])])</span>

<span class="sd">            &gt;&gt;&gt; for node in tree.iterate(level=-3, reverse=True):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=[Tree(items=[Tree(items=0), Tree(items=1)]), Tree(items=[Tree(items=2), Tree(items=3)])])</span>

<span class="sd">            &gt;&gt;&gt; for node in tree.iterate(level=-2, reverse=True):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=[Tree(items=4), Tree(items=5)])</span>
<span class="sd">            Tree(items=[Tree(items=2), Tree(items=3)])</span>
<span class="sd">            Tree(items=[Tree(items=0), Tree(items=1)])</span>

<span class="sd">            &gt;&gt;&gt; for node in tree.iterate(level=-1, reverse=True):</span>
<span class="sd">            ...     node</span>
<span class="sd">            Tree(items=5)</span>
<span class="sd">            Tree(items=4)</span>
<span class="sd">            Tree(items=3)</span>
<span class="sd">            Tree(items=2)</span>
<span class="sd">            Tree(items=1)</span>
<span class="sd">            Tree(items=0)</span>

<span class="sd">        Returns generator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_depth_first</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">node</span>
            <span class="k">elif</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">level</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">_get_level</span><span class="p">()</span> <span class="o">==</span> <span class="n">level</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">node</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">_get_level</span><span class="p">(</span><span class="n">negative</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="n">level</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">node</span>


<span class="c1">### FUNCTIONS ####</span>


<span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Selection</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">)</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span><span class="n">proxy_class</span><span class="o">=</span><span class="n">Selection</span><span class="p">)</span>
    <span class="n">callback</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="o">.</span><span class="n">_make_initializer_callback</span><span class="p">(</span>
        <span class="n">Selection</span><span class="p">,</span> <span class="n">callback_class</span><span class="o">=</span><span class="n">abjad</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">module_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;baca&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">append_callback</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">abjad</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="s2">&quot;baca&quot;</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2018-2021, Gregory Rowland Evans
      <span class="lastupdated">
        Last updated on Jun 03, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>